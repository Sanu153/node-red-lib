[
    {
        "id": "457ab65c.d54b38",
        "type": "tab",
        "label": "SNIPS v2",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1cdaf984.1ad006",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Array_lights",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction findObjectByKey(array, key, value) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            return array[i];\n        }\n    }\n    return null;\n}\n\nvar rawCmd = findObjectByKey(msg.payload.slots, 'slotName', 'cmd');\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'device');\nvar rawAll = findObjectByKey(msg.payload.slots, 'slotName', 'all');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nvar rawHere = findObjectByKey(msg.payload.slots, 'slotName', 'here');\nvar rawQuery = findObjectByKey(msg.payload.slots, 'slotName', 'query');\n\nmsg.cmd = [];\nif (rawCmd !== null) {\n    rawCmd.value.value = rawCmd.value.value.toLowerCase();\n    if (rawCmd.value.value === \"on\" || rawCmd.value.value === \"an\" || rawCmd.value.value === \"ein\") {\n        msg.cmd.cmd = \"on\";\n    } else if (rawCmd.value.value === \"off\" || rawCmd.value.value === \"of\" || rawCmd.value.value === \"aus\") {\n        msg.cmd.cmd = \"off\";\n    } else if (rawCmd.value.value === \"set\" || rawCmd.value.value === \"dimme\") {\n        msg.cmd.cmd = \"set\";\n    }\n}\nif (rawRoom !== null) {\n\tmsg.cmd.room = rawRoom.value.value.toLowerCase().sansAccent();\n} else if (rawAll === null) {\n    msg.cmd.room = msg.payload.siteId;\n}\nif (rawDevice !== null && rawDevice.value.value !== \"lights\" && rawDevice.value.value !== \"the lights\" && rawDevice.value.value !== \"light\" && rawDevice.value.value !== \"the light\") {\n\tmsg.cmd.device = rawDevice.value.value.toLowerCase().sansAccent();\n}\nif (rawAll !== null) {\n\tmsg.cmd.all = rawAll.value.value;\n}\nif (rawValue !== null) {\n\tmsg.cmd.value = rawValue.value.value;\n}\nif (rawHere !== null) {\n\tmsg.cmd.room = msg.payload.siteId;\n}\nif (rawQuery !== null) {\n\tmsg.cmd.query = rawQuery.value.value;\n}\nmsg.cmd.siteId = msg.payload.siteId;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2230,
        "y": 360,
        "wires": [
            [
                "5111e77b.3230f8",
                "383a442c.e188cc",
                "cfd84045.44788",
                "1c2c46fc.70b419",
                "e8c6fa13.e3d518"
            ]
        ]
    },
    {
        "id": "282c4b83.6fe674",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Snips intents",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:on_off_lights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:open_close_shutter",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:set_thermostats",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:control_scenes_aux",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 4,
        "x": 990,
        "y": 320,
        "wires": [
            [
                "4ff322ec.63713c"
            ],
            [
                "392307f9.c533f8"
            ],
            [
                "6b7b4709.835448"
            ],
            [
                "e3abcdd7.550c4"
            ]
        ]
    },
    {
        "id": "ae0c613f.4f58e",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/rest/alexa/skill/items",
        "tls": "",
        "x": 2470,
        "y": 420,
        "wires": [
            [
                "e4816e1.1145e9"
            ]
        ]
    },
    {
        "id": "e4816e1.1145e9",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 2630,
        "y": 420,
        "wires": [
            [
                "c2bc294b.af0078"
            ]
        ]
    },
    {
        "id": "c2bc294b.af0078",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "List_lights",
        "func": "function findSwitchByKey(array, key, value) {\n    msg.payload.switch_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.switch_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDimmerByKey(array, key, value) {\n    msg.payload.dimmer_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.dimmer_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfindSwitchByKey(msg.payload, 'type', 'lights');\nfindDimmerByKey(msg.payload, 'type', 'dimmers');\n\nmsg.lights = msg.payload.switch_lights.concat(msg.payload.dimmer_lights);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2780,
        "y": 420,
        "wires": [
            [
                "aabc2241.7435c"
            ]
        ]
    },
    {
        "id": "1885f744.201ad9",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Prepare_request",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\n//put an array of objets matching the type of device given in parameters in msg.room\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        x = x.toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[1] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.device !== undefined && msg.cmd.room === undefined) {\n\tfindDeviceByKey(msg.lights, 'name', msg.cmd.device);\n} else if (msg.cmd.all !== undefined && msg.cmd.room !== undefined && msg.cmd.device === undefined) {\n\tfindRoomByKey(msg.lights, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined && msg.cmd.device === undefined) {\n\tmsg.items = msg.lights;\n} else if (msg.cmd.room !== undefined && msg.cmd.device !== undefined) {\n    tmp = [];\n    findDeviceByKey(msg.lights, 'name', msg.cmd.device);\n\ttmp = msg.items;\n\tfindRoomByKey(tmp, 'name', msg.cmd.room);\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined && msg.cmd.device === undefined) {\n\tfindRoomByKey(msg.lights, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for \"SET\" commands and put them in msg.url\nmsg.url = [];\nif (msg.cmd.cmd ===\"brighten\") {\n    for (var i = 0; i < msg.items.length; i++) {\n   \t\tif (msg.items[i].type === \"dimmers\") {\n   \t\t    if (msg.cmd.value !== undefined){\n   \t\t\t    var val = msg.cmd.value*2.55;\n   \t\t\t    val = precisionRound(val, 1);\n   \t\t\t    var newVal = msg.current[i].Data[0].Value+val;\n   \t\t\t    if (newVal > 255) {\n   \t\t    \t    newVal = 255;\n   \t\t        }\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t\t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t    else {\n   \t\t        var newVal = msg.current[i].Data[0].Value+51;\n   \t\t\t    if (newVal > 255) {\n   \t\t    \t    newVal = 255;\n   \t\t        }\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t\t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t}\n   \t\telse {\n\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t}\n\t}\n}\nelse if (msg.cmd.cmd ===\"dim\") {\n    for (var i = 0; i < msg.items.length; i++) {\n   \t\tif (msg.items[i].type === \"dimmers\") {\n   \t\t    if (msg.cmd.value !== undefined) {\n   \t\t        var val = msg.cmd.value*2.55;\n   \t\t    \tval = precisionRound(val, 1);\n   \t\t    \tvar newVal = msg.current[i].Data[0].Value-val;\n   \t\t    \tif (newVal < 0) {\n   \t\t    \t    newVal = 0;\n   \t\t    \t}\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t    \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t    else {\n   \t\t        var newVal = msg.current[i].Data[0].Value-51;\n   \t\t    \tif (newVal < 0) {\n   \t\t    \t    newVal = 0;\n   \t\t    \t}\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t    \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t\t\n   \t\t} \n   \t\telse {\n\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t}\n\t}\n}\nelse if (msg.cmd.cmd === \"on\" || msg.cmd.cmd === \"set\") {\n    if (msg.cmd.value !== undefined) {\n       \tfor (var i = 0; i < msg.items.length; i++) {\n       \t\tif (msg.items[i].type === \"dimmers\") {\n       \t\t\tvar val = msg.cmd.value*2.55;\n       \t\t\tval = precisionRound(val, 1);\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n       \t\t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n       \t\t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t} \n       \t\telse if (msg.cmd.value > 0) {\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n       \t\telse {\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n    \t}\n    }\n    else {\n\t    for (var i = 0; i < msg.items.length; i++) {\n\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n   \t    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n\t    }\n    }\n}\nelse if (msg.cmd.cmd === \"off\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n   \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n\t}\n} \nelse if (msg.cmd.cmd !== \"on\" && msg.cmd.cmd !== \"off\" && msg.cmd.cmd !== \"brighten\" && msg.cmd.cmd !== \"dim\") {\n   msg.error = {\n        text: \"Entschuldigung, ich habe deinen Befehl nicht verstanden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    }; \n}\n\nif (msg.url[0] === undefined && msg.error === undefined) {\n    msg.error = {\n        text: \"Entschuldigung, ich kann dieses Gerät nicht finden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1870,
        "y": 940,
        "wires": [
            [
                "f661db5e.dd8568",
                "97df0b6.c2c27f8",
                "4b7a75e0.df2bdc",
                "747b001d.73bbb"
            ]
        ]
    },
    {
        "id": "bb121687.922a48",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "Send URL",
        "method": "GET",
        "ret": "obj",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 1853.3333892822266,
        "y": 1065.0000648498535,
        "wires": [
            [
                "7b7dc3e3.92e28c"
            ]
        ]
    },
    {
        "id": "9cde03e3.c51c5",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2216.666648864746,
        "y": 939.9999809265137,
        "wires": [
            [
                "4eacf468.ca557c"
            ]
        ]
    },
    {
        "id": "f661db5e.dd8568",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2064.999984741211,
        "y": 939.999979019165,
        "wires": [
            [
                "9cde03e3.c51c5"
            ]
        ]
    },
    {
        "id": "4eacf468.ca557c",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2356.666679382324,
        "y": 941.6665630340576,
        "wires": [
            [
                "bb121687.922a48"
            ]
        ]
    },
    {
        "id": "759b19ae.d71ae8",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Array_shutters",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nString.prototype.trimRight = function(charlist) {\n  if (charlist === undefined)\n    charlist = \"\\s\";\n\n  return this.replace(new RegExp(\"[\" + charlist + \"]+$\"), \"\");\n};\n\nfunction findObjectByKey(array, key, value) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            return array[i];\n        }\n    }\n    return null;\n}\n\nvar rawCmd = findObjectByKey(msg.payload.slots, 'slotName', 'cmd');\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nvar rawAll = findObjectByKey(msg.payload.slots, 'slotName', 'all');\nvar rawHere = findObjectByKey(msg.payload.slots, 'slotName', 'here');\nvar rawQuery = findObjectByKey(msg.payload.slots, 'slotName', 'query');\n\nmsg.cmd = [];\nif (rawCmd !== null) {\n\tif (rawCmd.value.value === \"open\" || rawCmd.value.value === \"on\" || rawCmd.value.value === \"oeffne\") {\n\t    msg.cmd.cmd = \"open\";\n\t}\n\telse if (rawCmd.value.value === \"close\" || rawCmd.value.value === \"off\" || rawCmd.value.value === \"schliesse\") {\n\t    msg.cmd.cmd = \"close\";\n\t}\n\telse if (rawCmd.value.value === \"set\" || rawCmd.value.value === \"stelle\") {\n\t    msg.cmd.cmd = rawCmd.value.value;\n\t}\n}\nif (rawRoom !== null) {\n    rawRoom.value.value = rawRoom.value.value.trimRight();\n    msg.cmd.room = rawRoom.value.value.toLowerCase().sansAccent();\n} else if (rawAll === null) {\n    msg.cmd.room = msg.payload.siteId;\n}\nif (rawDevice !== null && rawDevice.value.value !== \"shutters\" && rawDevice.value.value !== \"shutter\" && rawDevice.value.value !== \"curtains\" && rawDevice.value.value !== \"curtain\") {\n\tmsg.cmd.device = rawDevice.value.value.toLowerCase().sansAccent();\n}\nif (rawAll !== null) {\n\tmsg.cmd.all = rawAll.value.value;\n}\nif (rawValue !== null) {\n\tmsg.cmd.value = rawValue.value.value;\n}\nif (rawHere !== null) {\n\tmsg.cmd.room = msg.payload.siteId;\n}\nif (rawQuery !== null) {\n\tmsg.cmd.query = rawQuery.value.value;\n}\nmsg.cmd.siteId = msg.payload.siteId;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2240,
        "y": 1760,
        "wires": [
            [
                "5d28de25.44f34",
                "10343d94.9290e2",
                "1bff1350.4432dd"
            ]
        ]
    },
    {
        "id": "7b19a293.cff8dc",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/rest/alexa/skill/items",
        "tls": "",
        "x": 2470,
        "y": 1820,
        "wires": [
            [
                "b9aa749e.9d8f88"
            ]
        ]
    },
    {
        "id": "b9aa749e.9d8f88",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 2630,
        "y": 1820,
        "wires": [
            [
                "53fa57eb.796768"
            ]
        ]
    },
    {
        "id": "53fa57eb.796768",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "List_shutters",
        "func": "function findShutterByKey(array, key, value) {\n    msg.shutters = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.shutters[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfindShutterByKey(msg.payload, 'type', 'blinds');\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2790,
        "y": 1820,
        "wires": [
            [
                "cc9070c8.90fcb",
                "70c4b1c.4bb135"
            ]
        ]
    },
    {
        "id": "c78d1e7b.8d997",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Prepare_request",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\n//put an array of objets matching the type of device given in parameters in msg.room\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        x = x.toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[1] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.toLowerCase();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.device !== undefined && msg.cmd.room === undefined) {\n\tfindDeviceByKey(msg.shutters, 'name', msg.cmd.device);\n} else if (msg.cmd.all !== undefined && msg.cmd.room !== undefined && msg.cmd.device === undefined) {\n\tfindRoomByKey(msg.shutters, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined && msg.cmd.device === undefined) {\n\tmsg.items = msg.shutters;\n} else if (msg.cmd.room !== undefined && msg.cmd.device !== undefined) {\n    tmp = [];\n    findDeviceByKey(msg.shutters, 'name', msg.cmd.device);\n\ttmp = msg.items;\n\tfindRoomByKey(tmp, 'name', msg.cmd.room);\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined && msg.cmd.device === undefined) {\n\tfindRoomByKey(msg.shutters, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for \"SET\" commands and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n    if (msg.cmd.cmd ===\"lower\") {\n\t    if (msg.cmd.value !== undefined){\n\t\t    var val = msg.cmd.value*2.55;\n\t\t    val = precisionRound(val, 1);\n\t\t    var newVal = msg.current[i].Data[0].Value+val;\n\t\t    if (newVal > 255) {\n\t    \t    newVal = 255;\n\t        }\n\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n\t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t    }\n\t    else {\n\t        var newVal = msg.current[i].Data[0].Value+51;\n\t\t    if (newVal > 255) {\n\t    \t    newVal = 255;\n\t        }\n\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n\t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t    }\n    }\n    else if (msg.cmd.cmd ===\"higher\") {\n\t    if (msg.cmd.value !== undefined) {\n\t        var val = msg.cmd.value*2.55;\n\t    \tval = precisionRound(val, 1);\n\t    \tvar newVal = msg.current[i].Data[0].Value-val;\n\t    \tif (newVal < 0) {\n\t    \t    newVal = 0;\n\t    \t}\n\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n\t    }\n\t    else {\n\t        var newVal = msg.current[i].Data[0].Value-51;\n\t    \tif (newVal < 0) {\n\t    \t    newVal = 0;\n    \t    }\n            msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n        \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n    }\n    else if (msg.cmd.cmd === \"open\" && msg.cmd.value === undefined) {\n    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t}\n\telse if (msg.cmd.cmd === \"close\" && msg.cmd.value === undefined) {\n    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n\t    msg.url[i] = \"\".concat(...msg.url[i]);\n    }\n    else if (msg.cmd.value !== undefined) {\n   \t\tvar val = (100-msg.cmd.value)*2.55;\n   \t\tval = precisionRound(val, 1);\n   \t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n   \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    }\n    else if (msg.cmd.cmd !== \"on\" && msg.cmd.cmd !== \"off\" && msg.cmd.cmd !== \"lower\" && msg.cmd.cmd !== \"higher\") {\n        msg.error = {\n        text: \"Entschuldigung, ich habe deinen Befehl nicht verstanden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n        }; \n    }\n} \n\nif (msg.url[0] === undefined && msg.error === undefined) {\n    msg.error = {\n        text: \"Entschuldigung, ich kann dieses Gerät nicht finden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1850,
        "y": 2320,
        "wires": [
            [
                "4d02fe84.ad506",
                "cf328892.1b68a8",
                "b296368.43581c8"
            ]
        ]
    },
    {
        "id": "812767eb.a03f78",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "Send URL",
        "method": "GET",
        "ret": "obj",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 1830,
        "y": 2440,
        "wires": [
            [
                "eeadd7f.951fb28"
            ]
        ]
    },
    {
        "id": "c23bb6a.1c3ac48",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2210.000160217285,
        "y": 2321.6667346954346,
        "wires": [
            [
                "a7c17f2c.0e2cc"
            ]
        ]
    },
    {
        "id": "4d02fe84.ad506",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2053.3333892822266,
        "y": 2321.6666049957275,
        "wires": [
            [
                "c23bb6a.1c3ac48"
            ]
        ]
    },
    {
        "id": "a7c17f2c.0e2cc",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2358.33353805542,
        "y": 2321.666714668274,
        "wires": [
            [
                "812767eb.a03f78"
            ]
        ]
    },
    {
        "id": "8be98404.7aba38",
        "type": "mqtt in",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/intent/ProKNX:on_off_lights",
        "qos": "2",
        "broker": "58784e8d.6ca16",
        "x": 580,
        "y": 280,
        "wires": [
            [
                "98401467.a23348"
            ]
        ]
    },
    {
        "id": "98401467.a23348",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": true,
        "x": 850,
        "y": 320,
        "wires": [
            [
                "282c4b83.6fe674",
                "4fa3f7da.3e1e58",
                "c9cfe68a.3d74d8"
            ]
        ]
    },
    {
        "id": "f5f97c15.fe6f5",
        "type": "mqtt in",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/intent/ProKNX:open_close_shutter",
        "qos": "2",
        "broker": "58784e8d.6ca16",
        "x": 600,
        "y": 320,
        "wires": [
            [
                "98401467.a23348"
            ]
        ]
    },
    {
        "id": "c83bc118.a1858",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET ProServIP",
        "method": "GET",
        "ret": "txt",
        "url": "http://{{{payload}}}:3000/proservip",
        "tls": "",
        "x": 2780,
        "y": 360,
        "wires": [
            [
                "95f84d91.c60c3"
            ]
        ]
    },
    {
        "id": "95f84d91.c60c3",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "proServIP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2270,
        "y": 420,
        "wires": [
            [
                "ae0c613f.4f58e"
            ]
        ]
    },
    {
        "id": "ea5cdc41.27e3b",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET ProServIP",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/proservip",
        "tls": "",
        "x": 2780,
        "y": 1760,
        "wires": [
            [
                "ac0f24cd.e83fc8"
            ]
        ]
    },
    {
        "id": "ac0f24cd.e83fc8",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "proServIP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2250,
        "y": 1820,
        "wires": [
            [
                "7b19a293.cff8dc"
            ]
        ]
    },
    {
        "id": "20d883c0.a0e1ec",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Array_thermostats",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            return array[i];\n        }\n    }\n    return null;\n}\n\nvar rawCmd = findObjectByKey(msg.payload.slots, 'slotName', 'cmd');\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawQuery = findObjectByKey(msg.payload.slots, 'slotName', 'query');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nvar rawAll = findObjectByKey(msg.payload.slots, 'slotName', 'all');\nvar rawHere = findObjectByKey(msg.payload.slots, 'slotName', 'here');\n\nmsg.cmd = [];\nif (rawCmd !== null) {\n\trawCmd.value.value = rawCmd.value.value.toLowerCase();\n\t\tif (rawCmd.value.value === \"set\" || rawCmd.value.value === \"stelle\") {\n        msg.cmd.cmd = \"set\";\n    }\n}\nif (rawRoom !== null) {\n\tmsg.cmd.room = rawRoom.value.value.toLowerCase().sansAccent();\n} else if (rawAll === null) {\n    msg.cmd.room = msg.payload.siteId;\n}\nif (rawQuery !== null) {\n\tmsg.cmd.query = rawQuery.value.value;\n}\nif (rawAll !== null) {\n\tmsg.cmd.all = rawAll.value.value;\n}\nif (rawValue !== null) {\n\tmsg.cmd.value = rawValue.value.value;\n}\nif (rawHere !== null) {\n\tmsg.cmd.room = msg.payload.siteId;\n}\nmsg.cmd.siteId = msg.payload.siteId;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3950,
        "y": 380,
        "wires": [
            [
                "d8bad237.d066a"
            ]
        ]
    },
    {
        "id": "5b20c4be.0ce9dc",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET ProServIP",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/proservip",
        "tls": "",
        "x": 4460,
        "y": 380,
        "wires": [
            [
                "dde67d5b.47e41"
            ]
        ]
    },
    {
        "id": "dde67d5b.47e41",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "proServIP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3950,
        "y": 440,
        "wires": [
            [
                "39214175.d229ee"
            ]
        ]
    },
    {
        "id": "4cbb1d77.c38724",
        "type": "mqtt in",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/intent/ProKNX:set_thermostats",
        "qos": "2",
        "broker": "58784e8d.6ca16",
        "x": 590,
        "y": 360,
        "wires": [
            [
                "98401467.a23348"
            ]
        ]
    },
    {
        "id": "39214175.d229ee",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/rest/alexa/skill/items",
        "tls": "",
        "x": 4150,
        "y": 440,
        "wires": [
            [
                "ff881c2b.ff40b"
            ]
        ]
    },
    {
        "id": "ff881c2b.ff40b",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 4310,
        "y": 440,
        "wires": [
            [
                "585b42d5.f5369c"
            ]
        ]
    },
    {
        "id": "585b42d5.f5369c",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "List_heaters",
        "func": "function findHeatersByKey(array, key, value) {\n    msg.heaters = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.heaters[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfindHeatersByKey(msg.payload, 'type', 'heating');\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4470,
        "y": 440,
        "wires": [
            [
                "18920307.a7b00d"
            ]
        ]
    },
    {
        "id": "ef48eae8.10b948",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Prepare_request",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.heaters;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for \"SET\" commands and put them in msg.url\nmsg.url = [];\nmsg.newVal= [];\nif (msg.cmd.cmd === \"set\" && msg.cmd.value !== undefined) {\n   \tfor (var i = 0; i < msg.items.length; i++) {\n   \t\tvar val = msg.cmd.value;\n   \t\tif (val < 18){\n\t            val = 18;\n        \t} else if (val > 28) {\n        \t    val = 28;\n\t        } else {\n    \t        val = val;\n\t        }\n   \t\tmsg.newVal[i] = val;\n   \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, val];\n   \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t\n\t}\n}\nelse if (msg.cmd.cmd === \"colder\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tif (msg.cmd.value !== undefined) {\n\t\t    var val = msg.cmd.value;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target-val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t\telse {\n\t\t    var val = 2;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target-val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t}\n}\nelse if (msg.cmd.cmd === \"warmer\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tif (msg.cmd.value !== undefined) {\n\t\t    var val = msg.cmd.value;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target+val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t\telse {\n\t\t    var val = 2;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target+val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t}\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3571.9051666259766,
        "y": 925.2381086349487,
        "wires": [
            [
                "e3e05737.776738",
                "118df430.cf726c"
            ]
        ]
    },
    {
        "id": "150d4af7.7428c5",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Target",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.heaters;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getTargetUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nif (msg.items[0] === undefined) {\n    msg.error = {\n        text: \"Entschuldigung, es gibt keinen Thermostat in diesem Raum\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3553.33341217041,
        "y": 745.2380867004395,
        "wires": [
            [
                "62f440e4.bca9b",
                "118df430.cf726c"
            ]
        ]
    },
    {
        "id": "a752d2f6.8c133",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Target",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 3554.7621269226074,
        "y": 799.523889541626,
        "wires": [
            [
                "7ba1fc1d.879bf4",
                "bda443a2.0b09b"
            ]
        ]
    },
    {
        "id": "c2a32a21.438e68",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4016.9049682617188,
        "y": 745.23814868927,
        "wires": [
            [
                "a752d2f6.8c133",
                "bda443a2.0b09b"
            ]
        ]
    },
    {
        "id": "4da238ad.be07a8",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Cmd ?",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "set",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 3533.333309173584,
        "y": 633.8096809387207,
        "wires": [
            [
                "ef48eae8.10b948"
            ],
            [
                "150d4af7.7428c5"
            ]
        ]
    },
    {
        "id": "b68dfe6a.217b1",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "target",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3983.33353805542,
        "y": 799.523853302002,
        "wires": [
            [
                "ef48eae8.10b948"
            ]
        ]
    },
    {
        "id": "6529b9f6.4f7958",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 3876.1907501220703,
        "y": 745.23814868927,
        "wires": [
            [
                "c2a32a21.438e68"
            ]
        ]
    },
    {
        "id": "62f440e4.bca9b",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3725.4761848449707,
        "y": 745.2381315231323,
        "wires": [
            [
                "6529b9f6.4f7958"
            ]
        ]
    },
    {
        "id": "ea28481f.7f59b8",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 3819.7621994018555,
        "y": 799.5239152908325,
        "wires": [
            [
                "b68dfe6a.217b1"
            ]
        ]
    },
    {
        "id": "7ba1fc1d.879bf4",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 3696.1906814575195,
        "y": 799.5238628387451,
        "wires": [
            [
                "ea28481f.7f59b8"
            ]
        ]
    },
    {
        "id": "18920307.a7b00d",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Query ?",
        "property": "cmd.query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 4203.690734863281,
        "y": 531.3096237182617,
        "wires": [
            [
                "41deb843.24c978"
            ],
            [
                "4da238ad.be07a8"
            ]
        ]
    },
    {
        "id": "41deb843.24c978",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Target",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nmsg.error = [];\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.heaters;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n}/* else if (msg.cmd.all === undefined && msg.cmd.room === undefined){\n    msg.error = {\n        text: \"Sorry, can you be more specific ?\",\n        siteId: msg.cmd.siteId\n    };\n}*/\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getTargetUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nif (msg.items[0] === undefined) {\n    msg.error = {\n        text: \"Entschuldigung, es gibt keinen Thermostat in diesem Raum\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4344.047939300537,
        "y": 651.6664981842041,
        "wires": [
            [
                "9824edc6.18d93",
                "932640db.d751e"
            ]
        ]
    },
    {
        "id": "89448c3a.c513e",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Target",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 4345.476650238037,
        "y": 704.5236492156982,
        "wires": [
            [
                "9d2fd50a.968468",
                "36a9604c.73d4f"
            ]
        ]
    },
    {
        "id": "be07e6c.3314118",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4810.4766845703125,
        "y": 651.6664886474609,
        "wires": [
            [
                "89448c3a.c513e",
                "36a9604c.73d4f"
            ]
        ]
    },
    {
        "id": "dbbf118e.e33ff",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "target",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4771.1907958984375,
        "y": 705.9522285461426,
        "wires": [
            [
                "7b0c942.e00696c"
            ]
        ]
    },
    {
        "id": "d6c18c1b.01aaa",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 4671.190830230713,
        "y": 651.6665058135986,
        "wires": [
            [
                "be07e6c.3314118"
            ]
        ]
    },
    {
        "id": "9824edc6.18d93",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4519.0479736328125,
        "y": 651.6665229797363,
        "wires": [
            [
                "d6c18c1b.01aaa"
            ]
        ]
    },
    {
        "id": "b35ba1a2.6713f",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 4606.190864562988,
        "y": 705.9522294998169,
        "wires": [
            [
                "dbbf118e.e33ff"
            ]
        ]
    },
    {
        "id": "9d2fd50a.968468",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 4484.048007965088,
        "y": 704.5236568450928,
        "wires": [
            [
                "b35ba1a2.6713f"
            ]
        ]
    },
    {
        "id": "7b0c942.e00696c",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Current",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent;\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.heaters;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.heaters, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getCurrentUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4345.476665496826,
        "y": 833.8093318939209,
        "wires": [
            [
                "3f258b5f.a94494"
            ]
        ]
    },
    {
        "id": "34725c45.456024",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 4345.476909637451,
        "y": 886.6665019989014,
        "wires": [
            [
                "3049ab0a.0417c4"
            ]
        ]
    },
    {
        "id": "fe96d396.da4b7",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4803.333946228027,
        "y": 833.809383392334,
        "wires": [
            [
                "34725c45.456024"
            ]
        ]
    },
    {
        "id": "a174ec6e.40d45",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4768.333576202393,
        "y": 886.6665439605713,
        "wires": [
            [
                "93f5bc1e.bdf8c"
            ]
        ]
    },
    {
        "id": "afa5f5e9.e8cc98",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 4664.048023223877,
        "y": 833.8093318939209,
        "wires": [
            [
                "fe96d396.da4b7"
            ]
        ]
    },
    {
        "id": "3f258b5f.a94494",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4516.190986633301,
        "y": 833.809383392334,
        "wires": [
            [
                "afa5f5e9.e8cc98"
            ]
        ]
    },
    {
        "id": "5f7f014.63a89",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 4609.0481605529785,
        "y": 886.6664924621582,
        "wires": [
            [
                "a174ec6e.40d45"
            ]
        ]
    },
    {
        "id": "3049ab0a.0417c4",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 4488.333839416504,
        "y": 886.6664915084839,
        "wires": [
            [
                "5f7f014.63a89"
            ]
        ]
    },
    {
        "id": "49837540.0b087c",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "Send URL",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 3553.213996887207,
        "y": 1089.6426906585693,
        "wires": [
            [
                "5d6922c2.f15d2c"
            ]
        ]
    },
    {
        "id": "96f4550b.5b6d68",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 3915.4765625,
        "y": 925.2382659912109,
        "wires": [
            [
                "6e927bc3.f90b14"
            ]
        ]
    },
    {
        "id": "e3e05737.776738",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3762.619453430176,
        "y": 925.2381954193115,
        "wires": [
            [
                "96f4550b.5b6d68"
            ]
        ]
    },
    {
        "id": "6e927bc3.f90b14",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4058.333911895752,
        "y": 925.2382478713989,
        "wires": [
            [
                "49837540.0b087c"
            ]
        ]
    },
    {
        "id": "1d650ed9.69f4e1",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 2393.71427154541,
        "y": 1182.3332653045654,
        "wires": []
    },
    {
        "id": "7b7dc3e3.92e28c",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "if (msg.payload.Result === true) {\n    msg.payload = {\n        text: \"Okay\",\n        siteId: msg.cmd.siteId\n    };\n}\nelse if (msg.payload.Result === \"false\") {\n    msg.payload = {\n        text: \"Entschuldigung Der Server hat Ihren Befehl nicht verstanden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\nelse {\n    msg.payload = {\n        text: \"Entschuldigung Der Server antwortet nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1850.0000247955322,
        "y": 1226.6667833328247,
        "wires": [
            [
                "5115a9c1.d7a958"
            ]
        ]
    },
    {
        "id": "97df0b6.c2c27f8",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 1839.99995803833,
        "y": 1183.3331003189087,
        "wires": [
            [
                "65941a34.153234"
            ]
        ]
    },
    {
        "id": "65941a34.153234",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1989.99995803833,
        "y": 1183.3331003189087,
        "wires": [
            [
                "81969024.e8422"
            ]
        ]
    },
    {
        "id": "81969024.e8422",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "15",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 2169.99995803833,
        "y": 1183.3331003189087,
        "wires": [
            [
                "1d650ed9.69f4e1"
            ]
        ]
    },
    {
        "id": "cf328892.1b68a8",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 1808.3331871032715,
        "y": 2542.4997873306274,
        "wires": [
            [
                "4b04507b.cde9"
            ]
        ]
    },
    {
        "id": "eeadd7f.951fb28",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "if (msg.payload.Result === true) {\n    msg.payload = {\n        text: \"Okay\",\n        siteId: msg.cmd.siteId\n    };\n}\nelse if (msg.payload.Result === \"false\") {\n    msg.payload = {\n        text: \"Entschuldigung Der Server hat Ihren Befehl nicht verstanden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\nelse {\n    msg.payload = {\n        text: \"Entschuldigung Der Server antwortet nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1820,
        "y": 2603.333339691162,
        "wires": [
            [
                "f9d2fdd5.7865e"
            ]
        ]
    },
    {
        "id": "259bf439.4c296c",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK===================================",
        "info": "",
        "x": 2110,
        "y": 1120,
        "wires": []
    },
    {
        "id": "d7fd747d.b36108",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===================================LIGHTS CONTROL=================================",
        "info": "",
        "x": 2510,
        "y": 220,
        "wires": []
    },
    {
        "id": "cfc29c41.17261",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "==============================REQUEST CONSTRUCTION==============================",
        "info": "",
        "x": 2110,
        "y": 880,
        "wires": []
    },
    {
        "id": "8953c121.f74",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "=================================SHUTTERS CONTROL==================================",
        "info": "",
        "x": 2500,
        "y": 1620,
        "wires": []
    },
    {
        "id": "5cdddb3b.d65734",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK===================================",
        "info": "",
        "x": 2098.333110809326,
        "y": 2497.4997816085815,
        "wires": []
    },
    {
        "id": "4c8d32eb.a1889c",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================REQUEST CONSTRUCTION==============================",
        "info": "",
        "x": 2105.0002670288086,
        "y": 2257.499707221985,
        "wires": []
    },
    {
        "id": "d3017aa.aa5a888",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "=============================THERMOSTATS CONTROL================================",
        "info": "",
        "x": 4194.880748748779,
        "y": 242.97600841522217,
        "wires": []
    },
    {
        "id": "6e4b3cd4.25f2b4",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================DEVICES DETECTION=================================",
        "info": "",
        "x": 2510,
        "y": 300,
        "wires": []
    },
    {
        "id": "4bf219d6.39df88",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================REQUEST EXECUTION=================================",
        "info": "",
        "x": 2110,
        "y": 1020,
        "wires": []
    },
    {
        "id": "a913d791.3639d8",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================REQUEST EXECUTION=================================",
        "info": "",
        "x": 2096.6664390563965,
        "y": 2382.499726295471,
        "wires": []
    },
    {
        "id": "45f7918b.8c211",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "==================================DEVICES DETECTION=================================",
        "info": "",
        "x": 2500,
        "y": 1700,
        "wires": []
    },
    {
        "id": "e05e8de.62a0d7",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================DEVICES DETECTION==================================",
        "info": "",
        "x": 4198.547431945801,
        "y": 325.5950698852539,
        "wires": []
    },
    {
        "id": "d479c99d.a09d98",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================QUERY OR COMMAND==================================",
        "info": "",
        "x": 4196.928535461426,
        "y": 489.64273834228516,
        "wires": []
    },
    {
        "id": "747d4f1b.4ea45",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "====================SET TARGET TEMP OR ADAPT OLD TARGET TEMP======================",
        "info": "",
        "x": 3806.928291320801,
        "y": 586.7855930328369,
        "wires": []
    },
    {
        "id": "3a733eae.f8e092",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "==================================GET TARGET TEMP=================================",
        "info": "",
        "x": 3806.928352355957,
        "y": 692.4998683929443,
        "wires": []
    },
    {
        "id": "d29703ec.07b7d",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "==============================REQUEST CONSTRUCTION==============================",
        "info": "",
        "x": 3806.928352355957,
        "y": 865.3570461273193,
        "wires": []
    },
    {
        "id": "2c97f358.20bcac",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================REQUEST EXECUTION=================================",
        "info": "",
        "x": 3810.0710830688477,
        "y": 1032.4999494552612,
        "wires": []
    },
    {
        "id": "969ec48d.86ea48",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "==================================GET TARGET TEMP=================================",
        "info": "",
        "x": 4606.356819152832,
        "y": 586.7855739593506,
        "wires": []
    },
    {
        "id": "da2d2719.ad8468",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================GET CURRENT TEMP=================================",
        "info": "",
        "x": 4607.499641418457,
        "y": 769.6426906585693,
        "wires": []
    },
    {
        "id": "dff14c35.94e9f",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "=================================SNIPS INTENTS INPUT==================================",
        "info": "",
        "x": 796.6667175292969,
        "y": 223.33332633972168,
        "wires": []
    },
    {
        "id": "932640db.d751e",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 4333.213996887207,
        "y": 1069.6426906585693,
        "wires": [
            [
                "2db5dcf9.1d2554"
            ],
            [
                "71115b07.242854"
            ]
        ]
    },
    {
        "id": "2db5dcf9.1d2554",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4523.213996887207,
        "y": 1069.6426906585693,
        "wires": [
            [
                "b627fd55.38c77"
            ]
        ]
    },
    {
        "id": "32b7cb1c.1297e4",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 4861.547340393066,
        "y": 1179.3092155456543,
        "wires": []
    },
    {
        "id": "b627fd55.38c77",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "15",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 4723.213996887207,
        "y": 1069.6426906585693,
        "wires": [
            [
                "32b7cb1c.1297e4"
            ]
        ]
    },
    {
        "id": "93f5bc1e.bdf8c",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.answer = [];\nmsg.text = [];\nmsg.error = [];\n\nif (msg.current !== undefined && msg.target !== undefined){\n    if (msg.current[0].Result === true && msg.target[0].Result === true) {\n        for (var i = 0; i < msg.items.length; i++) {\n            var target = msg.target[i].Data[0].Value;\n            var current = precisionRound(msg.current[i].Data[0].Value, 0);\n            var room = msg.items[i].zone;\n            /*var text1 = \"Heating is set to \";\n            var text2 = \" degrees in the \";\n            var text3 = \", with a current temperature of \";\n            msg.text[i] = [text1, target, text2, room, text3, current];*/\n       \t\tvar text1 = \"Die Heizung ist auf \";\n            var text2 = \" grad im \";\n            var text3 = \" eingestellt bei einer aktuellen Temperatur von \";\n            msg.text[i] = [text1, target, text2, room, text3, current];\n       \t\tvar endText = \"\".concat(...msg.text[i]);\n            msg.answer[i] = {\n                text: endText,\n                siteId: msg.cmd.siteId,\n                lang: \"de-DE\"\n            };\n        }\n    }\n    else if (msg.current[0].Result === \"false\") {\n        msg.error = {\n            text: \"Entschuldigung, der Server hat Ihre Anfrage nicht verstanden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    }\n}\nelse {\n    msg.error = {\n        text: \"Entschuldigung, der Server antwortet nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4503.213996887207,
        "y": 1009.6426906585693,
        "wires": [
            [
                "23c93d97.a50352"
            ]
        ]
    },
    {
        "id": "97ffcaf3.d37e08",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK===================================",
        "info": "",
        "x": 4605.30912399292,
        "y": 959.3648796081543,
        "wires": []
    },
    {
        "id": "70d54b62.bcd2f4",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 4538.547782897949,
        "y": 1127.9764156341553,
        "wires": [
            [
                "840c312f.263b5"
            ]
        ]
    },
    {
        "id": "840c312f.263b5",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4683.547645568848,
        "y": 1127.9761714935303,
        "wires": [
            [
                "8ab00109.a83b1"
            ]
        ]
    },
    {
        "id": "8ab00109.a83b1",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4863.214385986328,
        "y": 1127.9761152267456,
        "wires": [
            [
                "32b7cb1c.1297e4"
            ]
        ]
    },
    {
        "id": "71115b07.242854",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "answer",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4371.214332580566,
        "y": 1127.9759607315063,
        "wires": [
            [
                "70d54b62.bcd2f4"
            ]
        ]
    },
    {
        "id": "118df430.cf726c",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 3537.880527496338,
        "y": 1203.3092880249023,
        "wires": [
            [
                "a386ebf5.8b9c88"
            ]
        ]
    },
    {
        "id": "a386ebf5.8b9c88",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3697.8801307678223,
        "y": 1203.309326171875,
        "wires": [
            [
                "8511bbb6.d47278"
            ]
        ]
    },
    {
        "id": "efb6d0b1.a9cf5",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "msg.text = [];\n\nfor (var i = 0; i < msg.payload.length; i++) {\n    if (msg.payload[i].Result === true) {\n        var room = msg.items[i].zone;\n        var target = msg.newVal[i];\n        /*var text1 = \"Okay, setting the heating to \";\n        var text2 = \" degrees in the \";\n        msg.text[i] = [text1, target, text2, room];*/\n        var text1 = \"Okay, die Heizung ist aus \";\n        var text2 = \" Grad im \";\n        var text3 = \" eingestellt\";\n        msg.text[i] = [text1, target, text2, room, text3];\n        var endText = \"\".concat(...msg.text[i]);\n        msg.payload = {\n            text: endText,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    }\n    else if (msg.payload.Result === \"false\") {\n        msg.payload = {\n            text: \"Entschuldigung, der Server hat Ihre Anfrage nicht verstanden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    }\n    else {\n        msg.payload = {\n            text: \"Entschuldigung, der Server antwortet nicht\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3723.213996887207,
        "y": 1249.6426906585693,
        "wires": [
            [
                "8511bbb6.d47278"
            ]
        ]
    },
    {
        "id": "bf71db64.d4e478",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 4096.546951293945,
        "y": 1249.975908279419,
        "wires": []
    },
    {
        "id": "8511bbb6.d47278",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 3906.5470275878906,
        "y": 1249.975923538208,
        "wires": [
            [
                "bf71db64.d4e478"
            ]
        ]
    },
    {
        "id": "6c924abd.162754",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK==================================",
        "info": "",
        "x": 3813.213996887207,
        "y": 1149.6426906585693,
        "wires": []
    },
    {
        "id": "36a9604c.73d4f",
        "type": "trigger",
        "z": "457ab65c.d54b38",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "1",
        "extend": true,
        "units": "s",
        "reset": "",
        "name": "",
        "x": 4343.213996887207,
        "y": 1009.6426906585693,
        "wires": [
            [
                "93f5bc1e.bdf8c"
            ]
        ]
    },
    {
        "id": "23c93d97.a50352",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 4683.213996887207,
        "y": 1009.6426906585693,
        "wires": [
            [
                "932640db.d751e"
            ]
        ]
    },
    {
        "id": "5115a9c1.d7a958",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "All ?",
        "property": "cmd.device",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 1998.3332061767578,
        "y": 1229.9997825622559,
        "wires": [
            [
                "81969024.e8422"
            ],
            [
                "ba2fff8c.446b1"
            ],
            [
                "1d650ed9.69f4e1"
            ]
        ]
    },
    {
        "id": "589ec466.8c5aec",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 2375.4759559631348,
        "y": 2552.9282398223877,
        "wires": []
    },
    {
        "id": "4b04507b.cde9",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1962.777687072754,
        "y": 2554.7221126556396,
        "wires": [
            [
                "37ee360b.fa900a"
            ]
        ]
    },
    {
        "id": "37ee360b.fa900a",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "15",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 2164.3332901000977,
        "y": 2553.4997234344482,
        "wires": [
            [
                "589ec466.8c5aec"
            ]
        ]
    },
    {
        "id": "f9d2fdd5.7865e",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "All ?",
        "property": "cmd.all",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1968.3331871032715,
        "y": 2602.4997873306274,
        "wires": [
            [
                "37ee360b.fa900a"
            ],
            [
                "37ee360b.fa900a"
            ]
        ]
    },
    {
        "id": "5d6922c2.f15d2c",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 3713.213996887207,
        "y": 1089.6426906585693,
        "wires": [
            [
                "cf06db1c.8166b8"
            ]
        ]
    },
    {
        "id": "cf06db1c.8166b8",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 3853.213996887207,
        "y": 1089.6426906585693,
        "wires": [
            [
                "efb6d0b1.a9cf5"
            ]
        ]
    },
    {
        "id": "bda443a2.0b09b",
        "type": "trigger",
        "z": "457ab65c.d54b38",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "1",
        "extend": true,
        "units": "s",
        "reset": "",
        "name": "",
        "x": 3543.213996887207,
        "y": 1249.6426906585693,
        "wires": [
            [
                "efb6d0b1.a9cf5"
            ]
        ]
    },
    {
        "id": "8122c5e5.1b66c8",
        "type": "link in",
        "z": "457ab65c.d54b38",
        "name": "Lights Intent OUT",
        "links": [
            "4ff322ec.63713c"
        ],
        "x": 2195,
        "y": 260,
        "wires": [
            [
                "1cdaf984.1ad006"
            ]
        ]
    },
    {
        "id": "4ff322ec.63713c",
        "type": "link out",
        "z": "457ab65c.d54b38",
        "name": "Lights Intent IN",
        "links": [
            "8122c5e5.1b66c8"
        ],
        "x": 1115,
        "y": 280,
        "wires": []
    },
    {
        "id": "392307f9.c533f8",
        "type": "link out",
        "z": "457ab65c.d54b38",
        "name": "Shutters Intent IN",
        "links": [
            "e0db1564.9f2e98"
        ],
        "x": 1115,
        "y": 320,
        "wires": []
    },
    {
        "id": "6b7b4709.835448",
        "type": "link out",
        "z": "457ab65c.d54b38",
        "name": "Thermostats Intent IN",
        "links": [
            "69069b9a.361a54"
        ],
        "x": 1115,
        "y": 360,
        "wires": []
    },
    {
        "id": "e0db1564.9f2e98",
        "type": "link in",
        "z": "457ab65c.d54b38",
        "name": "Shutters Intent OUT",
        "links": [
            "392307f9.c533f8"
        ],
        "x": 2175,
        "y": 1660,
        "wires": [
            [
                "759b19ae.d71ae8"
            ]
        ]
    },
    {
        "id": "69069b9a.361a54",
        "type": "link in",
        "z": "457ab65c.d54b38",
        "name": "Thermostats Intent OUT",
        "links": [
            "6b7b4709.835448"
        ],
        "x": 3879.8807487487793,
        "y": 282.97600841522217,
        "wires": [
            [
                "20d883c0.a0e1ec"
            ]
        ]
    },
    {
        "id": "b2934a11.23ab18",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "=================================================================================HOME AUTOMATION INTENTS===================================================================================",
        "info": "",
        "x": 2520,
        "y": 120,
        "wires": []
    },
    {
        "id": "279c1ec7.6246a2",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===================================================================================SNIPS CORE FUNCTIONS===================================================================================",
        "info": "",
        "x": 790,
        "y": 120,
        "wires": []
    },
    {
        "id": "ba2fff8c.446b1",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "6",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 2169.99995803833,
        "y": 1223.3331003189087,
        "wires": [
            [
                "1d650ed9.69f4e1"
            ]
        ]
    },
    {
        "id": "5111e77b.3230f8",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "sudo ip addr show eth0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP",
        "x": 2390,
        "y": 360,
        "wires": [
            [
                "974783fa.2b87c"
            ],
            [],
            []
        ]
    },
    {
        "id": "974783fa.2b87c",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Trim answer",
        "func": "msg.payload = msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2590,
        "y": 360,
        "wires": [
            [
                "c83bc118.a1858",
                "f59985c3.821e08"
            ]
        ]
    },
    {
        "id": "5d28de25.44f34",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "sudo ip addr show eth0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP",
        "x": 2410,
        "y": 1760,
        "wires": [
            [
                "1011d098.eee6ff"
            ],
            [],
            []
        ]
    },
    {
        "id": "1011d098.eee6ff",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Trim answer",
        "func": "msg.payload = msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2610,
        "y": 1760,
        "wires": [
            [
                "ea5cdc41.27e3b"
            ]
        ]
    },
    {
        "id": "d8bad237.d066a",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "sudo ip addr show eth0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP",
        "x": 4130,
        "y": 380,
        "wires": [
            [
                "ae7b3bbc.40e318"
            ],
            [],
            []
        ]
    },
    {
        "id": "ae7b3bbc.40e318",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Trim answer",
        "func": "msg.payload = msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4290,
        "y": 380,
        "wires": [
            [
                "5b20c4be.0ce9dc"
            ]
        ]
    },
    {
        "id": "7acb094c.763928",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 3850,
        "y": 1320,
        "wires": [
            [
                "cabbb1ee.7ca25"
            ],
            [],
            []
        ]
    },
    {
        "id": "cabbb1ee.7ca25",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 4034.2857933044434,
        "y": 1319.5713729858398,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "bcb696ce.b194e8",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3658.8286361694336,
        "y": 1319.5713329315186,
        "wires": [
            [
                "7acb094c.763928"
            ]
        ]
    },
    {
        "id": "b24dbf80.8d23b",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 4670,
        "y": 1240,
        "wires": [
            [
                "2a4ae66d.97786a"
            ],
            [],
            []
        ]
    },
    {
        "id": "2a4ae66d.97786a",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 4854.285793304443,
        "y": 1239.5713729858398,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "ab4b7e2c.f8c19",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4478.828636169434,
        "y": 1239.5713329315186,
        "wires": [
            [
                "b24dbf80.8d23b"
            ]
        ]
    },
    {
        "id": "b50cb1c.8fe215",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 2199.99995803833,
        "y": 1303.3331003189087,
        "wires": [
            [
                "e02fc504.d49c48"
            ],
            [],
            []
        ]
    },
    {
        "id": "e02fc504.d49c48",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 2384.2857513427734,
        "y": 1302.9044733047485,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "3246424a.e415de",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2008.8285942077637,
        "y": 1302.9044332504272,
        "wires": [
            [
                "b50cb1c.8fe215"
            ]
        ]
    },
    {
        "id": "98691367.79391",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 2189.9999389648438,
        "y": 2655.8331050872803,
        "wires": [
            [
                "1ff6046d.0fc45c"
            ],
            [],
            []
        ]
    },
    {
        "id": "1ff6046d.0fc45c",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 2374.285732269287,
        "y": 2655.40447807312,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "12a89ea0.8f6c91",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1998.8285751342773,
        "y": 2655.404438018799,
        "wires": [
            [
                "98691367.79391"
            ]
        ]
    },
    {
        "id": "88451ebb.cb69a",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "endSession",
        "func": "msg.payload = {\n    \"sessionId\": msg.payload.sessionId    \n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 730,
        "y": 620,
        "wires": [
            [
                "c7669f59.c50b1"
            ]
        ]
    },
    {
        "id": "c7669f59.c50b1",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/dialogueManager/endSession",
        "qos": "",
        "retain": "",
        "broker": "b5b4c68d.4b3a48",
        "x": 968.9999580383301,
        "y": 619.9999942779541,
        "wires": []
    },
    {
        "id": "4fa3f7da.3e1e58",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "250",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 572.9999961853027,
        "y": 620,
        "wires": [
            [
                "88451ebb.cb69a"
            ]
        ]
    },
    {
        "id": "aabc2241.7435c",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Query ?",
        "property": "cmd.query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2500,
        "y": 540,
        "wires": [
            [
                "77eb15bd.e11ddc"
            ],
            [
                "d211c323.12d94"
            ]
        ]
    },
    {
        "id": "77eb15bd.e11ddc",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Current",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.lights, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.lights;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.lights, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getCurrentUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2630,
        "y": 660,
        "wires": [
            [
                "5ed758bc.59f6a8"
            ]
        ]
    },
    {
        "id": "ae9cec47.fd64d",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2630.000244140625,
        "y": 712.8571701049805,
        "wires": [
            [
                "2a873b81.7ad144"
            ]
        ]
    },
    {
        "id": "c9c8bd5.60ff74",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 3087.857280731201,
        "y": 660.0000514984131,
        "wires": [
            [
                "ae9cec47.fd64d"
            ]
        ]
    },
    {
        "id": "51cd4461.d2519c",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3052.8569107055664,
        "y": 712.8572120666504,
        "wires": [
            [
                "7c3779b5.acb7a8",
                "446dcef2.f8269"
            ]
        ]
    },
    {
        "id": "dda5173.4e0a2e8",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2948.571357727051,
        "y": 660,
        "wires": [
            [
                "c9c8bd5.60ff74"
            ]
        ]
    },
    {
        "id": "5ed758bc.59f6a8",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2800.7143211364746,
        "y": 660.0000514984131,
        "wires": [
            [
                "dda5173.4e0a2e8"
            ]
        ]
    },
    {
        "id": "c9d8dbec.623888",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2893.5714950561523,
        "y": 712.8571605682373,
        "wires": [
            [
                "51cd4461.d2519c"
            ]
        ]
    },
    {
        "id": "2a873b81.7ad144",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 2772.8571739196777,
        "y": 712.857159614563,
        "wires": [
            [
                "c9d8dbec.623888"
            ]
        ]
    },
    {
        "id": "b8c3a085.e3ebd",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================GET CURRENT STATE=================================",
        "info": "",
        "x": 2892.022975921631,
        "y": 595.8333587646484,
        "wires": []
    },
    {
        "id": "eace7234.4e6f3",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2617.737331390381,
        "y": 895.8333587646484,
        "wires": [
            [
                "eccb6c7d.f8a76"
            ],
            [
                "86df2517.5e4778"
            ]
        ]
    },
    {
        "id": "eccb6c7d.f8a76",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2807.737331390381,
        "y": 895.8333587646484,
        "wires": [
            [
                "fdde44d3.199c48"
            ]
        ]
    },
    {
        "id": "a79144b8.42aab8",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 3146.0706748962402,
        "y": 1005.4998836517334,
        "wires": []
    },
    {
        "id": "fdde44d3.199c48",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "15",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 3007.737331390381,
        "y": 895.8333587646484,
        "wires": [
            [
                "a79144b8.42aab8"
            ]
        ]
    },
    {
        "id": "7c3779b5.acb7a8",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.answer = [];\nmsg.text = [];\nmsg.error = [];\n\nif (msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        for (var i = 0; i < msg.items.length; i++) {\n            var current = msg.current[i].Data[0].Value;\n            if (current === false || current === 0){\n                var text1 = msg.items[i].name;\n                var text2 = \" ist aus\";\n                msg.text[i] = [text1, text2];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            if (current === true){\n                var text1 = msg.items[i].name;\n                var text2 = \" ist an\";\n                msg.text[i] = [text1, text2];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            if (current > 0 && current <256){\n                var current = precisionRound(current/2.55, 0);\n                var text1 = msg.items[i].name;\n                /*var text2 = \"'s luminosity is set to  \";\n                var text3 = \"percent\";*/\n                var text2 = \"Die Leuchtkraft des \";\n                var text3 = \"ist auf \";\n                var text4 = \"Prozent eingestellt\";\n                msg.text[i] = [text2, text1, text3, current, text4];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            msg.answer[i] = {\n                text: endText,\n                siteId: msg.cmd.siteId,\n                lang: \"de-DE\"\n            };\n        }\n    }\n    else if (msg.current[0].Result === \"false\") {\n        msg.error = {\n            text: \"Entschuldigung Der Server hat Ihren Befehl nicht verstanden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    }\n}\nelse {\n    msg.error = {\n        text: \"Entschuldigung, der Server antwortet nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2787.737331390381,
        "y": 835.8333587646484,
        "wires": [
            [
                "8cdc7542.d33a88",
                "fcf9f636.563738"
            ]
        ]
    },
    {
        "id": "aa6351b1.57e17",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK===================================",
        "info": "",
        "x": 2889.8324584960938,
        "y": 785.5555477142334,
        "wires": []
    },
    {
        "id": "63298a69.0171d4",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2823.071117401123,
        "y": 954.1670837402344,
        "wires": [
            [
                "35351701.719888"
            ]
        ]
    },
    {
        "id": "35351701.719888",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2968.0709800720215,
        "y": 954.1668395996094,
        "wires": [
            [
                "9238b986.3c1c18"
            ]
        ]
    },
    {
        "id": "9238b986.3c1c18",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 3127.737720489502,
        "y": 954.1667833328247,
        "wires": [
            [
                "a79144b8.42aab8"
            ]
        ]
    },
    {
        "id": "86df2517.5e4778",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "answer",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2655.7376670837402,
        "y": 954.1666288375854,
        "wires": [
            [
                "63298a69.0171d4"
            ]
        ]
    },
    {
        "id": "7308530a.337d7c",
        "type": "trigger",
        "z": "457ab65c.d54b38",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "1",
        "extend": true,
        "units": "s",
        "reset": "",
        "name": "",
        "x": 2628.214069366455,
        "y": 837.5002918243408,
        "wires": [
            [
                "7c3779b5.acb7a8"
            ]
        ]
    },
    {
        "id": "8cdc7542.d33a88",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 2967.737331390381,
        "y": 835.8333587646484,
        "wires": [
            [
                "eace7234.4e6f3"
            ]
        ]
    },
    {
        "id": "e9ebfe60.30473",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 2954.523334503174,
        "y": 1066.190668106079,
        "wires": [
            [
                "9a3b082d.e2ce08"
            ],
            [],
            []
        ]
    },
    {
        "id": "9a3b082d.e2ce08",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 3138.809127807617,
        "y": 1065.762041091919,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "d9d80bcc.7464e8",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2763.3519706726074,
        "y": 1065.7620010375977,
        "wires": [
            [
                "e9ebfe60.30473"
            ]
        ]
    },
    {
        "id": "d211c323.12d94",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Cmd ?",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "brighten",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "dim",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 1850,
        "y": 660,
        "wires": [
            [
                "edb501ea.27861"
            ],
            [
                "edb501ea.27861"
            ],
            [
                "1885f744.201ad9"
            ]
        ]
    },
    {
        "id": "575fa28c.9f532c",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "====================SET TARGET STATE OR ADAPT OLD TARGET STATE====================",
        "info": "",
        "x": 2110,
        "y": 600,
        "wires": []
    },
    {
        "id": "172d0b19.12e975",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================QUERY OR COMMAND==================================",
        "info": "",
        "x": 2510,
        "y": 500,
        "wires": []
    },
    {
        "id": "edb501ea.27861",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Current",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        x = x.toLowerCase();\n        x = x.split(\"   \");\n        if (x[1] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.lights, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.lights;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined && msg.cmd.device === undefined) {\n\tfindRoomByKey(msg.lights, 'name', msg.cmd.room);\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined && msg.cmd.device !== undefined) {\n    tmp = [];\n    findDeviceByKey(msg.lights, 'name', msg.cmd.device);\n\ttmp = msg.items;\n\tfindRoomByKey(tmp, 'name', msg.cmd.room);\n}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getCurrentUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1870,
        "y": 780,
        "wires": [
            [
                "d99845ff.f2b478"
            ]
        ]
    },
    {
        "id": "16874f83.96024",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 1870.000244140625,
        "y": 832.8571701049805,
        "wires": [
            [
                "817b1e98.d2357"
            ]
        ]
    },
    {
        "id": "6cddfe7e.64268",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2327.857280731201,
        "y": 780.0000514984131,
        "wires": [
            [
                "16874f83.96024"
            ]
        ]
    },
    {
        "id": "33ee2e5.9860cd2",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2292.8569107055664,
        "y": 832.8572120666504,
        "wires": [
            [
                "1885f744.201ad9",
                "446dcef2.f8269"
            ]
        ]
    },
    {
        "id": "df27955c.fcb528",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2188.571357727051,
        "y": 780,
        "wires": [
            [
                "6cddfe7e.64268"
            ]
        ]
    },
    {
        "id": "d99845ff.f2b478",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040.7143211364746,
        "y": 780.0000514984131,
        "wires": [
            [
                "df27955c.fcb528"
            ]
        ]
    },
    {
        "id": "50752759.e5eb18",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2133.5714950561523,
        "y": 832.8571605682373,
        "wires": [
            [
                "33ee2e5.9860cd2"
            ]
        ]
    },
    {
        "id": "817b1e98.d2357",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 2012.8571739196777,
        "y": 832.857159614563,
        "wires": [
            [
                "50752759.e5eb18"
            ]
        ]
    },
    {
        "id": "63cd018d.2e981",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================GET CURRENT STATE=================================",
        "info": "",
        "x": 2110,
        "y": 720,
        "wires": []
    },
    {
        "id": "41f20338.d7952c",
        "type": "inject",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"a81c0267-4d10-49ef-92c3-4cff16091bca\",\"customData\":null,\"siteId\":\"living room\",\"input\":\"turn of\",\"intent\":{\"intentName\":\"ProKNX:open_close_shutter\",\"probability\":0.7796378},\"slots\":[{\"rawValue\":\"what is\",\"value\":{\"kind\":\"Custom\",\"value\":\"what is\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"query\",\"slotName\":\"query\"},{\"rawValue\":\"living room\",\"value\":{\"kind\":\"Custom\",\"value\":\"living room\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"room\",\"slotName\":\"room\"},{\"rawValue\":\"ceiling\",\"value\":{\"kind\":\"Custom\",\"value\":\"ceiling\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"device\",\"slotName\":\"device\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 1870,
        "y": 1700,
        "wires": [
            [
                "282c4b83.6fe674"
            ]
        ]
    },
    {
        "id": "fcf9f636.563738",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "answer",
        "x": 3198.214069366455,
        "y": 897.5002918243408,
        "wires": []
    },
    {
        "id": "446dcef2.f8269",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "current[0].Data[0].Value",
        "x": 3228.214069366455,
        "y": 837.5002918243408,
        "wires": []
    },
    {
        "id": "3347a01f.2afdd",
        "type": "inject",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"a81c0267-4d10-49ef-92c3-4cff16091bca\",\"customData\":null,\"siteId\":\"living room\",\"input\":\"test\",\"intent\":{\"intentName\":\"ProKNX:open_close_shutter\",\"probability\":0.7796378},\"slots\":[{\"rawValue\":\"lower\",\"value\":{\"kind\":\"Custom\",\"value\":\"lower\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"cmd\",\"slotName\":\"cmd\"},{\"rawValue\":\"living room\",\"value\":{\"kind\":\"Custom\",\"value\":\"living room\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"room\",\"slotName\":\"room\"},{\"rawValue\":\"20\",\"value\":{\"kind\":\"Custom\",\"value\":\"20\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"value\",\"slotName\":\"value\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 1870,
        "y": 1760,
        "wires": [
            [
                "282c4b83.6fe674"
            ]
        ]
    },
    {
        "id": "9b2757af.d44b98",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "=================================================================================HOME AUTOMATION INTENTS===================================================================================",
        "info": "",
        "x": 4180,
        "y": 120,
        "wires": []
    },
    {
        "id": "cc9070c8.90fcb",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Query ?",
        "property": "cmd.query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2500,
        "y": 1920,
        "wires": [
            [
                "3ff6f894.5b2b28"
            ],
            [
                "d6682446.affad8"
            ]
        ]
    },
    {
        "id": "8d6f0f3c.24b2f",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "=================================QUERY OR COMMAND==================================",
        "info": "",
        "x": 2500,
        "y": 1880,
        "wires": []
    },
    {
        "id": "b296368.43581c8",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "url",
        "x": 2600,
        "y": 2720,
        "wires": []
    },
    {
        "id": "29344f2.44c3db",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "items",
        "x": 2610,
        "y": 2780,
        "wires": []
    },
    {
        "id": "d6682446.affad8",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Cmd ?",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "lower",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "higher",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 1830,
        "y": 2040,
        "wires": [
            [
                "d98bdef0.4dfc1"
            ],
            [
                "d98bdef0.4dfc1"
            ],
            [
                "c78d1e7b.8d997"
            ]
        ]
    },
    {
        "id": "6b731b2c.c01074",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "======================SET TARGET STATE OR ADAPT OLD TARGET STATE=====================",
        "info": "",
        "x": 2100,
        "y": 1980,
        "wires": []
    },
    {
        "id": "3ff6f894.5b2b28",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Current",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.shutters, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.shutters;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.shutters, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getCurrentUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2630,
        "y": 2040,
        "wires": [
            [
                "cae2270b.7fac18"
            ]
        ]
    },
    {
        "id": "e5a8f0d9.53e58",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2630.000244140625,
        "y": 2092.8571701049805,
        "wires": [
            [
                "6def6e63.2a643"
            ]
        ]
    },
    {
        "id": "33194720.e1e5c8",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 3087.857280731201,
        "y": 2040.000051498413,
        "wires": [
            [
                "e5a8f0d9.53e58"
            ]
        ]
    },
    {
        "id": "fab62ba1.c11358",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3052.8569107055664,
        "y": 2092.8572120666504,
        "wires": [
            [
                "c924b4cd.9523e8",
                "c4500758.989e58"
            ]
        ]
    },
    {
        "id": "50f628eb.f70318",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2948.571357727051,
        "y": 2040,
        "wires": [
            [
                "33194720.e1e5c8"
            ]
        ]
    },
    {
        "id": "cae2270b.7fac18",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2800.7143211364746,
        "y": 2040.000051498413,
        "wires": [
            [
                "50f628eb.f70318"
            ]
        ]
    },
    {
        "id": "a3a1826.ae5648",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2893.5714950561523,
        "y": 2092.8571605682373,
        "wires": [
            [
                "fab62ba1.c11358"
            ]
        ]
    },
    {
        "id": "6def6e63.2a643",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 2772.8571739196777,
        "y": 2092.857159614563,
        "wires": [
            [
                "a3a1826.ae5648"
            ]
        ]
    },
    {
        "id": "43915244.8b3e5c",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================GET CURRENT STATE=================================",
        "info": "",
        "x": 2892.022975921631,
        "y": 1975.8333587646484,
        "wires": []
    },
    {
        "id": "c61c321f.d35d4",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2617.737331390381,
        "y": 2275.8333587646484,
        "wires": [
            [
                "ac999a55.f8cdf8"
            ],
            [
                "18954d62.80cbf3"
            ]
        ]
    },
    {
        "id": "ac999a55.f8cdf8",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2807.737331390381,
        "y": 2275.8333587646484,
        "wires": [
            [
                "633fa1c2.244fc"
            ]
        ]
    },
    {
        "id": "ef8f7c2a.23cbc",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 3146.0706748962402,
        "y": 2385.4998836517334,
        "wires": []
    },
    {
        "id": "633fa1c2.244fc",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "15",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 3007.737331390381,
        "y": 2275.8333587646484,
        "wires": [
            [
                "ef8f7c2a.23cbc"
            ]
        ]
    },
    {
        "id": "c924b4cd.9523e8",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.answer = [];\nmsg.text = [];\nmsg.error = [];\n\nif (msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        for (var i = 0; i < msg.items.length; i++) {\n            var current = msg.current[i].Data[0].Value;\n            if (current === false || current === 0){\n                var text1 = msg.items[i].name;\n                //var text2 = \" is fully open\";\n                var text2 = \" ist geoffnet\";\n                msg.text[i] = [text1, text2];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            if (current === true || current === 255){\n                var text1 = msg.items[i].name;\n                //var text2 = \" is closed\";\n                var text2 = \"ist geschlossen\"; \n                msg.text[i] = [text1, text2];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            if (current > 0 && current <255){\n                var current = precisionRound((255-current)/2.55, 0);\n                var text1 = msg.items[i].zone;\n                /*var text2 = \" is \";\n                var text3 = \" percent open\";\n                msg.text[i] = [text1, text2, current, text3];*/\n                var text2 = \" ist auf \";\n                var text3 = \" Prozent gestellt\";\n                msg.text[i] = [text1, text2, current, text3];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            msg.answer[i] = {\n                text: endText,\n                siteId: msg.cmd.siteId\n            };\n        }\n    }\n    else if (msg.payload.Result === \"false\") {\n        msg.payload = {\n            text: \"Entschuldigung Der Server hat Ihren Befehl nicht verstanden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    }\n}\nelse {\n    msg.payload = {\n        text: \"Entschuldigung Der Server antwortet nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2787.737331390381,
        "y": 2215.8333587646484,
        "wires": [
            [
                "43850f8c.d4c75",
                "43b230ed.c657"
            ]
        ]
    },
    {
        "id": "97960c6.08583f",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK===================================",
        "info": "",
        "x": 2889.8324584960938,
        "y": 2165.5555477142334,
        "wires": []
    },
    {
        "id": "7a307775.d4a5f8",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2823.071117401123,
        "y": 2334.1670837402344,
        "wires": [
            [
                "a9a3017b.19821"
            ]
        ]
    },
    {
        "id": "a9a3017b.19821",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2968.0709800720215,
        "y": 2334.1668395996094,
        "wires": [
            [
                "92ab9e4d.fa961"
            ]
        ]
    },
    {
        "id": "92ab9e4d.fa961",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 3127.737720489502,
        "y": 2334.1667833328247,
        "wires": [
            [
                "ef8f7c2a.23cbc"
            ]
        ]
    },
    {
        "id": "18954d62.80cbf3",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "answer",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2655.7376670837402,
        "y": 2334.1666288375854,
        "wires": [
            [
                "7a307775.d4a5f8"
            ]
        ]
    },
    {
        "id": "139a7d19.00e3a3",
        "type": "trigger",
        "z": "457ab65c.d54b38",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "1",
        "extend": true,
        "units": "s",
        "reset": "",
        "name": "",
        "x": 2628.214069366455,
        "y": 2217.500291824341,
        "wires": [
            [
                "c924b4cd.9523e8"
            ]
        ]
    },
    {
        "id": "43850f8c.d4c75",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 2967.737331390381,
        "y": 2215.8333587646484,
        "wires": [
            [
                "c61c321f.d35d4"
            ]
        ]
    },
    {
        "id": "28c66836.ee9328",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 2954.523334503174,
        "y": 2446.190668106079,
        "wires": [
            [
                "78ceaf73.34ca8"
            ],
            [],
            []
        ]
    },
    {
        "id": "78ceaf73.34ca8",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 3138.809127807617,
        "y": 2445.762041091919,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "63f99428.0f345c",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2763.3519706726074,
        "y": 2445.7620010375977,
        "wires": [
            [
                "28c66836.ee9328"
            ]
        ]
    },
    {
        "id": "43b230ed.c657",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "answer",
        "x": 3198.214069366455,
        "y": 2277.500291824341,
        "wires": []
    },
    {
        "id": "c4500758.989e58",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "current[0].Data[0].Value",
        "x": 3240,
        "y": 1860,
        "wires": []
    },
    {
        "id": "70c4b1c.4bb135",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "shutters",
        "x": 3010,
        "y": 1820,
        "wires": []
    },
    {
        "id": "d98bdef0.4dfc1",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Current",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.shutters, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.shutters;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.shutters, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getCurrentUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nif (msg.items[0] === undefined) {\n    msg.error = {\n        text: \"Entschuldigung, es gibt keinen Verschluss in diesem Raum\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1830,
        "y": 2160,
        "wires": [
            [
                "5d43f25b.b5b9fc",
                "29344f2.44c3db"
            ]
        ]
    },
    {
        "id": "c20137e.ba58ec8",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 1830.000244140625,
        "y": 2212.8571701049805,
        "wires": [
            [
                "acad2a10.410de8"
            ]
        ]
    },
    {
        "id": "3fd153f1.21c36c",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2287.857280731201,
        "y": 2160.000051498413,
        "wires": [
            [
                "c20137e.ba58ec8"
            ]
        ]
    },
    {
        "id": "12f37e43.a295a2",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2252.8569107055664,
        "y": 2212.8572120666504,
        "wires": [
            [
                "c78d1e7b.8d997",
                "c4500758.989e58"
            ]
        ]
    },
    {
        "id": "1ce4b91c.d0df37",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2148.571357727051,
        "y": 2160,
        "wires": [
            [
                "3fd153f1.21c36c"
            ]
        ]
    },
    {
        "id": "5d43f25b.b5b9fc",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2000.7143211364746,
        "y": 2160.000051498413,
        "wires": [
            [
                "1ce4b91c.d0df37"
            ]
        ]
    },
    {
        "id": "4a99e70.ad6ae18",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2093.5714950561523,
        "y": 2212.8571605682373,
        "wires": [
            [
                "12f37e43.a295a2"
            ]
        ]
    },
    {
        "id": "acad2a10.410de8",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 1972.8571739196777,
        "y": 2212.857159614563,
        "wires": [
            [
                "4a99e70.ad6ae18"
            ]
        ]
    },
    {
        "id": "f62811a5.5c4c9",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================GET CURRENT STATE===================================",
        "info": "",
        "x": 2102.022975921631,
        "y": 2095.8333587646484,
        "wires": []
    },
    {
        "id": "10343d94.9290e2",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.cmd",
        "x": 2280,
        "y": 2040,
        "wires": []
    },
    {
        "id": "4b7a75e0.df2bdc",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "url",
        "x": 2760.200073242187,
        "y": 1257.9999999999998,
        "wires": []
    },
    {
        "id": "5ed35bd5.772e34",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Array_scenesAux",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction findObjectByKey(array, key, value) {\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            return array[i];\n        }\n    }\n    return null;\n}\n\nvar rawCmd = findObjectByKey(msg.payload.slots, 'slotName', 'cmd');\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'device');\nvar rawAll = findObjectByKey(msg.payload.slots, 'slotName', 'all');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nvar rawHere = findObjectByKey(msg.payload.slots, 'slotName', 'here');\nvar rawQuery = findObjectByKey(msg.payload.slots, 'slotName', 'query');\n\nmsg.cmd = [];\nif (rawCmd !== null) {\n\trawCmd.value.value = rawCmd.value.value.toLowerCase();\n\tif (rawCmd.value.value === \"activate\" || rawCmd.value.value === \"aktiviere\" || rawCmd.value.value === \"mache\") {\n        msg.cmd.cmd = \"activate\";\n    } else if (rawCmd.value.value === \"deactivate\" || rawCmd.value.value === \"deaktiviere\") {\n        msg.cmd.cmd = \"deactivate\";\n    } else if (rawCmd.value.value === \"set\" || rawCmd.value.value === \"stelle\") {\n        msg.cmd.cmd = \"set\";\n    }\n}\nif (rawRoom !== null) {\n\tmsg.cmd.room = rawRoom.value.value.toLowerCase().sansAccent();\n} else if (rawAll === null) {\n    msg.cmd.room = msg.payload.siteId;\n}\nif (rawDevice !== null && rawDevice.value.value) {\n\tmsg.cmd.device = rawDevice.value.value.toLowerCase().sansAccent();\n}\nif (rawAll !== null) {\n\tmsg.cmd.all = rawAll.value.value;\n}\nif (rawValue !== null) {\n\tmsg.cmd.value = rawValue.value.value;\n}\nif (rawHere !== null) {\n\tmsg.cmd.room = msg.payload.siteId;\n}\nif (rawQuery !== null) {\n\tmsg.cmd.query = rawQuery.value.value;\n}\nmsg.cmd.siteId = msg.payload.siteId;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3970,
        "y": 1760,
        "wires": [
            [
                "6081d559.0338bc",
                "84804810.146f48",
                "ccec7187.4e5c9",
                "c55e3fef.11fbe",
                "bacd4d11.a6a0c"
            ]
        ]
    },
    {
        "id": "50100a98.1abdc4",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/rest/alexa/skill/items",
        "tls": "",
        "x": 4170,
        "y": 1820,
        "wires": [
            [
                "f536ebff.70e338"
            ]
        ]
    },
    {
        "id": "f536ebff.70e338",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 4330,
        "y": 1820,
        "wires": [
            [
                "6bd44c72.0f48a4"
            ]
        ]
    },
    {
        "id": "6bd44c72.0f48a4",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "List_scenesAux",
        "func": "function findScenesByKey(array, key, value) {\n    msg.payload.scenes = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.scenes[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findAuxByKey(array, key, value) {\n    msg.payload.aux = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.aux[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfindScenesByKey(msg.payload, 'type', 'scenes');\nfindAuxByKey(msg.payload, 'type', 'aux');\n\nmsg.scenesAux = msg.payload.scenes.concat(msg.payload.aux);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4500,
        "y": 1820,
        "wires": [
            [
                "f2e1e7e6.8c7138",
                "4e91e705.2f2c88"
            ]
        ]
    },
    {
        "id": "4c72cee0.678e3",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Prepare_request",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\n//put an array of objets matching the type of device given in parameters in msg.room\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        x = x.toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[1] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.device !== undefined && msg.cmd.room === undefined) {\n\tfindDeviceByKey(msg.scenesAux, 'name', msg.cmd.device);\n} else if (msg.cmd.all !== undefined && msg.cmd.room !== undefined && msg.cmd.device === undefined) {\n\tfindRoomByKey(msg.scenesAux, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined && msg.cmd.device === undefined) {\n\tmsg.items = msg.scenesAux;\n} else if (msg.cmd.room !== undefined && msg.cmd.device !== undefined) {\n    tmp = [];\n    findDeviceByKey(msg.scenesAux, 'name', msg.cmd.device);\n\ttmp = msg.items;\n\tfindRoomByKey(tmp, 'name', msg.cmd.room);\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined && msg.cmd.device === undefined) {\n\tfindRoomByKey(msg.scenesAux, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for \"SET\" commands and put them in msg.url\nmsg.url = [];\n/*if (msg.cmd.cmd ===\"increase\") {\n    for (var i = 0; i < msg.items.length; i++) {\n   \t\tif (msg.items[i].type === \"dimmers\") {\n   \t\t    if (msg.cmd.value !== undefined){\n   \t\t\t    var val = msg.cmd.value*2.55;\n   \t\t\t    val = precisionRound(val, 1);\n   \t\t\t    var newVal = msg.current[i].Data[0].Value+val;\n   \t\t\t    if (newVal > 255) {\n   \t\t    \t    newVal = 255;\n   \t\t        }\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t\t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t    else {\n   \t\t        var newVal = msg.current[i].Data[0].Value+51;\n   \t\t\t    if (newVal > 255) {\n   \t\t    \t    newVal = 255;\n   \t\t        }\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t\t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t}\n   \t\telse {\n\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t}\n\t}\n}\nelse if (msg.cmd.cmd ===\"decrease\") {\n    for (var i = 0; i < msg.items.length; i++) {\n   \t\tif (msg.items[i].type === \"dimmers\") {\n   \t\t    if (msg.cmd.value !== undefined) {\n   \t\t        var val = msg.cmd.value*2.55;\n   \t\t    \tval = precisionRound(val, 1);\n   \t\t    \tvar newVal = msg.current[i].Data[0].Value-val;\n   \t\t    \tif (newVal < 0) {\n   \t\t    \t    newVal = 0;\n   \t\t    \t}\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t    \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t    else {\n   \t\t        var newVal = msg.current[i].Data[0].Value-51;\n   \t\t    \tif (newVal < 0) {\n   \t\t    \t    newVal = 0;\n   \t\t    \t}\n   \t\t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n   \t\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n   \t    \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t    }\n   \t\t\t\n   \t\t} \n   \t\telse {\n\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t}\n\t}\n}\nelse*/ if (msg.cmd.cmd === \"activate\") {\n    if (msg.cmd.value !== undefined) {\n       \tfor (var i = 0; i < msg.items.length; i++) {\n       \t\tif (msg.items[i].setDimUrl !== undefined) {\n       \t\t\tvar val = msg.cmd.value*2.55;\n       \t\t\tval = precisionRound(val, 1);\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n       \t\t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n       \t\t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t} \n       \t\telse if (msg.cmd.value > 0) {\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n       \t\telse {\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n    \t}\n    }\n    else {\n\t    for (var i = 0; i < msg.items.length; i++) {\n\t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n   \t    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n\t    }\n    }\n}\nelse if (msg.cmd.cmd === \"deactivate\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tif (msg.items[i].setOffUrl !== undefined) {\n    \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n       \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n\t}\n} \nelse if (msg.cmd.cmd !== \"activate\" && msg.cmd.cmd !== \"deactivate\" && msg.cmd.cmd !== \"brighten\" && msg.cmd.cmd !== \"dim\") {\n   msg.error = {\n        text: \"Entschuldigung, ich habe deinen Befehl nicht verstanden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    }; \n}\n\nif (msg.url[0] === undefined && msg.items[0] !== undefined && msg.error === undefined) {\n    msg.error = {\n        text: \"Dieses Gerät unterstützt diesen Befehl nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nif (msg.items[0] === undefined && msg.error === undefined) {\n    msg.error = {\n        text: \"Entschuldigung, ich kann dieses Gerät nicht finden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3570,
        "y": 2340,
        "wires": [
            [
                "890d65.9e433298",
                "1c04b03c.20a06",
                "7ed5f4ad.cfddcc",
                "fe26dc8d.429ef"
            ]
        ]
    },
    {
        "id": "4b000950.6fc098",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "Send URL",
        "method": "GET",
        "ret": "obj",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 3553.3333892822266,
        "y": 2465.0000648498535,
        "wires": [
            [
                "f1cae4a4.5896c8"
            ]
        ]
    },
    {
        "id": "1a025df7.151ab2",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 3916.666648864746,
        "y": 2339.9999809265137,
        "wires": [
            [
                "ffe64fd6.f6052"
            ]
        ]
    },
    {
        "id": "890d65.9e433298",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3764.999984741211,
        "y": 2339.999979019165,
        "wires": [
            [
                "1a025df7.151ab2"
            ]
        ]
    },
    {
        "id": "ffe64fd6.f6052",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4056.666679382324,
        "y": 2341.6665630340576,
        "wires": [
            [
                "4b000950.6fc098"
            ]
        ]
    },
    {
        "id": "d8113c50.ce90d",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET ProServIP",
        "method": "GET",
        "ret": "txt",
        "url": "http://{{{payload}}}:3000/proservip",
        "tls": "",
        "x": 4480,
        "y": 1760,
        "wires": [
            [
                "e491469e.8d7038"
            ]
        ]
    },
    {
        "id": "e491469e.8d7038",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "proServIP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3970,
        "y": 1820,
        "wires": [
            [
                "50100a98.1abdc4"
            ]
        ]
    },
    {
        "id": "b0f2c13d.a41bb",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 4093.71427154541,
        "y": 2582.3332653045654,
        "wires": []
    },
    {
        "id": "f1cae4a4.5896c8",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "if (msg.payload.Result === true) {\n    msg.payload = {\n        text: \"Okay\",\n        siteId: msg.cmd.siteId\n    };\n}\nelse if (msg.payload.Result === \"false\") {\n    msg.payload = {\n        text: \"Entschuldigung Der Server hat Ihren Befehl nicht verstanden\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\nelse {\n    msg.payload = {\n        text: \"Entschuldigung Der Server antwortet nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3550.000024795532,
        "y": 2626.6667833328247,
        "wires": [
            [
                "8d13ade0.79087"
            ]
        ]
    },
    {
        "id": "1c04b03c.20a06",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 3539.99995803833,
        "y": 2583.3331003189087,
        "wires": [
            [
                "251b3e11.d07162"
            ]
        ]
    },
    {
        "id": "251b3e11.d07162",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3689.99995803833,
        "y": 2583.3331003189087,
        "wires": [
            [
                "e12ba1b1.1541a"
            ]
        ]
    },
    {
        "id": "e12ba1b1.1541a",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "15",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 3869.99995803833,
        "y": 2583.3331003189087,
        "wires": [
            [
                "b0f2c13d.a41bb"
            ]
        ]
    },
    {
        "id": "d3f15553.5bdfa8",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK===================================",
        "info": "",
        "x": 3810,
        "y": 2520,
        "wires": []
    },
    {
        "id": "5b7108f1.022258",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================SCENES/AUX CONTROL================================",
        "info": "",
        "x": 4210,
        "y": 1620,
        "wires": []
    },
    {
        "id": "9cd94b65.912308",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "==============================REQUEST CONSTRUCTION==============================",
        "info": "",
        "x": 3810,
        "y": 2280,
        "wires": []
    },
    {
        "id": "8e6d4ad3.af7178",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================DEVICES DETECTION=================================",
        "info": "",
        "x": 4210,
        "y": 1700,
        "wires": []
    },
    {
        "id": "2b5a4e6b.5125f2",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================REQUEST EXECUTION=================================",
        "info": "",
        "x": 3810,
        "y": 2420,
        "wires": []
    },
    {
        "id": "8d13ade0.79087",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "All ?",
        "property": "cmd.device",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 3698.333206176758,
        "y": 2629.999782562256,
        "wires": [
            [
                "e12ba1b1.1541a"
            ],
            [
                "2be33579.80a01a"
            ],
            [
                "b0f2c13d.a41bb"
            ]
        ]
    },
    {
        "id": "8314bd47.f3415",
        "type": "link in",
        "z": "457ab65c.d54b38",
        "name": "Scenes/Aux Intent OUT",
        "links": [
            "e3abcdd7.550c4"
        ],
        "x": 3895,
        "y": 1660,
        "wires": [
            [
                "5ed35bd5.772e34"
            ]
        ]
    },
    {
        "id": "2be33579.80a01a",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "6",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 3869.99995803833,
        "y": 2623.3331003189087,
        "wires": [
            [
                "b0f2c13d.a41bb"
            ]
        ]
    },
    {
        "id": "6081d559.0338bc",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "sudo ip addr show eth0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP",
        "x": 4150,
        "y": 1760,
        "wires": [
            [
                "a634349e.cca788"
            ],
            [],
            []
        ]
    },
    {
        "id": "a634349e.cca788",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Trim answer",
        "func": "msg.payload = msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4310,
        "y": 1760,
        "wires": [
            [
                "d8113c50.ce90d"
            ]
        ]
    },
    {
        "id": "b0ac8e96.e497c",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 3899.99995803833,
        "y": 2703.3331003189087,
        "wires": [
            [
                "4212a054.fefde"
            ],
            [],
            []
        ]
    },
    {
        "id": "4212a054.fefde",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 4084.2857513427734,
        "y": 2702.9044733047485,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "48a1f97e.264248",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3708.8285942077637,
        "y": 2702.9044332504272,
        "wires": [
            [
                "b0ac8e96.e497c"
            ]
        ]
    },
    {
        "id": "f2e1e7e6.8c7138",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Query ?",
        "property": "cmd.query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 4200,
        "y": 1940,
        "wires": [
            [
                "6cc45889.bd0ff8"
            ],
            [
                "95772ba8.56dd88"
            ]
        ]
    },
    {
        "id": "6cc45889.bd0ff8",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Current",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value && array[i].getCurrentUrl !== undefined) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.scenesAux, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.scenesAux;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.scenesAux, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nvar cpt = 0;\nfor (var i = 0; i < msg.items.length; i++) {\n\tif (msg.items[i].getCurrentUrl !== undefined) {\n    \tmsg.url[cpt] = [msg.proServIP, msg.items[i].getCurrentUrl];\n    \tmsg.url[cpt] = \"\".concat(...msg.url[cpt]);\n    \tcpt ++;\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4330,
        "y": 2060,
        "wires": [
            [
                "8dda3354.d7357",
                "7ed5f4ad.cfddcc",
                "c55a21c2.d3f1d"
            ]
        ]
    },
    {
        "id": "ff811928.63bf28",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 4330.000244140625,
        "y": 2112.8571701049805,
        "wires": [
            [
                "40f7bf4b.21839"
            ]
        ]
    },
    {
        "id": "67cff451.4ecafc",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4787.857280731201,
        "y": 2060.000051498413,
        "wires": [
            [
                "ff811928.63bf28"
            ]
        ]
    },
    {
        "id": "ec6dc10f.4af41",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4752.856910705566,
        "y": 2112.8572120666504,
        "wires": [
            [
                "3c7a2391.e660cc",
                "7f63ece7.053904"
            ]
        ]
    },
    {
        "id": "15f012b4.f95cfd",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 4648.571357727051,
        "y": 2060,
        "wires": [
            [
                "67cff451.4ecafc"
            ]
        ]
    },
    {
        "id": "8dda3354.d7357",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4500.714321136475,
        "y": 2060.000051498413,
        "wires": [
            [
                "15f012b4.f95cfd"
            ]
        ]
    },
    {
        "id": "30553490.243c2c",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 4593.571495056152,
        "y": 2112.8571605682373,
        "wires": [
            [
                "ec6dc10f.4af41"
            ]
        ]
    },
    {
        "id": "40f7bf4b.21839",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 4472.857173919678,
        "y": 2112.857159614563,
        "wires": [
            [
                "30553490.243c2c"
            ]
        ]
    },
    {
        "id": "f72a9a3b.55c5c8",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================GET CURRENT STATE=================================",
        "info": "",
        "x": 4592.022975921631,
        "y": 1995.8333587646484,
        "wires": []
    },
    {
        "id": "c430fc26.53e7d",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Error ?",
        "property": "error.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 4317.737331390381,
        "y": 2295.8333587646484,
        "wires": [
            [
                "f6b05dcc.68946"
            ],
            [
                "4ace6d99.5d3294"
            ]
        ]
    },
    {
        "id": "f6b05dcc.68946",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4507.737331390381,
        "y": 2295.8333587646484,
        "wires": [
            [
                "681a7ae7.d29854"
            ]
        ]
    },
    {
        "id": "f517f57a.82e5f8",
        "type": "mqtt out",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "58784e8d.6ca16",
        "x": 4846.07067489624,
        "y": 2405.4998836517334,
        "wires": []
    },
    {
        "id": "681a7ae7.d29854",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "15",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 4707.737331390381,
        "y": 2295.8333587646484,
        "wires": [
            [
                "f517f57a.82e5f8"
            ]
        ]
    },
    {
        "id": "3c7a2391.e660cc",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.answer = [];\nmsg.text = [];\nmsg.error = [];\n\nif (msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        for (var i = 0; i < msg.items.length; i++) {\n            var current = msg.current[0].Data[0].Value;\n            if (current === false || current === 0){\n                var text1 = msg.items[i].name;\n                var text2 = \" ist aus\";\n                msg.text[i] = [text1, text2];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            if (current === true){\n                var text1 = msg.items[i].name;\n                var text2 = \" ist an\";\n                msg.text[i] = [text1, text2];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            if (current > 0 && current <256){\n                var current = precisionRound(current/2.55, 0);\n                var text1 = msg.items[i].name;\n                var text2 = \" ist auf \";\n                var text3 = \" Prozent gestellt\";\n                msg.text[i] = [text1, text2, current, text3];\n                var endText = \"\".concat(...msg.text[i]);\n            }\n            msg.answer[i] = {\n                text: endText,\n                siteId: msg.cmd.siteId,\n                lang:\"de-DE\"\n            };\n        }\n    }\n    else if (msg.payload.Result === \"false\") {\n        msg.payload = {\n            text: \"Entschuldigung Der Server hat Ihren Befehl nicht verstanden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    }\n}\nelse {\n    msg.payload = {\n        text: \"Entschuldigung Der Server antwortet nicht\",\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4487.737331390381,
        "y": 2235.8333587646484,
        "wires": [
            [
                "2c71a1ed.1c415e",
                "a3a95048.e4cbf"
            ]
        ]
    },
    {
        "id": "3dcf742a.2a904c",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================SPOKEN FEEDBACK===================================",
        "info": "",
        "x": 4589.832458496094,
        "y": 2185.5555477142334,
        "wires": []
    },
    {
        "id": "8b4bfee3.24902",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 4523.071117401123,
        "y": 2354.1670837402344,
        "wires": [
            [
                "893d6d86.eafe7"
            ]
        ]
    },
    {
        "id": "893d6d86.eafe7",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4668.0709800720215,
        "y": 2354.1668395996094,
        "wires": [
            [
                "9144a6da.b0a118"
            ]
        ]
    },
    {
        "id": "9144a6da.b0a118",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4827.737720489502,
        "y": 2354.1667833328247,
        "wires": [
            [
                "f517f57a.82e5f8"
            ]
        ]
    },
    {
        "id": "4ace6d99.5d3294",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "answer",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4355.73766708374,
        "y": 2354.1666288375854,
        "wires": [
            [
                "8b4bfee3.24902"
            ]
        ]
    },
    {
        "id": "8f9261d4.da2e1",
        "type": "trigger",
        "z": "457ab65c.d54b38",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "1",
        "extend": true,
        "units": "s",
        "reset": "",
        "name": "",
        "x": 4328.214069366455,
        "y": 2237.500291824341,
        "wires": [
            [
                "3c7a2391.e660cc"
            ]
        ]
    },
    {
        "id": "2c71a1ed.1c415e",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 4667.737331390381,
        "y": 2235.8333587646484,
        "wires": [
            [
                "c430fc26.53e7d"
            ]
        ]
    },
    {
        "id": "9ba77a01.1c5eb8",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Generate response",
        "x": 4654.523334503174,
        "y": 2466.190668106079,
        "wires": [
            [
                "3d6c6dee.49b1e2"
            ],
            [],
            []
        ]
    },
    {
        "id": "3d6c6dee.49b1e2",
        "type": "exec",
        "z": "457ab65c.d54b38",
        "command": "su pi -c \"mplayer /usr/share/snips/snips_feedback/response.wav\"",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Play Response",
        "x": 4838.809127807617,
        "y": 2465.762041091919,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "89bece34.4295e",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "Build command",
        "func": "text = \nmsg.payload = \"pico2wave -w '/usr/share/snips/snips_feedback/response.wav' -l 'en-GB' '\" + msg.payload.text + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 4463.351970672607,
        "y": 2465.7620010375977,
        "wires": [
            [
                "9ba77a01.1c5eb8"
            ]
        ]
    },
    {
        "id": "95772ba8.56dd88",
        "type": "switch",
        "z": "457ab65c.d54b38",
        "name": "Cmd ?",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "brighten",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "dim",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 3550,
        "y": 2060,
        "wires": [
            [
                "1f7b3374.3a9abd"
            ],
            [
                "1f7b3374.3a9abd"
            ],
            [
                "4c72cee0.678e3"
            ]
        ]
    },
    {
        "id": "a48d7d66.7f121",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "====================SET TARGET STATE OR ADAPT OLD TARGET STATE====================",
        "info": "",
        "x": 3810,
        "y": 2000,
        "wires": []
    },
    {
        "id": "88d85302.18a1f",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "===============================QUERY OR COMMAND==================================",
        "info": "",
        "x": 4210,
        "y": 1900,
        "wires": []
    },
    {
        "id": "1f7b3374.3a9abd",
        "type": "function",
        "z": "457ab65c.d54b38",
        "name": "GET_Current",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\n//put an array of objets located in the room given in parameters in msg.room\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[0] === value && array[i].getCurrentUrl !== undefined) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\n//put an array of objects that the user want to control in msg.items, error if his request is to vague\nif (msg.cmd.all !== undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.scenesAux, 'name', msg.cmd.room);\n}else if (msg.cmd.all !== undefined && msg.cmd.room === undefined) {\n\tmsg.items = msg.scenesAux;\n} else if (msg.cmd.all === undefined && msg.cmd.room !== undefined) {\n\tfindRoomByKey(msg.scenesAux, 'name', msg.cmd.room);\n} else {}\n\n//Prepare all HTTP requests for GET Current Temp and put them in msg.url\nmsg.url = [];\nvar cpt = 0;\nfor (var i = 0; i < msg.items.length; i++) {\n\tif (msg.items[i].getCurrentUrl !== undefined) {\n    \tmsg.url[cpt] = [msg.proServIP, msg.items[i].getCurrentUrl];\n    \tmsg.url[cpt] = \"\".concat(...msg.url[cpt]);\n    \tcpt ++;\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3570,
        "y": 2180,
        "wires": [
            [
                "a048a869.690c98"
            ]
        ]
    },
    {
        "id": "d1da6494.a6e158",
        "type": "http request",
        "z": "457ab65c.d54b38",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 3570.000244140625,
        "y": 2232.8571701049805,
        "wires": [
            [
                "10fece16.2128f2"
            ]
        ]
    },
    {
        "id": "c3793211.a7287",
        "type": "delay",
        "z": "457ab65c.d54b38",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 4027.857280731201,
        "y": 2180.000051498413,
        "wires": [
            [
                "d1da6494.a6e158"
            ]
        ]
    },
    {
        "id": "5a2c4306.869acc",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3992.8569107055664,
        "y": 2232.8572120666504,
        "wires": [
            [
                "4c72cee0.678e3",
                "7f63ece7.053904"
            ]
        ]
    },
    {
        "id": "b2337a3d.306368",
        "type": "split",
        "z": "457ab65c.d54b38",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 3888.571357727051,
        "y": 2180,
        "wires": [
            [
                "c3793211.a7287"
            ]
        ]
    },
    {
        "id": "a048a869.690c98",
        "type": "change",
        "z": "457ab65c.d54b38",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3740.7143211364746,
        "y": 2180.000051498413,
        "wires": [
            [
                "b2337a3d.306368"
            ]
        ]
    },
    {
        "id": "ba17b3a9.9e41b",
        "type": "join",
        "z": "457ab65c.d54b38",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 3833.5714950561523,
        "y": 2232.8571605682373,
        "wires": [
            [
                "5a2c4306.869acc"
            ]
        ]
    },
    {
        "id": "10fece16.2128f2",
        "type": "json",
        "z": "457ab65c.d54b38",
        "name": "",
        "pretty": false,
        "x": 3712.8571739196777,
        "y": 2232.857159614563,
        "wires": [
            [
                "ba17b3a9.9e41b"
            ]
        ]
    },
    {
        "id": "9fb7f9a4.61bb68",
        "type": "comment",
        "z": "457ab65c.d54b38",
        "name": "================================GET CURRENT STATE=================================",
        "info": "",
        "x": 3810,
        "y": 2120,
        "wires": []
    },
    {
        "id": "a3a95048.e4cbf",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "answer",
        "x": 4898.214069366455,
        "y": 2297.500291824341,
        "wires": []
    },
    {
        "id": "7f63ece7.053904",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "current[0]",
        "x": 4780,
        "y": 1940,
        "wires": []
    },
    {
        "id": "7ed5f4ad.cfddcc",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "url",
        "x": 4460.2000732421875,
        "y": 2658,
        "wires": []
    },
    {
        "id": "a7b2e8a7.d96478",
        "type": "inject",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"d5aea111-3879-4095-8fbf-bb8443705a09\",\"customData\":null,\"siteId\":\"wohnzimmer\",\"input\":\"aktiviere schrank links\",\"intent\":{\"intentName\":\"ProKNX:control_scenes_aux\",\"probability\":1},\"slots\":[{\"rawValue\":\"deaktiviere\",\"value\":{\"kind\":\"Custom\",\"value\":\"deaktiviere\"},\"range\":{\"start\":0,\"end\":9},\"entity\":\"cmd_aux\",\"slotName\":\"cmd\"},{\"rawValue\":\"schrank links\",\"value\":{\"kind\":\"Custom\",\"value\":\"schrank links\"},\"range\":{\"start\":10,\"end\":23},\"entity\":\"device_aux\",\"slotName\":\"device\"},{\"rawValue\":\"Kuche\",\"value\":{\"kind\":\"Custom\",\"value\":\"Kuche\"},\"range\":{\"start\":10,\"end\":23},\"entity\":\"room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 3710,
        "y": 1760,
        "wires": [
            [
                "5ed35bd5.772e34"
            ]
        ]
    },
    {
        "id": "4e91e705.2f2c88",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "scenesAux",
        "x": 4780,
        "y": 1820,
        "wires": []
    },
    {
        "id": "c55a21c2.d3f1d",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "items",
        "x": 4705.399902343749,
        "y": 2659.9999999999995,
        "wires": []
    },
    {
        "id": "5d606152.24a67",
        "type": "inject",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"a81c0267-4d10-49ef-92c3-4cff16091bca\",\"customData\":null,\"siteId\":\"living room\",\"input\":\"turn of\",\"intent\":{\"intentName\":\"ProKNX:open_close_shutter\",\"probability\":0.7796378},\"slots\":[{\"rawValue\":\"what is\",\"value\":{\"kind\":\"Custom\",\"value\":\"what is\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"query\",\"slotName\":\"query\"},{\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"room\",\"slotName\":\"room\"},{\"rawValue\":\"ceiling\",\"value\":{\"kind\":\"Custom\",\"value\":\"ceiling\"},\"range\":{\"start\":0,\"end\":7},\"entity\":\"device\",\"slotName\":\"device\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 1850,
        "y": 1860,
        "wires": [
            [
                "759b19ae.d71ae8"
            ]
        ]
    },
    {
        "id": "57c04f7f.bc513",
        "type": "mqtt in",
        "z": "457ab65c.d54b38",
        "name": "",
        "topic": "hermes/intent/ProKNX:control_scenes_aux",
        "qos": "2",
        "broker": "58784e8d.6ca16",
        "x": 600,
        "y": 400,
        "wires": [
            [
                "98401467.a23348"
            ]
        ]
    },
    {
        "id": "e3abcdd7.550c4",
        "type": "link out",
        "z": "457ab65c.d54b38",
        "name": "Scenes/Aux Intent IN",
        "links": [
            "8314bd47.f3415"
        ],
        "x": 1115,
        "y": 400,
        "wires": []
    },
    {
        "id": "c9cfe68a.3d74d8",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 1399.0000406901033,
        "y": 306.6666666666665,
        "wires": []
    },
    {
        "id": "383a442c.e188cc",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.room",
        "x": 3080,
        "y": 380,
        "wires": []
    },
    {
        "id": "cfd84045.44788",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.cmd",
        "x": 3080,
        "y": 340,
        "wires": []
    },
    {
        "id": "1c2c46fc.70b419",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.device",
        "x": 3080,
        "y": 420,
        "wires": []
    },
    {
        "id": "f59985c3.821e08",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 3120.2000732421866,
        "y": 193.99999999999994,
        "wires": []
    },
    {
        "id": "e8c6fa13.e3d518",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.value",
        "x": 3080,
        "y": 460,
        "wires": []
    },
    {
        "id": "747b001d.73bbb",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "items",
        "x": 2770,
        "y": 1300,
        "wires": []
    },
    {
        "id": "fe26dc8d.429ef",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "items",
        "x": 4350,
        "y": 2820,
        "wires": []
    },
    {
        "id": "1bff1350.4432dd",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.cmd",
        "x": 2640,
        "y": 2580,
        "wires": []
    },
    {
        "id": "ccec7187.4e5c9",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.room",
        "x": 4778.66650390625,
        "y": 1703.9998779296875,
        "wires": []
    },
    {
        "id": "84804810.146f48",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.cmd",
        "x": 4778.66650390625,
        "y": 1663.9998779296875,
        "wires": []
    },
    {
        "id": "c55e3fef.11fbe",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.device",
        "x": 4778.66650390625,
        "y": 1743.9998779296875,
        "wires": []
    },
    {
        "id": "bacd4d11.a6a0c",
        "type": "debug",
        "z": "457ab65c.d54b38",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.value",
        "x": 4778.66650390625,
        "y": 1783.9998779296875,
        "wires": []
    },
    {
        "id": "58784e8d.6ca16",
        "type": "mqtt-broker",
        "z": "457ab65c.d54b38",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": ""
    },
    {
        "id": "b5b4c68d.4b3a48",
        "type": "mqtt-broker",
        "z": "457ab65c.d54b38",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": ""
    }
]