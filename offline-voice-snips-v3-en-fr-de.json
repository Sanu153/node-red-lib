[
    {
        "id": "a10efc34.c3f2a",
        "type": "tab",
        "label": "SNIPS V3.0",
        "disabled": false,
        "info": ""
    },
    {
        "id": "746c2cc4.1e9ac4",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 240,
        "wires": [
            [
                "61125eea.3ce74",
                "62b402d3.103e3c"
            ]
        ]
    },
    {
        "id": "672bf0df.1c8ac",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "========================================================================SNIPS INTENTS INPUT=======================================================================",
        "info": "",
        "x": 2410,
        "y": 100,
        "wires": []
    },
    {
        "id": "3aef5a54.163086",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "endSession",
        "func": "msg.payload = {\n    \"sessionId\": msg.payload.sessionId    \n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 790,
        "y": 160,
        "wires": [
            [
                "b91923ca.02363"
            ]
        ]
    },
    {
        "id": "b91923ca.02363",
        "type": "mqtt out",
        "z": "a10efc34.c3f2a",
        "name": "",
        "topic": "hermes/dialogueManager/endSession",
        "qos": "",
        "retain": "",
        "broker": "7c060369.da740c",
        "x": 1028.99995803833,
        "y": 159.9999942779541,
        "wires": []
    },
    {
        "id": "40caa787.3874e8",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "delay",
        "timeout": "250",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 630,
        "y": 160,
        "wires": [
            [
                "3aef5a54.163086"
            ]
        ]
    },
    {
        "id": "2b8ef9a5.8e7326",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "===================================================================================SNIPS CORE FUNCTIONS===================================================================================",
        "info": "",
        "x": 790,
        "y": 20,
        "wires": []
    },
    {
        "id": "1b1248e1.913487",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "=================================================================================HOME AUTOMATION INTENTS===================================================================================",
        "info": "",
        "x": 2420,
        "y": 20,
        "wires": []
    },
    {
        "id": "94188149.7438",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "===============================CLOSE SNIPS SESSION=================================",
        "info": "",
        "x": 510,
        "y": 100,
        "wires": []
    },
    {
        "id": "34555777.8b5d98",
        "type": "link in",
        "z": "a10efc34.c3f2a",
        "name": "Session OUT",
        "links": [
            "61125eea.3ce74",
            "42f6efbb.98cee",
            "aad3cf12.c40b7",
            "e3914417.848fb8",
            "584ce928.167e48"
        ],
        "x": 515,
        "y": 160,
        "wires": [
            [
                "40caa787.3874e8"
            ]
        ]
    },
    {
        "id": "cc4b58d8.417238",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "GET devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/rest/alexa/skill/items",
        "tls": "",
        "x": 550,
        "y": 480,
        "wires": [
            [
                "366b7b9d.b3a494"
            ]
        ]
    },
    {
        "id": "366b7b9d.b3a494",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 690,
        "y": 480,
        "wires": [
            [
                "5a4cede1.94a094"
            ]
        ]
    },
    {
        "id": "2403b1bd.23dc0e",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "List_devices",
        "func": "flow.set(\"msgDeviceList\", msg.payload); // save for later use\nflow.set(\"msgProServIP\", msg.proServIP); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1150,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "cb6c15b2.3e4138",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "GET ProServIP",
        "method": "GET",
        "ret": "txt",
        "url": "http://{{{payload}}}:3000/proservip",
        "tls": "",
        "x": 1200,
        "y": 400,
        "wires": [
            [
                "bb0f0aa9.06a338"
            ]
        ]
    },
    {
        "id": "bb0f0aa9.06a338",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "proServIP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1390,
        "y": 400,
        "wires": [
            [
                "cc4b58d8.417238"
            ]
        ]
    },
    {
        "id": "2d14c8bb.c2caa8",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 280,
        "y": 300,
        "wires": [
            [
                "9ff27f4e.5094b",
                "b387752.3646088",
                "3c6ae6b7.b3833a",
                "560c6eb.df5ae9",
                "627de4c2.41387c",
                "11157267.7865fe"
            ]
        ]
    },
    {
        "id": "4c7d63b5.8157dc",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "===============================GET LIST OF DEVICES==================================",
        "info": "",
        "x": 510,
        "y": 240,
        "wires": []
    },
    {
        "id": "3f4718bd.1dbf08",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 160,
        "wires": [
            [
                "7771a49d.371a0c"
            ]
        ]
    },
    {
        "id": "23236ea1.0f3502",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "=============================GET CURRENT LANGUAGE================================",
        "info": "",
        "x": 510,
        "y": 900,
        "wires": []
    },
    {
        "id": "a1a7b37b.e5ef",
        "type": "mqtt out",
        "z": "a10efc34.c3f2a",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "7c060369.da740c",
        "x": 3060,
        "y": 2100,
        "wires": []
    },
    {
        "id": "6c1da1dd.c65d3",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Absolute command feedback",
        "func": "if (msg.payload[0].Result === true) {\n    msg.payload = {\n        text: \"Okay\",\n        siteId: msg.cmd.siteId\n    };\n} else if (msg.current[0].Result !== false || msg.target[0].Result !== false) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Der Server hat nicht korrekt reagiert\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Le serveur n'a pas répondu correctement\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"The server did not answer correctly\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n} else {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Der Server antwortet nicht\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Le serveur ne répond pas\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"The server did not respond\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2281.000030517578,
        "y": 1894.0000886917114,
        "wires": [
            [
                "b6752b12.93f788"
            ]
        ]
    },
    {
        "id": "e9e5ae48.d5cea",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 1811.0000305175781,
        "y": 1854.0000886917114,
        "wires": [
            [
                "10908b2b.c0fc65"
            ]
        ]
    },
    {
        "id": "10908b2b.c0fc65",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1981.0000305175781,
        "y": 1854.0000886917114,
        "wires": [
            [
                "11efe3d2.23842c"
            ]
        ]
    },
    {
        "id": "11efe3d2.23842c",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 2681.000030517578,
        "y": 1854.0000886917114,
        "wires": [
            [
                "fe891c6a.2877d"
            ]
        ]
    },
    {
        "id": "2375b844.f22a48",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "======================================================================SPOKEN FEEDBACK==========================================================================",
        "info": "",
        "x": 2389.9998168945312,
        "y": 1843.9998817443848,
        "wires": []
    },
    {
        "id": "c1d9abe6.c5f8b8",
        "type": "link in",
        "z": "a10efc34.c3f2a",
        "name": "ERROR OUT",
        "links": [
            "a568cecd.16763",
            "1e302784.344688",
            "107efe87.051941",
            "34ef1b78.ad6c74",
            "de9d2514.ef8d38",
            "ce53f6dc.03d708",
            "f676ee98.2e9e3",
            "4e5bb705.ff10d8",
            "3fadc4ce.b39a3c",
            "40c62a0f.a10a74",
            "9cf44e2e.82f2a",
            "1b9a37ed.0aabb8",
            "c1b01312.c2995",
            "72b623d8.c21d9c",
            "111fd1c1.61023e",
            "97964b61.a46138",
            "4400e2ca.f5fe1c",
            "2fa5efbc.7118f",
            "f8816f3c.df85d",
            "445ebe3e.435d4",
            "204353c.a04fcac",
            "f8e73052.da9ba",
            "7d6634f0.ae8d0c",
            "69001fbb.9529b",
            "3693fdda.5fee72",
            "c10a1b8a.f25cf8",
            "99c6772f.c603d8",
            "ad4135.841dfec8",
            "32d13670.23f93a",
            "cfbcad03.e372f",
            "2b525da6.a5ead2",
            "ffc6bfd7.49a8b",
            "a673cbd6.ea8e98",
            "3980d0b4.3e627",
            "90d47db3.aca5f",
            "91d41aaa.7dd1d8",
            "11da80e0.36178f",
            "2574023e.402abe",
            "f4e11622.bb2ed8",
            "28a2ac7.e0bcc54",
            "8be38c38.0f1fb",
            "fbb56eed.f4d2b"
        ],
        "x": 1716.0000305175781,
        "y": 1854.0000886917114,
        "wires": [
            [
                "e9e5ae48.d5cea"
            ]
        ]
    },
    {
        "id": "3d331fc0.01c7d",
        "type": "file in",
        "z": "a10efc34.c3f2a",
        "name": "Get current langage",
        "filename": "/usr/share/snips/assistant/custom_asr/config.json",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "x": 760,
        "y": 960,
        "wires": [
            [
                "4216f57e.b667bc"
            ]
        ]
    },
    {
        "id": "4216f57e.b667bc",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 930,
        "y": 960,
        "wires": [
            [
                "d2adbc3f.fbbe8"
            ]
        ]
    },
    {
        "id": "8f5c19e1.643d28",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 580,
        "y": 960,
        "wires": [
            [
                "3d331fc0.01c7d"
            ]
        ]
    },
    {
        "id": "d2adbc3f.fbbe8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Store_language",
        "func": "flow.set(\"msgLang\", msg.payload.language); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1080,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "3fc042c5.23d35e",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Store supported commands",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\ntest_lights = [\"on\",\"off\",\"an\",\"aus\",\"allume\",\"éteins\"];\ntest_dimmers = [\"on\",\"off\",\"set\",\"increase\",\"decrease\",\"lower\",\"dim\",\"brighten\",\"more\",\"less\",\"stelle\",\"dimme\",\"aus\",\"an\",\"erhohe\",\"verringere\",\"allume\",\"éteins\",\"augmente\",\"baisse\",\"règle\"];\ntest_heating = [\"set\",\"increase\",\"decrease\",\"warmer\",\"cooler\",\"dim\",\"less\",\"more\",\"stelle\",\"erhohe\",\"verringere\",\"règle\",\"augmente\",\"baisse\",\"plus chaud\",\"moins chaud\",\"trop chaud\",\"trop froid\",\"zu warm\",\"zu kalt\",\"too cold\",\"too warm\"];\ntest_blinds = [\"open\",\"close\",\"set\",\"increase\",\"decrease\",\"higher\",\"lower\",\"oeffne\",\"schliesse\",\"stelle\",\"erhohe\",\"verringere\",\"ouvre\",\"règle\",\"ferme\",\"ouvre moins\",\"ouvre plus\",\"ouvre davantage\",\"baisse\",\"monte\",\"ferme davantage\"];\ntest_scenes = [\"on\",\"activate\",\"aktiviere\",\"an\",\"allume\",\"active\"];\ntest_aux = [\"on\",\"activate\",\"deactivate\",\"off\",\"set\",\"increase\",\"decrease\",\"more\",\"less\",\"aktiviere\",\"deaktiviere\",\"erhohe\",\"verringere\",\"aus\",\"an\",\"active\",\"désactive\",\"allume\",\"éteins\",\"ouvre\",\"ferme\",\"augmente\",\"baisse\",\"monte\"];\n\nmsg.commandCat = [\n    {\n        on: {\n            \"on\":\"\",\n            \"activate\":\"\",\n            \"open\":\"\",\n            \"oeffne\":\"\",\n            \"an\":\"\",\n            \"aktiviere\":\"\",\n            \"allume\":\"\",\n            \"ouvre\":\"\",\n            \"active\":\"\"\n        },\n        off: {\n            \"off\":\"\",\n            \"deactivate\":\"\",\n            \"close\":\"\",\n            \"deaktiviere\":\"\",\n            \"aus\":\"\",\n            \"schliesse\":\"\",\n            \"éteins\":\"\",\n            \"eteins\":\"\",\n            \"ferme\":\"\",\n            \"désactive\":\"\",\n            \"desactive\":\"\"\n        },\n        set: {\n            \"set\":\"\",\n            \"stelle\":\"\",\n            \"règle\":\"\",\n            \"regle\":\"\"\n        },\n        increase: {\n            \"increase\":\"\",\n            \"higher\":\"\",\n            \"warmer\":\"\",\n            \"brighten\":\"\",\n            \"more\":\"\",\n            \"erhohe\":\"\",\n            \"plus chaud\":\"\",\n            \"ouvre plus\":\"\",\n            \"ouvre davantage\":\"\",\n            \"trop froid\":\"\",\n            \"augmente\":\"\",\n            \"monte\":\"\",\n            \"too cold\":\"\",\n            \"zu kalt\":\"\",\n        },\n        decrease: {\n            \"decrease\":\"\",\n            \"lower\":\"\",\n            \"colder\":\"\",\n            \"darker\":\"\",\n            \"dim\":\"\",\n            \"less\":\"\",\n            \"cooler\":\"\",\n            \"abnehme\":\"\",\n            \"dimme\":\"\",\n            \"verringere\":\"\",\n            \"baisse\":\"\",\n            \"ouvre moins\":\"\",\n            \"trop chaud\":\"\",\n            \"moins chaud\":\"\",\n            \"too warm\":\"\",\n            \"zu warm\":\"\",\n            \"ferme davantage\":\"\"\n        }\n    }\n];\n\nflow.set(\"msg_test_lights\", test_lights); // save for later use\nflow.set(\"msg_test_dimmers\", test_dimmers); // save for later use\nflow.set(\"msg_test_heating\", test_heating); // save for later use\nflow.set(\"msg_test_blinds\", test_blinds); // save for later use\nflow.set(\"msg_test_scenes\", test_scenes); // save for later use\nflow.set(\"msg_test_aux\", test_aux); // save for later use\nflow.set(\"msgCommandCat\", msg.commandCat); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 920,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "4aed2f4f.b660e",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "===========================GET SUPPORTED COMMANDS===============================",
        "info": "",
        "x": 510,
        "y": 1040,
        "wires": []
    },
    {
        "id": "85725fe1.389f7",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 700,
        "y": 1100,
        "wires": [
            [
                "3fc042c5.23d35e"
            ]
        ]
    },
    {
        "id": "4d07a305.e460dc",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "=======================================================================EXECUTE COMMAND========================================================================",
        "info": "",
        "x": 2411.000030517578,
        "y": 1114.0000886917114,
        "wires": []
    },
    {
        "id": "e5c52d9e.d074c",
        "type": "link in",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION OUT",
        "links": [
            "508fe008.41f8b",
            "c3dc35f5.c94108",
            "7771a49d.371a0c",
            "675be6d1.72ec88",
            "a2f8aac9.bd6fc8",
            "fd7fc068.412a9",
            "d6766e42.838c6",
            "6a427699.8d79d8",
            "5a03801d.e4a8b",
            "1b3e1a6d.7d1266",
            "8bdb3d96.4133b",
            "20cf4d61.337642",
            "8508f849.58ce48",
            "f38a525c.4ce42",
            "8c51ddf6.1a475",
            "a4efe9b6.c3c3b8",
            "8d37fe4.b5811",
            "4aed5869.ba1d68",
            "be25cb66.912838",
            "14796e56.0d7942",
            "9597294b.e208c8",
            "71f5196a.3363c8",
            "fa026c94.9a529"
        ],
        "x": 1796.0000305175781,
        "y": 1274.0000886917114,
        "wires": [
            [
                "c35776a0.96a408",
                "2342a368.7b895c"
            ]
        ]
    },
    {
        "id": "4fb527ea.08b358",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Prepare request",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.url = [];\n\nif (msg.cmd.type === \"heating\") {\n   \tfor (var i = 0; i < msg.items.length; i++) {\n   \t\tvar val = msg.cmd.value;\n   \t\tif (val < 18){\n\t            val = 18;\n        \t} else if (val > 28) {\n        \t    val = 28;\n\t        } else {\n    \t        val = val;\n\t        }\n   \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, val];\n   \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t\n\t}\n} else if (msg.cmd.type === \"lights\") {\n    if (msg.cmd.value !== undefined) {\n       \tfor (var i = 0; i < msg.items.length; i++) {\n       \t\tif (msg.items[i].type === \"dimmers\" && msg.cmd.cmd !== \"off\") {\n       \t\t\tvar val = msg.cmd.value*2.55;\n       \t\t\tval = precisionRound(val, 1);\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n       \t\t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n       \t\t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t} \n       \t\telse if (msg.cmd.value > 0) {\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n       \t\telse {\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n    \t}\n    }\n    else if (msg.cmd.cmd === \"on\") {\n    \tfor (var i = 0; i < msg.items.length; i++) {\n    \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n    }\n    else if (msg.cmd.cmd === \"off\") {\n    \tfor (var i = 0; i < msg.items.length; i++) {\n    \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n       \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n    }\n} else if (msg.cmd.type === \"blinds\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \tif (msg.cmd.cmd === \"on\" && msg.cmd.value === undefined) {\n        \tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n    \t    msg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n    \telse if (msg.cmd.cmd === \"off\" && msg.cmd.value === undefined) {\n        \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n    \t    msg.url[i] = \"\".concat(...msg.url[i]);\n        }\n        else if (msg.cmd.value !== undefined) {\n            if (msg.cmd.cmd === \"on\" || msg.cmd.cmd === \"set\") {\n           \t\tvar val = (100-msg.cmd.value)*2.55;\n           \t\tval = precisionRound(val, 1);\n           \t\tif (val > 255) {val=255;} else if (val < 0) {val=0;}\n           \t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n           \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n           \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n            } else if (msg.cmd.cmd === \"off\") {\n                var val = (msg.cmd.value)*2.55;\n           \t\tval = precisionRound(val, 1);\n           \t\tif (val > 255) {val=255;} else if (val < 0) {val=0;}\n           \t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n           \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n           \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n            }\n        }\n    }\n} else if (msg.cmd.type === \"aux\" || msg.cmd.type === \"scenes\") {\n    if (msg.cmd.cmd === \"on\" || msg.cmd.cmd === \"set\") {\n        if (msg.cmd.value !== undefined) {\n           \tfor (var i = 0; i < msg.items.length; i++) {\n           \t\tif (msg.items[i].setDimUrl !== undefined) {\n           \t\t\tvar val = msg.cmd.value*2.55;\n           \t\t\tval = precisionRound(val, 1);\n           \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n           \t\t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n           \t\t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n           \t\t} \n           \t\telse if (msg.cmd.value > 0) {\n        \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n           \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n           \t\t}\n           \t\telse {\n        \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n           \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n           \t\t}\n        \t}\n        }\n        else {\n    \t    for (var i = 0; i < msg.items.length; i++) {\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n        }\n    }\n    else if (msg.cmd.cmd === \"off\") {\n    \tfor (var i = 0; i < msg.items.length; i++) {\n    \t\tif (msg.items[i].setOffUrl !== undefined) {\n        \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n           \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n        \t}\n    \t}\n    }\n}\n\nreturn msg; ",
        "outputs": 1,
        "noerr": 0,
        "x": 1941.0000305175781,
        "y": 1174.0000886917114,
        "wires": [
            [
                "a23c4410.f5fa48",
                "5eec8250.d7592c"
            ]
        ]
    },
    {
        "id": "a23c4410.f5fa48",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2091.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "ea985aa3.23bd58"
            ],
            [
                "1b9a37ed.0aabb8"
            ]
        ]
    },
    {
        "id": "1b9a37ed.0aabb8",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2176.000030517578,
        "y": 1194.0000886917114,
        "wires": []
    },
    {
        "id": "a0851a32.a5e518",
        "type": "split",
        "z": "a10efc34.c3f2a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2431.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "79e39868.8417e8"
            ]
        ]
    },
    {
        "id": "ea985aa3.23bd58",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2281.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "a0851a32.a5e518"
            ]
        ]
    },
    {
        "id": "79e39868.8417e8",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "50ms",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2551.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "8fb8b4bc.d045b8"
            ]
        ]
    },
    {
        "id": "c35776a0.96a408",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Cmd ?",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "increase",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "decrease",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 5,
        "x": 1891.0000305175781,
        "y": 1274.0000886917114,
        "wires": [
            [
                "4fb527ea.08b358"
            ],
            [
                "4fb527ea.08b358"
            ],
            [
                "4fb527ea.08b358"
            ],
            [
                "e63db790.6a58e8"
            ],
            [
                "e63db790.6a58e8"
            ]
        ]
    },
    {
        "id": "a1ff7636.f58bb8",
        "type": "link in",
        "z": "a10efc34.c3f2a",
        "name": "FEEDBACK OUT",
        "links": [
            "3f4d295c.ebd3f6",
            "7f0085de.6742dc",
            "a5f1e0f.240832"
        ],
        "x": 1716.0000305175781,
        "y": 1954.0000886917114,
        "wires": [
            [
                "70a34bf1.e8c094"
            ]
        ]
    },
    {
        "id": "8fea9dda.f56dc",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Type ?",
        "property": "cmd.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "heating",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "heating",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1891.0000305175781,
        "y": 1594.0000886917114,
        "wires": [
            [
                "8a679de.bdbe76"
            ],
            [
                "2f1b5419.a8accc"
            ]
        ]
    },
    {
        "id": "e63db790.6a58e8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "GET Current",
        "func": "msg.url = [];\n\nif (msg.items[0].type === \"heating\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \tmsg.url[i] = [msg.proServIP, msg.items[i].getTargetUrl];\n    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n    }\n} else if (msg.cmd.type === \"aux\" || msg.cmd.type === \"scenes\" || msg.cmd.type === \"lights\" || msg.cmd.type === \"dimmers\" || msg.cmd.type === \"blinds\") {\n    var cptok=0;\n    var cpter=0;\n    msg.itemsok=[];\n    msg.itemser=[];\n    for (var i = 0; i < msg.items.length; i++) {\n        if(msg.items[i].getCurrentUrl !== undefined && msg.items[i].setDimUrl !== undefined && msg.items[i].type !== \"lights\") {\n            msg.itemsok[cptok]=msg.items[i];\n            cptok++;\n        } else {\n            msg.itemser[cpter]=msg.items[i];\n            cpter++;\n        }\n    }\n    if (msg.itemsok[0] !== undefined) {\n        msg.items = msg.itemsok;\n        for (var i = 0; i < msg.itemsok.length; i++) {\n        \tmsg.url[i] = [msg.proServIP, msg.itemsok[i].getCurrentUrl];\n        \tmsg.url[i] = \"\".concat(...msg.url[i]);\n        }\n    }\n\n    if (msg.itemser.length > 0 && msg.itemsok.length === 0) {\n        if (msg.itemser.length > 1) {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" und \";\n                text3 = msg.itemser.length-1;\n                text4 = \" andere Geräte verstehen diesen Befehl nicht\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" et \";\n                text3 = msg.itemser.length-1;\n                text4 = \" autres appareils ne supportent pas cette commande\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" and \";\n                text3 = msg.itemser.length-1;\n                text4 = \" other devices do not support this command\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        } else {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" versteht diesen Befehl nicht\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" ne supporte pas cette commande\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" does not support this command\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2071.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "94f31b44.2d7a18"
            ]
        ]
    },
    {
        "id": "f4b0693a.da3ed8",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2811.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "eb0aa19f.3cf12"
            ]
        ]
    },
    {
        "id": "39125258.05f8ae",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "50ms",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2671.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "f4b0693a.da3ed8"
            ]
        ]
    },
    {
        "id": "70d7897b.7ad208",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "move msg.payload",
        "rules": [
            {
                "t": "set",
                "p": "target",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "current",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2231.000030517578,
        "y": 1314.0000886917114,
        "wires": [
            [
                "85f7d215.4253d"
            ]
        ]
    },
    {
        "id": "f33a6b76.0beed8",
        "type": "split",
        "z": "a10efc34.c3f2a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2551.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "39125258.05f8ae"
            ]
        ]
    },
    {
        "id": "40005f88.9bf82",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2401.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "f33a6b76.0beed8"
            ]
        ]
    },
    {
        "id": "649911af.e2609",
        "type": "join",
        "z": "a10efc34.c3f2a",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2071.000030517578,
        "y": 1314.0000886917114,
        "wires": [
            [
                "70d7897b.7ad208"
            ]
        ]
    },
    {
        "id": "eb0aa19f.3cf12",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 2951.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "649911af.e2609"
            ]
        ]
    },
    {
        "id": "85f7d215.4253d",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Prepare_request",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.url = [];\nmsg.newVal= [];\n\nif (msg.items[0].type === \"heating\" && msg.cmd.cmd === \"decrease\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tif (msg.cmd.value !== undefined) {\n\t\t    var val = msg.cmd.value;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target-val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t\telse {\n\t\t    var val = 2;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target-val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t}\n} else if (msg.items[0].type === \"heating\" && msg.cmd.cmd === \"increase\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tif (msg.cmd.value !== undefined) {\n\t\t    var val = msg.cmd.value;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target+val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t\telse {\n\t\t    var val = 2;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target+val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t}\n} else if (msg.cmd.type === \"lights\" && msg.cmd.cmd ===\"increase\") {\n    cptok = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.items[i].type === \"dimmers\") {\n    \t    if (msg.cmd.value !== undefined){\n    \t\t    var val = msg.cmd.value*2.55;\n    \t\t    val = precisionRound(val, 1);\n    \t\t    var newVal = msg.current[i].Data[0].Value+val;\n    \t\t    if (newVal > 255) {\n    \t    \t    newVal = 255;\n    \t        }\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[cptok] = \"\".concat(...msg.url[cptok]);\n    \t\t    cptok++;\n    \t    }\n    \t    else {\n    \t        var newVal = msg.current[i].Data[0].Value+51;\n    \t\t    if (newVal > 255) {\n    \t    \t    newVal = 255;\n    \t        }\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[cptok] = \"\".concat(...msg.url[cptok]);\n    \t\t    cptok++;\n    \t    }\n        }\n    }\n} else if (msg.cmd.type === \"lights\" && msg.cmd.cmd ===\"decrease\") {\n    cptok = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.items[i].type === \"dimmers\") {\n       \t\tif (msg.cmd.value !== undefined) {\n       \t\t    var val = msg.cmd.value*2.55;\n       \t\t    val = precisionRound(val, 1);\n       \t\t    var newVal = msg.current[i].Data[0].Value-val;\n       \t\t    if (newVal < 0) {\n       \t\t        newVal = 0;\n       \t\t    }\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n       \t\t    msg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n       \t    \tmsg.url[cptok] = \"\".concat(...msg.url[cptok]);\n       \t    \tcptok++;\n       \t\t} else {\n                var newVal = msg.current[i].Data[0].Value-51;\n       \t\t    if (newVal < 0) {\n       \t\t        newVal = 0;\n       \t\t    }\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n            \tmsg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n        \t\tmsg.url[cptok] = \"\".concat(...msg.url[cptok]);\n        \t\tcptok++;\n       \t\t}\n        }\n    }\n} else if (msg.cmd.type === \"blinds\" && msg.cmd.cmd ===\"decrease\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \t    if (msg.cmd.value !== undefined){\n    \t\t    var val = msg.cmd.value*2.55;\n    \t\t    val = precisionRound(val, 1);\n    \t\t    var newVal = msg.current[i].Data[0].Value+val;\n    \t\t    if (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n    \t    else {\n    \t        var newVal = msg.current[i].Data[0].Value+51;\n    \t\t    if (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n    }\n} else if (msg.cmd.type === \"blinds\" && msg.cmd.cmd === \"increase\") {\n        for (var i = 0; i < msg.items.length; i++) {\n    \t    if (msg.cmd.value !== undefined) {\n    \t        var val = msg.cmd.value*2.55;\n    \t    \tval = precisionRound(val, 1);\n    \t    \tvar newVal = msg.current[i].Data[0].Value-val;\n           \t\tif (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n        \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n    \t    else {\n    \t        var newVal = msg.current[i].Data[0].Value-51;\n    \t    \tif (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n                msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n            \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n        \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n        \t}\n        }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2431.000030517578,
        "y": 1314.0000886917114,
        "wires": [
            [
                "a35df340.0b7be",
                "b808d8f.602f728"
            ]
        ]
    },
    {
        "id": "b97d53af.46b1a",
        "type": "split",
        "z": "a10efc34.c3f2a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2774.5714263916016,
        "y": 1314.0002460479736,
        "wires": [
            [
                "32050251.195aee"
            ]
        ]
    },
    {
        "id": "a35df340.0b7be",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2621.7143173217773,
        "y": 1314.0001754760742,
        "wires": [
            [
                "b97d53af.46b1a"
            ]
        ]
    },
    {
        "id": "32050251.195aee",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "50ms",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2897.4287757873535,
        "y": 1314.0002279281616,
        "wires": [
            [
                "ede6b1b3.a3886"
            ]
        ]
    },
    {
        "id": "3f4d295c.ebd3f6",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "FEEDBACK IN",
        "links": [
            "a1ff7636.f58bb8",
            "fb3a84d7.87d6d8",
            "fa8fd201.bc662"
        ],
        "x": 3036.000030517578,
        "y": 1374.0000886917114,
        "wires": []
    },
    {
        "id": "a5f1e0f.240832",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "FEEDBACK IN",
        "links": [
            "a1ff7636.f58bb8",
            "fb3a84d7.87d6d8",
            "fa8fd201.bc662"
        ],
        "x": 3036.000030517578,
        "y": 1174.0000886917114,
        "wires": []
    },
    {
        "id": "94f31b44.2d7a18",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2211.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "40005f88.9bf82"
            ],
            [
                "72b623d8.c21d9c"
            ]
        ]
    },
    {
        "id": "72b623d8.c21d9c",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2296.000030517578,
        "y": 1274.0000886917114,
        "wires": []
    },
    {
        "id": "8a679de.bdbe76",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "GET_Target",
        "func": "//Prepare all HTTP requests for GET Current Temp and put them in msg.url\n\nmsg.url = [];\n\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getTargetUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2071.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "1bdf0340.fd57ad",
                "9259b1a4.d5033"
            ]
        ]
    },
    {
        "id": "52517051.2fdd4",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "GET Target",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2691.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "68f7ee71.f61db"
            ]
        ]
    },
    {
        "id": "f53bd75f.a4ab98",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2531.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "52517051.2fdd4"
            ]
        ]
    },
    {
        "id": "5b38b46.ad4bf4c",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "target",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2531.000030517578,
        "y": 1594.0000886917114,
        "wires": [
            [
                "2f1b5419.a8accc"
            ]
        ]
    },
    {
        "id": "be604e9e.12753",
        "type": "split",
        "z": "a10efc34.c3f2a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2391.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "f53bd75f.a4ab98"
            ]
        ]
    },
    {
        "id": "1bdf0340.fd57ad",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2241.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "be604e9e.12753"
            ]
        ]
    },
    {
        "id": "4b874fdd.251a6",
        "type": "join",
        "z": "a10efc34.c3f2a",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2951.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "5b38b46.ad4bf4c"
            ]
        ]
    },
    {
        "id": "68f7ee71.f61db",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 2829.571388244629,
        "y": 1534.000096321106,
        "wires": [
            [
                "4b874fdd.251a6"
            ]
        ]
    },
    {
        "id": "2f1b5419.a8accc",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "GET_Current",
        "func": "msg.url = [];\n\nif (msg.cmd.type === \"heating\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \tmsg.url[i] = [msg.proServIP, msg.items[i].getCurrentUrl];\n    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n    }\n} else if (msg.cmd.type === \"aux\" || msg.cmd.type === \"scenes\" || msg.cmd.type === \"lights\" || msg.cmd.type === \"dimmers\" || msg.cmd.type === \"blinds\") {\n    var cptok=0;\n    var cpter=0;\n    msg.itemsok=[];\n    msg.itemser=[];\n    for (var i = 0; i < msg.items.length; i++) {\n        if(msg.items[i].getCurrentUrl !== undefined) {\n            msg.itemsok[cptok]=msg.items[i];\n            cptok++;\n        } else {\n            msg.itemser[cpter]=msg.items[i];\n            cpter++;\n        }\n    }\n    \n    if (msg.itemsok[0] !== undefined) {\n        for (var i = 0; i < msg.itemsok.length; i++) {\n        \tmsg.url[i] = [msg.proServIP, msg.itemsok[i].getCurrentUrl];\n        \tmsg.url[i] = \"\".concat(...msg.url[i]);\n        }\n    }\n    \n    if (msg.itemser.length > 0 && msg.itemsok.length === 0) {\n        if (msg.itemser.length > 1) {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" und \";\n                text3 = msg.itemser.length-1;\n                text4 = \" \";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" et \";\n                text3 = msg.itemser.length-1;\n                text4 = \" autres appareils ne supportent pas cette commande\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" and \";\n                text3 = msg.itemser.length-1;\n                text4 = \" other devices do not support this command\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        } else {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" \";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" ne supporte pas cette commande\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" does not support this command\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2061.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "8e263da2.9be34",
                "9248a617.9164f8"
            ]
        ]
    },
    {
        "id": "2e04b8d4.a23dc8",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2911.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "20339339.cd269c"
            ]
        ]
    },
    {
        "id": "edad6dd9.7755b",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2728.8573112487793,
        "y": 1654.0001401901245,
        "wires": [
            [
                "2e04b8d4.a23dc8"
            ]
        ]
    },
    {
        "id": "a4d340cf.51151",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2371.000030517578,
        "y": 1734.0000886917114,
        "wires": [
            [
                "7f0085de.6742dc"
            ]
        ]
    },
    {
        "id": "6fac744e.354f1c",
        "type": "split",
        "z": "a10efc34.c3f2a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2571.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "edad6dd9.7755b"
            ]
        ]
    },
    {
        "id": "d851f8e.e718308",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2401.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "6fac744e.354f1c"
            ]
        ]
    },
    {
        "id": "b1c07fa8.208a6",
        "type": "join",
        "z": "a10efc34.c3f2a",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2191.000030517578,
        "y": 1734.0000886917114,
        "wires": [
            [
                "a4d340cf.51151"
            ]
        ]
    },
    {
        "id": "20339339.cd269c",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 2051.000030517578,
        "y": 1734.0000886917114,
        "wires": [
            [
                "b1c07fa8.208a6"
            ]
        ]
    },
    {
        "id": "7f0085de.6742dc",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "FEEDBACK IN",
        "links": [
            "a1ff7636.f58bb8",
            "fb3a84d7.87d6d8",
            "fa8fd201.bc662"
        ],
        "x": 2516.000030517578,
        "y": 1734.0000886917114,
        "wires": []
    },
    {
        "id": "8e263da2.9be34",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2211.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "d851f8e.e718308"
            ],
            [
                "111fd1c1.61023e"
            ]
        ]
    },
    {
        "id": "111fd1c1.61023e",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2296.000030517578,
        "y": 1674.0000886917114,
        "wires": []
    },
    {
        "id": "c088f2bf.a2199",
        "type": "link in",
        "z": "a10efc34.c3f2a",
        "name": "QUERY EXECUTION OUT",
        "links": [
            "a940c273.c4976",
            "483102fe.64f09c",
            "17c7a2ae.24b62d",
            "6066c1eb.1b935"
        ],
        "x": 1796.0000305175781,
        "y": 1594.0000886917114,
        "wires": [
            [
                "8fea9dda.f56dc",
                "3e278040.0209c"
            ]
        ]
    },
    {
        "id": "8fb8b4bc.d045b8",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "Send URL",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2691.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "ce6deb77.5eb6d8"
            ]
        ]
    },
    {
        "id": "fa43f76a.ece9a8",
        "type": "join",
        "z": "a10efc34.c3f2a",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2951.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "a5f1e0f.240832"
            ]
        ]
    },
    {
        "id": "ce6deb77.5eb6d8",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 2831.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "fa43f76a.ece9a8"
            ]
        ]
    },
    {
        "id": "ede6b1b3.a3886",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "Send URL",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2691.000030517578,
        "y": 1374.0000886917114,
        "wires": [
            [
                "7a8e0316.36ebdc"
            ]
        ]
    },
    {
        "id": "1db0767d.58ca0a",
        "type": "join",
        "z": "a10efc34.c3f2a",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2951.000030517578,
        "y": 1374.0000886917114,
        "wires": [
            [
                "3f4d295c.ebd3f6"
            ]
        ]
    },
    {
        "id": "7a8e0316.36ebdc",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 2831.000030517578,
        "y": 1374.0000886917114,
        "wires": [
            [
                "1db0767d.58ca0a"
            ]
        ]
    },
    {
        "id": "f281bd2b.8d75c",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "========================================================================EXECUTE QUERY==========================================================================",
        "info": "",
        "x": 2411.000030517578,
        "y": 1474.0000886917114,
        "wires": []
    },
    {
        "id": "70a34bf1.e8c094",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Query ?",
        "property": "cmd.query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1821.0000305175781,
        "y": 1954.0000886917114,
        "wires": [
            [
                "27d1214c.bf5c0e"
            ],
            [
                "2e58610d.38f19e"
            ]
        ]
    },
    {
        "id": "27d1214c.bf5c0e",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "increase",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "decrease",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 5,
        "x": 2071.000030517578,
        "y": 1914.0000886917114,
        "wires": [
            [
                "6c1da1dd.c65d3"
            ],
            [
                "6c1da1dd.c65d3"
            ],
            [
                "6c1da1dd.c65d3"
            ],
            [
                "3f9500d2.8eeeb"
            ],
            [
                "3f9500d2.8eeeb"
            ]
        ]
    },
    {
        "id": "3f9500d2.8eeeb",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Relative command feedback",
        "func": "if (msg.cmd.type === \"aux\" || msg.cmd.type === \"lights\" || msg.cmd.type === \"blinds\") {\n    if (msg.payload[0].Result === true) {\n        msg.payload = {\n            text: \"Okay\",\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n} else if (msg.cmd.type === \"heating\") {\n    msg.text = [];\n    if (msg.cmd.lang === \"fr\") {\n        for (var i = 0; i < msg.payload.length; i++) {\n            if (msg.payload[i].Result === true) {\n                var room = msg.items[i].zone;\n                var target = msg.newVal[i];\n                var text1 = \"Okay, le thermostat est réglé sur \";\n                var text2 = \" degrés dans la zone \";\n                msg.text[i] = [text1, target, text2, room];\n                var endText = \"\".concat(...msg.text[i]);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        }\n    } else if (msg.cmd.lang === \"de\") {\n        for (var i = 0; i < msg.payload.length; i++) {\n            if (msg.payload[i].Result === true) {\n                var room = msg.items[i].zone;\n                var target = msg.newVal[i];\n                var text1 = \"Okay, die Heizung ist aus \";\n                var text2 = \" Grad in \";\n                var text3 = \" eingestellt\";\n                msg.text[i] = [text1, target, text2, room, text3];\n                var endText = \"\".concat(...msg.text[i]);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        }\n    } else {\n        for (var i = 0; i < msg.payload.length; i++) {\n            if (msg.payload[i].Result === true) {\n                var room = msg.items[i].zone;\n                var target = msg.newVal[i];\n                var text1 = \"Okay, setting the heating to \";\n                var text2 = \" degrees in the \";\n                msg.text[i] = [text1, target, text2, room];\n                var endText = \"\".concat(...msg.text[i]);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2281.000030517578,
        "y": 1934.0000886917114,
        "wires": [
            [
                "98128e03.ebfa"
            ]
        ]
    },
    {
        "id": "9678371c.e1bd18",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Query feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.payload = [];\nmsg.text = [];\n\nif (msg.cmd.type === \"lights\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        if (msg.cmd.lang === \"fr\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est éteint\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumé\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumée à \";\n                    var text3 = \" pourcents\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        } else if (msg.cmd.lang === \"de\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist aus\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist an\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \"Die Helligkeit von \";\n                    var text3 = \" ist aus \";\n                    var text4 = \" Prozent eingestellt\";\n                    msg.text[i] = [text2, text1, text3, current, text4];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        } else {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is off\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is on\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \"'s luminosity is set to  \";\n                    var text3 = \" percent\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    } \n} else if (msg.cmd.type === \"heating\" && msg.current !== undefined && msg.target !== undefined) {\n    if (msg.cmd.lang === \"fr\"){\n        if (msg.current[0].Result === true && msg.target[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var target = msg.target[i].Data[0].Value;\n                var current = precisionRound(msg.current[i].Data[0].Value, 0);\n                var room = msg.items[i].zone;\n           \t\tvar text1 = \"Le thermostat est réglé sur \";\n                var text2 = \" dans la zone \";\n                var text3 = \" pour une température actuelle de \";\n                msg.text[i] = [text1, target, text2, room, text3, current];\n           \t\tvar endText = \"\".concat(...msg.text[i]);\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        }\n    } else if (msg.cmd.lang === \"de\") {\n        if (msg.current[0].Result === true && msg.target[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var target = msg.target[i].Data[0].Value;\n                var current = precisionRound(msg.current[i].Data[0].Value, 0);\n                var room = msg.items[i].zone;\n           \t\tvar text1 = \"Die Heizung ist aus \";\n                var text2 = \" grad in \";\n                var text3 = \" eingestellt bei einer aktuellen Temperatur von \";\n                msg.text[i] = [text1, target, text2, room, text3, current];\n           \t\tvar endText = \"\".concat(...msg.text[i]);\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        }\n    } else {\n        if (msg.current[0].Result === true && msg.target[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var target = msg.target[i].Data[0].Value;\n                var current = precisionRound(msg.current[i].Data[0].Value, 0);\n                var room = msg.items[i].zone;\n                var text1 = \"Heating is set to \";\n                var text2 = \" degrees in the \";\n                var text3 = \", with a current temperature of \";\n                msg.text[i] = [text1, target, text2, room, text3, current];\n           \t\tvar endText = \"\".concat(...msg.text[i]);\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n} if (msg.cmd.type === \"aux\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        if (msg.cmd.lang === \"de\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est éteint\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumé\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumée à \";\n                    var text3 = \" pourcents\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        } else if (msg.cmd.lang === \"de\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist aus\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist an\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \"Das Gerät \";\n                    var text3 = \"ist aus \";\n                    var text4 = \"Prozent eingestellt\";\n                    msg.text[i] = [text2, text1, text3, current, text4];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        } else {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is off\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is on\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is set to  \";\n                    var text3 = \"percent\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    } \n} if (msg.cmd.type === \"blinds\" && msg.current !== undefined){\n    if (msg.cmd.lang === \"de\") {\n        if (msg.current[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist geöffnet\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true || current === 255){\n                    var text1 = msg.items[i].object;\n                    var text2 = \"ist geschlossen\"; \n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <255){\n                    var current = precisionRound((255-current)/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist aus \";\n                    var text3 = \" Prozent gestellt\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        }\n    } else if (msg.cmd.lang === \"fr\") {\n        if (msg.current[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est ouvert\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true || current === 255){\n                    var text1 = msg.items[i].object;\n                    var text2 = \"est fermé\"; \n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <255){\n                    var current = precisionRound((255-current)/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est réglé sur \";\n                    var text3 = \" pourcents\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        }\n    } else {\n        if (msg.current[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is fully open\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true || current === 255){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is closed\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <255){\n                    var current = precisionRound((255-current)/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is \";\n                    var text3 = \" percent open\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang:\"en-EN\"\n                };\n            }\n        }\n    }\n\n\n} else if ((msg.cmd.type === \"heating\" && (msg.current === undefined || msg.target === undefined))|| \n(msg.current === undefined && msg.cmd.type !== \"heating\")) {\n    msg.error = [];\n    if (msg.current[0].Result !== false || msg.target[0].Result !== false) {\n        if (msg.cmd.lang === \"de\") {\n            msg.error = {\n                text: \"Der Server hat nicht korrekt reagiert\",\n                siteId: msg.cmd.siteId,\n                lang: \"de-DE\"\n            };\n        } else if (msg.cmd.lang === \"fr\") {\n            msg.error = {\n                text: \"Le serveur n'a pas répondu correctement\",\n                siteId: msg.cmd.siteId,\n                lang:\"fr-FR\"\n            };\n        } else {\n            msg.error = {\n                text: \"The server did not react correctly\",\n                siteId: msg.cmd.siteId,\n                lang:\"en-EN\"\n            };\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2200,
        "y": 1980,
        "wires": [
            [
                "fe4b8df.994307"
            ]
        ]
    },
    {
        "id": "3c43f92c.20f066",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:turnOnLights",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 160,
        "wires": [
            [
                "746c2cc4.1e9ac4"
            ]
        ]
    },
    {
        "id": "5a4cede1.94a094",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "test ProServIP",
        "func": "msg.cmd=[];\nmsg.cmd.lang = flow.get(\"msgLang\");\n\nif (msg.proServIP === \"\" || msg.proServIP.search(\"ECONNREFUSED\") !== -1 || msg.proServIP === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        text = \"Bitte überprüfen Sie die adresse von ProServ\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Veuillez vérifier l'adresse du Proserv\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Please check the configuration of the ProServ address\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 830,
        "y": 480,
        "wires": [
            [
                "7b50e03b.443ee"
            ]
        ]
    },
    {
        "id": "7b50e03b.443ee",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 970,
        "y": 480,
        "wires": [
            [
                "2403b1bd.23dc0e"
            ],
            [
                "4400e2ca.f5fe1c"
            ]
        ]
    },
    {
        "id": "4400e2ca.f5fe1c",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 1055,
        "y": 500,
        "wires": []
    },
    {
        "id": "b6752b12.93f788",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2471.000030517578,
        "y": 1894.0000886917114,
        "wires": [
            [
                "11efe3d2.23842c"
            ],
            [
                "2fa5efbc.7118f"
            ]
        ]
    },
    {
        "id": "2fa5efbc.7118f",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8"
        ],
        "x": 2556.000030517578,
        "y": 1914.0000886917114,
        "wires": []
    },
    {
        "id": "98128e03.ebfa",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2471.000030517578,
        "y": 1934.0000886917114,
        "wires": [
            [
                "11efe3d2.23842c"
            ],
            [
                "f8816f3c.df85d"
            ]
        ]
    },
    {
        "id": "f8816f3c.df85d",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8"
        ],
        "x": 2556.000030517578,
        "y": 1954.0000886917114,
        "wires": []
    },
    {
        "id": "a21c2264.1e132",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2471.000030517578,
        "y": 1974.0000886917114,
        "wires": [
            [
                "fe891c6a.2877d"
            ],
            [
                "445ebe3e.435d4"
            ]
        ]
    },
    {
        "id": "445ebe3e.435d4",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8"
        ],
        "x": 2556.000030517578,
        "y": 1994.0000886917114,
        "wires": []
    },
    {
        "id": "a7526a82.79b968",
        "type": "link in",
        "z": "a10efc34.c3f2a",
        "name": "DEBUG OUT",
        "links": [
            "e443f6e.2335a08",
            "22c6aed9.bb0942",
            "5eec8250.d7592c",
            "9259b1a4.d5033",
            "b808d8f.602f728",
            "9248a617.9164f8",
            "2342a368.7b895c",
            "3e278040.0209c",
            "7a651595.5860ac",
            "42472400.29b25c",
            "6ea14c45.3e6cf4",
            "7771a49d.371a0c",
            "5a03801d.e4a8b",
            "1b3e1a6d.7d1266",
            "8bdb3d96.4133b",
            "20cf4d61.337642",
            "17c7a2ae.24b62d",
            "8508f849.58ce48",
            "f38a525c.4ce42",
            "8c51ddf6.1a475",
            "a4efe9b6.c3c3b8",
            "8d37fe4.b5811",
            "4aed5869.ba1d68",
            "be25cb66.912838",
            "14796e56.0d7942",
            "9597294b.e208c8",
            "fa026c94.9a529",
            "71f5196a.3363c8",
            "6066c1eb.1b935"
        ],
        "x": 675,
        "y": 1640,
        "wires": [
            [
                "4d42ff15.0288e",
                "481ab0da.c31ca",
                "fc6e5e03.291f8",
                "3b0b276c.911808",
                "c6f7c16c.09a78",
                "1e1a3e79.2813b2",
                "e0ac7790.f7ed98",
                "c2954e37.b7d63",
                "337d77a1.b027e8",
                "ea5560fd.0a1a2",
                "3b05078c.2b5d68",
                "40cea1e4.83e24",
                "1e86bda6.544b72",
                "2c52b37.17d3a4c"
            ]
        ]
    },
    {
        "id": "337d77a1.b027e8",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.room",
        "x": 840,
        "y": 1560,
        "wires": []
    },
    {
        "id": "ea5560fd.0a1a2",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.cmd",
        "x": 840,
        "y": 1520,
        "wires": []
    },
    {
        "id": "c2954e37.b7d63",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.device",
        "x": 840,
        "y": 1600,
        "wires": []
    },
    {
        "id": "e0ac7790.f7ed98",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.value",
        "x": 840,
        "y": 1640,
        "wires": []
    },
    {
        "id": "1e1a3e79.2813b2",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.query",
        "x": 840,
        "y": 1680,
        "wires": []
    },
    {
        "id": "3b05078c.2b5d68",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.lang",
        "x": 840,
        "y": 1480,
        "wires": []
    },
    {
        "id": "481ab0da.c31ca",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "deviceList",
        "x": 839.8571341378347,
        "y": 1440,
        "wires": []
    },
    {
        "id": "c6f7c16c.09a78",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "commandList",
        "x": 850,
        "y": 1720,
        "wires": []
    },
    {
        "id": "3b0b276c.911808",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.type",
        "x": 840,
        "y": 1760,
        "wires": []
    },
    {
        "id": "fc6e5e03.291f8",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "proServIP",
        "x": 840,
        "y": 1800,
        "wires": []
    },
    {
        "id": "4d42ff15.0288e",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.all",
        "x": 830,
        "y": 1400,
        "wires": []
    },
    {
        "id": "40cea1e4.83e24",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "false",
        "x": 830,
        "y": 1840,
        "wires": []
    },
    {
        "id": "f1bb39f8.7d0878",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "================================DEBUGGING TOOLS===================================",
        "info": "",
        "x": 510,
        "y": 1340,
        "wires": []
    },
    {
        "id": "10c37944.5cb037",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "",
        "property": "items[1]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2050,
        "y": 1980,
        "wires": [
            [
                "9678371c.e1bd18"
            ],
            [
                "126f47e7.1c8078"
            ]
        ]
    },
    {
        "id": "126f47e7.1c8078",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Query feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction searchStatusDevice() {\n    msg.itemson = [];\n    msg.itemsoff = [];\n    cpton = 0;\n    cptoff = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.current[i].Data[0].Value === true || (msg.current[i].Data[0].Value > 0 && msg.current[i].Data[0].Value <256)) {\n            msg.itemson[cpton] = msg.items[i];\n            cpton++;\n        } else if (msg.current[i].Data[0].Value === false || msg.current[i].Data[0].Value === 0) {\n            msg.itemsoff[cptoff] = msg.items[i];\n            cptoff++;\n        }\n    }\n}\n\nfunction searchStatusBlinds() {\n    msg.itemson = [];\n    msg.itemsoff = [];\n    cpton = 0;\n    cptoff = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.current[i].Data[0].Value === false || msg.current[i].Data[0].Value === 255) {\n            msg.itemsoff[cptoff] = msg.items[i];\n            cptoff++;\n        } else if (msg.current[i].Data[0].Value === true || (msg.current[i].Data[0].Value >= 0 && msg.current[i].Data[0].Value <255)) {\n            msg.itemson[cpton] = msg.items[i];\n            cpton++;\n        }\n    }\n}\n\nmsg.payload = [];\nmsg.text = [];\n\nif (msg.cmd.type === \"lights\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        searchStatusDevice();\n        if (msg.itemson.length > 0 && msg.itemsoff.length > 0) {\n            if (msg.itemson.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" est allumé et \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" ist an und \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" is on and \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemson.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" andere Licht sind an und \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" autres lumières sont allumées et \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" other lights are on and \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            }\n            if (msg.itemsoff.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" est éteints\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" ist aus\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" is off\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemsoff.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" andere Licht sind aus\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" autres lumières sont éteintes\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" other lights are off\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            }\n            endTextTabl = [textTabl1, textTabl2];\n            var endText = \"\".concat(...endTextTabl);\n            if (msg.cmd.lang === \"de\") {endLang = \"de-DE\";} else if (msg.cmd.lang === \"fr\") {endLang = \"fr-FR\";} else {endLang = \"en-EN\";}\n            msg.payload = {\n                text: endText,\n                siteId: msg.cmd.siteId,\n                lang: endLang\n            };\n        } else {\n            if (msg.itemson.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = \"Toutes les lumières sont éteintes\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = \" alles ist aus\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    var text1 = \" all lights are off\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n            else if (msg.itemsoff.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = \"Toutes les lumières sont allumées\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = \" alles ist an\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    var text1 = \" all lights are on\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        }\n    }\n}\n\nif (msg.cmd.type === \"blinds\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        searchOnBlinds();\n        if (msg.itemson.length > 0 && msg.itemsoff.length > 0) {\n            if (msg.itemson.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" est ouvert et \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" ist geoeffnet und \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" is opened and \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemson.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" andere Geräte sind geöffnet und \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" autres appareils sont ouverts et \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" other devices are opened and \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            }\n            if (msg.itemsoff.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" est fermés\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" ist geschlossen\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" is closed\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemsoff.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" andere Geräte sind geschlossen\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" autres appareils sont fermés\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" other devices are closed\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            }\n            endTextTabl = [textTabl1, textTabl2];\n            var endText = \"\".concat(...endTextTabl);\n            if (msg.cmd.lang === \"de\") {endLang = \"de-DE\";} else if (msg.cmd.lang === \"fr\") {endLang = \"fr-FR\";} else {endLang = \"en-EN\";}\n            msg.payload = {\n                text: endText,\n                siteId: msg.cmd.siteId,\n                lang: endLang\n            };\n        }\n        if (msg.itemson.length === 0) {\n            if (msg.cmd.lang === \"fr\"){\n                var text1 = \" tous les volets sont fermés\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n            else if (msg.cmd.lang === \"de\"){\n                var text1 = \" alles ist geschlossen\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else {\n                var text1 = \" all shutters are off\";\n                textTabl = [text4, text1, text2];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n        if (msg.itemsoff.length === 0) {\n            if (msg.cmd.lang === \"fr\"){\n                var text1 = \" tous les volets sont ouverts\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n            else if (msg.cmd.lang === \"de\"){\n                var text1 = \" alles ist geöffnet\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else {\n                var text1 = \" all blinds are open\";\n                textTabl = [text4, text1, text2];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\n\nif (msg.cmd.type === \"scenes\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        searchStatusDevice();\n            if (msg.itemson.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" est activée\";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" ist an\";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" is activated\";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            if (msg.itemson.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = \"Aucune scène n'est activée\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = \" alles ist aus\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    var text1 = \"There is no scene activated\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        }\n    }\n}\n\n/*\nif (msg.cmd.type === \"aux\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        if ((msg.cmd.cmd === \"on\" && msg.cmd.room !== undefined) || (msg.cmd.cmd === \"on\" && msg.cmd.all === \"everywhere\") || (msg.cmd.cmd === \"off\" && (msg.cmd.all !== undefined || msg.cmd.room !== undefined))) {\n            searchStatusDevice();\n            if (msg.itemsok.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = \" tous les appareils sont éteints\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = \" alles ist aus\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = \" all devices are off\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n            else if (msg.itemsok.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" est allumé\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" ist an\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" is on\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            } if (msg.itemsok.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    if (msg.true === true) { var text5 = \"Ja, \";} else if (msg.true === false) { var text5 = \"Nein, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" und \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" andere Geräte sind an\";\n                    textTabl = [text5,text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else if (msg.cmd.lang === \"fr\") {\n                    if (msg.true === true) { var text5 = \"Oui, \";} else if (msg.true === false) { var text5 = \"Non, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" et \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" autres appareils sont allumés\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                } else {\n                    if (msg.true === true) { var text5 = \"Yes, \";} else if (msg.true === false) { var text5 = \"No, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" and \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" other devices are on\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        } else if (msg.cmd.cmd === \"on\" && msg.cmd.all === \"all\") {\n            searchStatusDevice();\n            if (msg.itemsok.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = \" tous les appareils sont allumés\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = \" alles ist an\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = \" all devices are on\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n            else if (msg.itemsok.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" est éteints\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" ist aus\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" is off\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            } if (msg.itemsok.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    if (msg.true === true) { var text5 = \"Ja, \";} else if (msg.true === false) { var text5 = \"Nein, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" und \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" andere Geräte sind auf\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else if (msg.cmd.lang === \"fr\") {\n                    if (msg.true === true) { var text5 = \"Oui, \";} else if (msg.true === false) { var text5 = \"Non, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" et \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" autres appareils sont éteints\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                } else {\n                    if (msg.true === true) { var text5 = \"Yes, \";} else if (msg.true === false) { var text5 = \"No, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" and \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" other devices are off\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        }\n    }\n}*/\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2200,
        "y": 2020,
        "wires": [
            [
                "a21c2264.1e132"
            ]
        ]
    },
    {
        "id": "627de4c2.41387c",
        "type": "trigger",
        "z": "a10efc34.c3f2a",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "1",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 360,
        "wires": [
            [
                "6da5a38.781545c"
            ]
        ]
    },
    {
        "id": "560c6eb.df5ae9",
        "type": "trigger",
        "z": "a10efc34.c3f2a",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "2",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 380,
        "wires": [
            [
                "6da5a38.781545c"
            ]
        ]
    },
    {
        "id": "3c6ae6b7.b3833a",
        "type": "trigger",
        "z": "a10efc34.c3f2a",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "3",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 400,
        "wires": [
            [
                "6da5a38.781545c"
            ]
        ]
    },
    {
        "id": "9ff27f4e.5094b",
        "type": "trigger",
        "z": "a10efc34.c3f2a",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "4",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 420,
        "wires": [
            [
                "6da5a38.781545c"
            ]
        ]
    },
    {
        "id": "b387752.3646088",
        "type": "trigger",
        "z": "a10efc34.c3f2a",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "5",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 440,
        "wires": [
            [
                "6da5a38.781545c"
            ]
        ]
    },
    {
        "id": "dab6ee9d.1ea2d",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Starting up feedback",
        "func": "msg.cmd=[];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.serverSiteId = flow.get(\"msgServerSiteId\");\n\nif (msg.cmd.siteId === undefined) {\n    msg.cmd.siteId = msg.serverSiteId;\n}\n\nif (msg.cmd.lang === \"de\") {\n    text = \"Startet, bitte warten\";\n    msg.error = {\n        text: text,\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n} else if (msg.cmd.lang === \"fr\") {\n    text = \"Démarrage, veuillez patienter\";\n    msg.error = {\n        text: text,\n        siteId: msg.cmd.siteId,\n        lang: \"fr-FR\"\n    };\n} else {\n    text = \"Starting up, please wait\";\n    msg.error = {\n        text: text,\n        siteId: msg.cmd.siteId,\n        lang: \"en-EN\"\n    };\n}\n\ncptok = 0;\ncpter = 0;\nflow.set(\"cptok\", cptok); // save for later use\nflow.set(\"cpter\", cpter); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 690,
        "y": 300,
        "wires": [
            [
                "f8e73052.da9ba"
            ]
        ]
    },
    {
        "id": "f8e73052.da9ba",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 845,
        "y": 300,
        "wires": []
    },
    {
        "id": "11157267.7865fe",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 480,
        "y": 300,
        "wires": [
            [
                "dab6ee9d.1ea2d"
            ]
        ]
    },
    {
        "id": "e3e15614.42e058",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Process connection status",
        "func": "msg.cmd=[];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.proServIP = flow.get(\"msgProServIP\");\ncptok = flow.get(\"cptok\");\ncpter = flow.get(\"cpter\");\nmsg.serverSiteId = flow.get(\"msgServerSiteId\");\n\n/*if (msg.cmd.siteId === undefined) {\n    msg.cmd.siteId = msg.serverSiteId;\n}*/\n\nif (msg.deviceList !== undefined && msg.proServIP !== undefined && cptok === 0 && msg.statusCode === 200) {\n    cpter = 0;\n    if (msg.cmd.lang === \"de\") {\n        text = \"real KNX Air ist betriebsbereit\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"real KNX Air est à présent prêt à l'emploi\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"real KNX Air is now ready to use\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    cptok++;\n    flow.set(\"cptok\", cptok); // save for later use\n    flow.set(\"cpter\", cpter); // save for later use\n} else if (msg.deviceList === undefined || msg.proServIP === undefined || msg.statusCode !== 200) {\n    cptok = 0;\n    cpter++;\n    if (cpter > 3) {\n        cpter = -1;\n        if (msg.cmd.lang === \"de\") {\n            text = \"Etwas stimmt nicht, ich kann die KNX-Geräte nicht laden. Bitte überprüfen Sie die IP von proServ.\";\n            msg.error = {\n                text: text,\n                siteId: msg.cmd.siteId,\n                lang: \"de-DE\"\n            };\n        } else if (msg.cmd.lang === \"fr\") {\n            text = \"Quelque chose ne va pas, je ne peux pas charger les appareils KNX. Veuillez vérifier l'adresse IP de proServ.\";\n            msg.error = {\n                text: text,\n                siteId: msg.cmd.siteId,\n                lang: \"fr-FR\"\n            };\n        } else {\n            text = \"Something is wrong, I cannot load the KNX devices. Please check the IP of proServ.\";\n            msg.error = {\n                text: text,\n                siteId: msg.cmd.siteId,\n                lang: \"en-EN\"\n            };\n        }\n    }\n    flow.set(\"cptok\", cptok); // save for later use\n    flow.set(\"cpter\", cpter); // save for later use\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1170,
        "y": 820,
        "wires": [
            [
                "7d6634f0.ae8d0c"
            ]
        ]
    },
    {
        "id": "b50ba690.4aebc8",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "=============================GET CONNECTION STATUS================================",
        "info": "",
        "x": 510,
        "y": 760,
        "wires": []
    },
    {
        "id": "107b848e.12430b",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "60",
        "crontab": "",
        "once": true,
        "x": 490,
        "y": 820,
        "wires": [
            [
                "15084b61.db6f65"
            ]
        ]
    },
    {
        "id": "15084b61.db6f65",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 640,
        "y": 820,
        "wires": [
            [
                "68712651.dc8b98"
            ]
        ]
    },
    {
        "id": "7d6634f0.ae8d0c",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 1315,
        "y": 820,
        "wires": []
    },
    {
        "id": "d06ea170.3166f",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Store server siteId",
        "func": "tmp = msg.payload.split(\"\\\"\");\ntmp1 = tmp[1].split(\"@\");\nmsg.serverSiteId = tmp1[0];\n\nflow.set(\"msgServerSiteId\", msg.serverSiteId); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1010,
        "y": 1240,
        "wires": [
            []
        ]
    },
    {
        "id": "9cdfc864.1136d8",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "================================GET SERVER SITE ID==================================",
        "info": "",
        "x": 510,
        "y": 1180,
        "wires": []
    },
    {
        "id": "36c88cf5.bcbea4",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 600,
        "y": 1240,
        "wires": [
            [
                "e49dec9d.315c2"
            ]
        ]
    },
    {
        "id": "e49dec9d.315c2",
        "type": "exec",
        "z": "a10efc34.c3f2a",
        "command": "grep \"bind*\" /etc/snips.toml",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET server siteId",
        "x": 790,
        "y": 1240,
        "wires": [
            [
                "d06ea170.3166f"
            ],
            [],
            []
        ]
    },
    {
        "id": "a44e94ec.92ec88",
        "type": "http request",
        "z": "a10efc34.c3f2a",
        "name": "GET devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://{{{proServIP}}}",
        "tls": "",
        "x": 970,
        "y": 820,
        "wires": [
            [
                "e3e15614.42e058"
            ]
        ]
    },
    {
        "id": "68712651.dc8b98",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "GET proServIP",
        "func": "msg.proServIP = flow.get(\"msgProServIP\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 800,
        "y": 820,
        "wires": [
            [
                "a44e94ec.92ec88"
            ]
        ]
    },
    {
        "id": "1e86bda6.544b72",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "items",
        "x": 830,
        "y": 1880,
        "wires": []
    },
    {
        "id": "5eec8250.d7592c",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "DEBUG IN",
        "links": [
            "a7526a82.79b968"
        ],
        "x": 2076.000030517578,
        "y": 1214.0000886917114,
        "wires": []
    },
    {
        "id": "9259b1a4.d5033",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "DEBUG IN",
        "links": [
            "a7526a82.79b968"
        ],
        "x": 2196.000030517578,
        "y": 1574.0000886917114,
        "wires": []
    },
    {
        "id": "b808d8f.602f728",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "DEBUG IN",
        "links": [
            "a7526a82.79b968"
        ],
        "x": 2576.000030517578,
        "y": 1354.0000886917114,
        "wires": []
    },
    {
        "id": "9248a617.9164f8",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "DEBUG IN",
        "links": [
            "a7526a82.79b968"
        ],
        "x": 2176.000030517578,
        "y": 1694.0000886917114,
        "wires": []
    },
    {
        "id": "2c52b37.17d3a4c",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "url",
        "x": 820,
        "y": 1920,
        "wires": []
    },
    {
        "id": "2342a368.7b895c",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "DEBUG IN",
        "links": [
            "a7526a82.79b968"
        ],
        "x": 1896.0000305175781,
        "y": 1334.0000886917114,
        "wires": []
    },
    {
        "id": "3e278040.0209c",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "DEBUG IN",
        "links": [
            "a7526a82.79b968"
        ],
        "x": 1876.0000305175781,
        "y": 1634.0000886917114,
        "wires": []
    },
    {
        "id": "6da5a38.781545c",
        "type": "exec",
        "z": "a10efc34.c3f2a",
        "command": "sudo ip addr show eth0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP (eth)",
        "x": 530,
        "y": 400,
        "wires": [
            [
                "f6e23f9c.49119"
            ],
            [],
            []
        ]
    },
    {
        "id": "f6e23f9c.49119",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "outputs": 2,
        "x": 690,
        "y": 400,
        "wires": [
            [
                "8e9f76fd.c03768"
            ],
            [
                "6a61d624.cee4d8"
            ]
        ]
    },
    {
        "id": "8e9f76fd.c03768",
        "type": "exec",
        "z": "a10efc34.c3f2a",
        "command": "sudo ip addr show wlan0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP (wlan)",
        "x": 850,
        "y": 400,
        "wires": [
            [
                "6a61d624.cee4d8"
            ],
            [],
            []
        ]
    },
    {
        "id": "6a61d624.cee4d8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Trim answer",
        "func": "msg.payload = msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1030,
        "y": 400,
        "wires": [
            [
                "cb6c15b2.3e4138"
            ]
        ]
    },
    {
        "id": "5fdf0f76.e3dc8",
        "type": "file in",
        "z": "a10efc34.c3f2a",
        "name": "Get existing names",
        "filename": "/usr/share/snips/assistant/nlu_engine/nlu_engine.json",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "x": 470,
        "y": 620,
        "wires": [
            [
                "c30d66dd.6ad328"
            ]
        ]
    },
    {
        "id": "1b7afa5e.6cf886",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "00 05 * * *",
        "once": false,
        "x": 290,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "a78bf3c6.b4bd8",
        "type": "change",
        "z": "a10efc34.c3f2a",
        "name": "Move names",
        "rules": [
            {
                "t": "move",
                "p": "payload.dataset_metadata.entities.device.utterances",
                "pt": "msg",
                "to": "existingNames.device",
                "tot": "msg"
            },
            {
                "t": "move",
                "p": "payload.dataset_metadata.entities.room.utterances",
                "pt": "msg",
                "to": "existingNames.room",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 620,
        "wires": [
            [
                "891d466c.4f05f8"
            ]
        ]
    },
    {
        "id": "891d466c.4f05f8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Create/Compare",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction findNamesByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        x = x.toLowerCase().sansAccent();\n        x = x.split(\"   \");\n        if (x[1] === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction buildETSNamesList(array) {\n    ETSNamesDevice = [];\n    ETSNamesRoom = [];\n    for (var i = 0; i < array.length; i++) {\n        if (ETSNamesDevice.indexOf(array[i].object.toLowerCase().sansAccent()) === -1) {\n            ETSNamesDevice.push(array[i].object.toLowerCase().sansAccent());\n        }\n        if (ETSNamesRoom.indexOf(array[i].zone.toLowerCase().sansAccent()) === -1) {\n            ETSNamesRoom.push(array[i].zone.toLowerCase().sansAccent());\n        }\n    }\n    return null;\n}\n\nfunction buildSNIPSDeviceList(array) {\n    array = JSON.stringify(array);\n    array = array.replace(/\\{\\\"/g, \"\\[\\{\\\"\");\n    array = array.replace(/\\\"\\}/g, \"\\\"\\}\\]\");\n    array = array.replace(/,/g, \"\\},\\{\");\n    array = JSON.parse(array);\n    SNIPSNamesDevice = [];\n    for (var i = 0; i < array.length; i++) {\n        tmp = JSON.stringify(array[i]);\n        tmp = tmp.split(\":\");\n        tmp = tmp[1].replace(\"\\\"\", \"\");\n        tmp = tmp.replace(/\\\"\\}/g, \"\");\n        if (SNIPSNamesDevice.indexOf(tmp.toLowerCase().sansAccent()) === -1) {\n            SNIPSNamesDevice.push(tmp.toLowerCase().sansAccent());\n        }\n    }\n    return null;\n}\n\nfunction buildSNIPSRoomList(array) {\n    array = JSON.stringify(array);\n    array = array.replace(/\\{\\\"/g, \"\\[\\{\\\"\");\n    array = array.replace(/\\\"\\}/g, \"\\\"\\}\\]\");\n    array = array.replace(/,/g, \"\\},\\{\");\n    array = JSON.parse(array);\n    SNIPSNamesRoom = [];\n    for (var i = 0; i < array.length; i++) {\n        tmp = JSON.stringify(array[i]);\n        tmp = tmp.split(\":\");\n        tmp = tmp[1].replace(\"\\\"\", \"\");\n        tmp = tmp.replace(/\\\"\\}/g, \"\");\n        if (SNIPSNamesRoom.indexOf(tmp.toLowerCase().sansAccent()) === -1) {\n            SNIPSNamesRoom.push(tmp.toLowerCase().sansAccent());\n        }\n    }\n    return null;\n}\n\nfunction compareDeviceLists(SNIPSList, ETSList) {\n    deviceToInject = [];\n    cpt = 0;\n    for (var i = 0; i < ETSList.length; i++) {\n        exist = false;\n        for (var x = 0; x < SNIPSList.length; x++) {\n            if (ETSList[i] === SNIPSList[x]) {\n                exist = true;\n            }\n        }\n        if (exist === false) {\n            deviceToInject[cpt] = \"\\\"\"+ETSList[i]+\"\\\"\";\n        }\n    }\n}\n\nfunction compareRoomLists(SNIPSList, ETSList) {\n    roomToInject = [];\n    cpt = 0;\n    for (var i = 0; i < ETSList.length; i++) {\n        exist = false;\n        for (var x = 0; x < SNIPSList.length; x++) {\n            if (ETSList[i] === SNIPSList[x]) {\n                exist = true;\n            }\n        }\n        if (exist === false) {\n            roomToInject[cpt] = \"\\\"\"+ETSList[i]+\"\\\"\";\n        }\n    }\n}\n\nmsg.deviceList = flow.get(\"msgDeviceList\");\n\nif (msg.deviceList !== undefined && msg.existingNames !== undefined) {\n    buildETSNamesList(msg.deviceList, 'type', 'lights');\n    buildETSNamesList(msg.deviceList, 'type', 'dimmers');\n    buildETSNamesList(msg.deviceList, 'type', 'blinds');\n    buildETSNamesList(msg.deviceList, 'type', 'heating');\n    buildETSNamesList(msg.deviceList, 'type', 'scenes');\n    buildETSNamesList(msg.deviceList, 'type', 'aux');\n    buildETSNamesList(msg.deviceList, 'type', 'controls');\n    \n    buildSNIPSDeviceList(msg.existingNames.device);\n    buildSNIPSRoomList(msg.existingNames.room);\n    \n    compareDeviceLists(SNIPSNamesDevice, ETSNamesDevice);\n    compareRoomLists(SNIPSNamesRoom, ETSNamesRoom);\n    \n    if (roomToInject !== undefined || deviceToInject !== undefined) {\n        msg.inject = true;\n        template1 = \"{\\\"operations\\\": [\";\n        template2 = \"]}\";\n        if (roomToInject !== undefined) {\n            newRoomList1 = \"[\\\"addFromVanilla\\\",{\\\"room\\\":[\";\n            newRoomList2 = roomToInject;\n            if (deviceToInject !== undefined) {newRoomList3 = \"]}],\";} else {newRoomList3 = \"]}]\";}\n            tmpNRL = [newRoomList1, newRoomList2, newRoomList3];\n            newRoomList = \"\".concat(...tmpNRL);\n        } else {\n            newRoomlist = \"\";\n        }\n        if (deviceToInject !== undefined) {\n            newDeviceList1 = \"[\\\"addFromVanilla\\\",{\\\"device\\\":[\";\n            newDeviceList2 = deviceToInject;\n            newDeviceList3 = \"]}]\";\n            tmpNDL = [newDeviceList1, newDeviceList2, newDeviceList3];\n            newDeviceList = \"\".concat(...tmpNDL);\n        } else {\n            newDevicelist = \"\";\n        }\n        injectionString = [template1, newRoomList, newDeviceList, template2];\n        tmpInject = \"\".concat(...injectionString);\n        msg.payload = JSON.parse(tmpInject);\n    }\n}\n\nmsg.one = roomToInject;\nmsg.two = deviceToInject;\nmsg.three = tmpInject;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 940,
        "y": 620,
        "wires": [
            [
                "f79af15a.b5ce4"
            ]
        ]
    },
    {
        "id": "345ace36.647f12",
        "type": "exec",
        "z": "a10efc34.c3f2a",
        "command": "sudo mosquitto_pub -t hermes/injection/perform -f /usr/share/snips/injections.json",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "Inject new words",
        "x": 1400,
        "y": 620,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "99c10e49.73f06",
        "type": "file",
        "z": "a10efc34.c3f2a",
        "name": "",
        "filename": "/usr/share/snips/injections.json",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "x": 1340,
        "y": 660,
        "wires": []
    },
    {
        "id": "c30d66dd.6ad328",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": false,
        "x": 630,
        "y": 620,
        "wires": [
            [
                "a78bf3c6.b4bd8"
            ]
        ]
    },
    {
        "id": "f79af15a.b5ce4",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "",
        "property": "inject",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1100,
        "y": 620,
        "wires": [
            [
                "84c32b61.2489f8",
                "99c10e49.73f06"
            ],
            []
        ]
    },
    {
        "id": "84c32b61.2489f8",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1230,
        "y": 620,
        "wires": [
            [
                "345ace36.647f12"
            ]
        ]
    },
    {
        "id": "e2a5f924.158f28",
        "type": "comment",
        "z": "a10efc34.c3f2a",
        "name": "=============================DYNAMIC VOCABULARY================================",
        "info": "",
        "x": 500,
        "y": 560,
        "wires": []
    },
    {
        "id": "4393304c.a80ed",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 240,
        "wires": [
            [
                "7b35e315.90b12c"
            ],
            [
                "32d13670.23f93a"
            ]
        ]
    },
    {
        "id": "e88f8c93.899b5",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftUpLights",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 240,
        "wires": [
            [
                "746c2cc4.1e9ac4"
            ]
        ]
    },
    {
        "id": "744247bf.491b58",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:turnOffLights",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 200,
        "wires": [
            [
                "746c2cc4.1e9ac4"
            ]
        ]
    },
    {
        "id": "5edc6384.c4f13c",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftDownLights",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 280,
        "wires": [
            [
                "746c2cc4.1e9ac4"
            ]
        ]
    },
    {
        "id": "d0d00091.c46a6",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:setBrightnessLights",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 320,
        "wires": [
            [
                "746c2cc4.1e9ac4"
            ]
        ]
    },
    {
        "id": "a7a7bc30.6d66b",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 480,
        "wires": [
            [
                "42f6efbb.98cee",
                "43a64861.5066a8"
            ]
        ]
    },
    {
        "id": "5e102653.713298",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:openSetShutters",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 420,
        "wires": [
            [
                "a7a7bc30.6d66b"
            ]
        ]
    },
    {
        "id": "312fef91.fee28",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftUpShutters",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 500,
        "wires": [
            [
                "a7a7bc30.6d66b"
            ]
        ]
    },
    {
        "id": "98057fee.dcfdf",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:closeSetShutters",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 460,
        "wires": [
            [
                "a7a7bc30.6d66b"
            ]
        ]
    },
    {
        "id": "f5ca50b9.cb5e9",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftDownShutters",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 540,
        "wires": [
            [
                "a7a7bc30.6d66b"
            ]
        ]
    },
    {
        "id": "ec55e503.49a328",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 660,
        "wires": [
            [
                "aad3cf12.c40b7",
                "6c783899.f36df8"
            ]
        ]
    },
    {
        "id": "54dffe9b.2bafa",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:setThermostats",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 640,
        "wires": [
            [
                "ec55e503.49a328"
            ]
        ]
    },
    {
        "id": "2cbe7129.3baf4e",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftThermostats",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 680,
        "wires": [
            [
                "ec55e503.49a328"
            ]
        ]
    },
    {
        "id": "17056edf.b2b531",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 800,
        "wires": [
            [
                "e3914417.848fb8",
                "45dc1865.8dc8f8"
            ]
        ]
    },
    {
        "id": "c61b0ffb.7a009",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:activateScenes",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 800,
        "wires": [
            [
                "17056edf.b2b531"
            ]
        ]
    },
    {
        "id": "c3615e25.3b4e1",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:turnOnLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:turnOffLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftUpLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftDownLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:setBrightnessLights",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 5,
        "x": 2720,
        "y": 240,
        "wires": [
            [
                "3f4718bd.1dbf08"
            ],
            [
                "cee28c68.4e631"
            ],
            [
                "5f0978bd.4fa918"
            ],
            [
                "1acba517.25669b"
            ],
            [
                "23ed58cd.3b61a8"
            ]
        ]
    },
    {
        "id": "32d13670.23f93a",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 260,
        "wires": []
    },
    {
        "id": "7b35e315.90b12c",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findSwitchByKey(array, key, value) {\n    msg.payload.switch_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.switch_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDimmerByKey(array, key, value) {\n    msg.payload.dimmer_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.dimmer_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'light_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.type = \"lights\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.rawDevice = rawDevice;\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawDevice.length; i++) {\n    \tmsg.cmd.device[cpt] = rawDevice[i].value.value.toLowerCase().sansAccent();\n        cpt++;\n        if (msg.cmd.device[i] === \"light\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"licht\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"lumiere\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"everything\" ) {\n            delete msg.cmd.device;\n            break;\n        }\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindSwitchByKey(msg.deviceList, 'type', 'lights');\nfindDimmerByKey(msg.deviceList, 'type', 'dimmers');\nmsg.items = msg.payload.switch_lights.concat(msg.payload.dimmer_lights);\ntmp = msg.items;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nif (msg.cmd.room !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann dieses Licht nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver cette lumière\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this light\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 220,
        "wires": [
            [
                "3550fefa.32cdd2"
            ]
        ]
    },
    {
        "id": "3550fefa.32cdd2",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 220,
        "wires": [
            [
                "cfbcad03.e372f"
            ],
            [
                "c3615e25.3b4e1"
            ]
        ]
    },
    {
        "id": "cfbcad03.e372f",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2675,
        "y": 160,
        "wires": []
    },
    {
        "id": "cee28c68.4e631",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"off\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 200,
        "wires": [
            [
                "5a03801d.e4a8b"
            ]
        ]
    },
    {
        "id": "5f0978bd.4fa918",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"increase\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 240,
        "wires": [
            [
                "1b3e1a6d.7d1266"
            ]
        ]
    },
    {
        "id": "1acba517.25669b",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"decrease\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 280,
        "wires": [
            [
                "8bdb3d96.4133b"
            ]
        ]
    },
    {
        "id": "23ed58cd.3b61a8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 320,
        "wires": [
            [
                "20cf4d61.337642"
            ]
        ]
    },
    {
        "id": "7771a49d.371a0c",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 160,
        "wires": []
    },
    {
        "id": "5a03801d.e4a8b",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 200,
        "wires": []
    },
    {
        "id": "1b3e1a6d.7d1266",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 240,
        "wires": []
    },
    {
        "id": "8bdb3d96.4133b",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 280,
        "wires": []
    },
    {
        "id": "20cf4d61.337642",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 320,
        "wires": []
    },
    {
        "id": "eb55b480.97ce28",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"40951a47-03ec-447e-8bf8-9302374e892e\",\"customData\":null,\"siteId\":\"bedroom\",\"input\":\"set the brightness of the wall to fifty percent in the home cinema\",\"asrTokens\":[[{\"value\":\"set\",\"confidence\":1,\"range_start\":0,\"range_end\":3,\"time\":{\"start\":0,\"end\":0.48}},{\"value\":\"the\",\"confidence\":1,\"range_start\":4,\"range_end\":7,\"time\":{\"start\":0.48,\"end\":0.63}},{\"value\":\"brightness\",\"confidence\":1,\"range_start\":8,\"range_end\":18,\"time\":{\"start\":0.63,\"end\":1.29}},{\"value\":\"of\",\"confidence\":1,\"range_start\":19,\"range_end\":21,\"time\":{\"start\":1.29,\"end\":1.5}},{\"value\":\"the\",\"confidence\":1,\"range_start\":22,\"range_end\":25,\"time\":{\"start\":1.5,\"end\":1.68}},{\"value\":\"wall\",\"confidence\":0.974062,\"range_start\":26,\"range_end\":30,\"time\":{\"start\":1.68,\"end\":2.4031124}},{\"value\":\"to\",\"confidence\":1,\"range_start\":31,\"range_end\":33,\"time\":{\"start\":2.4031124,\"end\":2.9099998}},{\"value\":\"fifty\",\"confidence\":0.9698206,\"range_start\":34,\"range_end\":39,\"time\":{\"start\":2.9099998,\"end\":3.36}},{\"value\":\"percent\",\"confidence\":0.6872867,\"range_start\":40,\"range_end\":47,\"time\":{\"start\":3.36,\"end\":3.57}},{\"value\":\"in\",\"confidence\":1,\"range_start\":48,\"range_end\":50,\"time\":{\"start\":3.57,\"end\":3.78}},{\"value\":\"the\",\"confidence\":1,\"range_start\":51,\"range_end\":54,\"time\":{\"start\":3.78,\"end\":3.87}},{\"value\":\"home\",\"confidence\":1,\"range_start\":55,\"range_end\":59,\"time\":{\"start\":3.87,\"end\":3.87}},{\"value\":\"cinema\",\"confidence\":1,\"range_start\":60,\"range_end\":66,\"time\":{\"start\":3.87,\"end\":5.46}}]],\"intent\":{\"intentName\":\"ProKNX:turnOffLights\",\"probability\":0.65861675},\"slots\":[{\"confidence\":0.9698206,\"rawValue\":\"fifty\",\"value\":{\"kind\":\"custom\",\"value\":\"light\"},\"range\":{\"start\":34,\"end\":39},\"entity\":\"light_device\",\"slotName\":\"light_device\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":55,\"end\":66},\"entity\":\"house_room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 280,
        "wires": [
            [
                "62b402d3.103e3c"
            ]
        ]
    },
    {
        "id": "fe891c6a.2877d",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "siteID replace ' ' with '_'",
        "func": "if(msg.payload.siteId)\n    msg.payload.siteId = msg.payload.siteId.replace(/ /g,\"_\");\nelse\n    msg.payload.siteId = \"default\";\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 2730,
        "y": 1960,
        "wires": [
            [
                "2be71b45.6307c4",
                "9d977f98.3f62e"
            ]
        ]
    },
    {
        "id": "61125eea.3ce74",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "Session IN",
        "links": [
            "34555777.8b5d98"
        ],
        "x": 2095,
        "y": 200,
        "wires": []
    },
    {
        "id": "42f6efbb.98cee",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "Session IN",
        "links": [
            "34555777.8b5d98"
        ],
        "x": 2095,
        "y": 440,
        "wires": []
    },
    {
        "id": "aad3cf12.c40b7",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "Session IN",
        "links": [
            "34555777.8b5d98"
        ],
        "x": 2095,
        "y": 620,
        "wires": []
    },
    {
        "id": "e3914417.848fb8",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "Session IN",
        "links": [
            "34555777.8b5d98"
        ],
        "x": 2095,
        "y": 760,
        "wires": []
    },
    {
        "id": "c2c1df17.441f3",
        "type": "mqtt in",
        "z": "a10efc34.c3f2a",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:deviceStatusCheck",
        "qos": "2",
        "broker": "7c060369.da740c",
        "x": 1820,
        "y": 960,
        "wires": [
            [
                "93a3651.cc41598"
            ]
        ]
    },
    {
        "id": "93a3651.cc41598",
        "type": "json",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 960,
        "wires": [
            [
                "584ce928.167e48",
                "53defec2.a21c1"
            ]
        ]
    },
    {
        "id": "584ce928.167e48",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "Session IN",
        "links": [
            "34555777.8b5d98"
        ],
        "x": 2095,
        "y": 920,
        "wires": []
    },
    {
        "id": "5fb8841e.3d2efc",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 420,
        "wires": [
            [
                "8508f849.58ce48"
            ]
        ]
    },
    {
        "id": "e4e9ddc6.567c4",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:openSetShutters",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:closeSetShutters",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftUpShutters",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftDownShutters",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 4,
        "x": 2720,
        "y": 480,
        "wires": [
            [
                "5fb8841e.3d2efc"
            ],
            [
                "4df5039a.24315c"
            ],
            [
                "f9c4b097.f4e6f"
            ],
            [
                "58a2f3d9.cd92ec"
            ]
        ]
    },
    {
        "id": "6ae8eda4.08eae4",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'window_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.type = \"blinds\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.rawDevice = rawDevice;\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawDevice.length; i++) {\n    \tmsg.cmd.device[cpt] = rawDevice[i].value.value.toLowerCase().sansAccent();\n        cpt++;\n        if (msg.cmd.device[i] === \"all shutters\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"alle rollladen\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        }\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindTypeByKey(msg.deviceList, 'type', msg.cmd.type);\ntmp = msg.items;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    msg.test = tmpList;\n    if (tmpList[0] !== undefined) {} else {\n        for (var i = 0; i < tmpList.length; i++) {\n            tmp = [];\n            for (var n = 0; n < tmpList[i].length; n++) {\n                tmp.push(tmpList[i][n]);\n            }\n        }\n    }\n}\n\nif (msg.cmd.room !== undefined && tmp !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann diesen Rolladen nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver ce volet\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this shutter\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 460,
        "wires": [
            [
                "7e8aefe1.98a64",
                "e1dc2399.32e56",
                "f43e1a2d.e4ba18",
                "7d9e32d1.7a651c"
            ]
        ]
    },
    {
        "id": "7e8aefe1.98a64",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 460,
        "wires": [
            [
                "ffc6bfd7.49a8b"
            ],
            [
                "e4e9ddc6.567c4"
            ]
        ]
    },
    {
        "id": "ffc6bfd7.49a8b",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 420,
        "wires": []
    },
    {
        "id": "4df5039a.24315c",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"off\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 460,
        "wires": [
            [
                "f38a525c.4ce42"
            ]
        ]
    },
    {
        "id": "f9c4b097.f4e6f",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"increase\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 500,
        "wires": [
            [
                "8c51ddf6.1a475"
            ]
        ]
    },
    {
        "id": "58a2f3d9.cd92ec",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"decrease\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 540,
        "wires": [
            [
                "a4efe9b6.c3c3b8"
            ]
        ]
    },
    {
        "id": "8508f849.58ce48",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 420,
        "wires": []
    },
    {
        "id": "f38a525c.4ce42",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 460,
        "wires": []
    },
    {
        "id": "8c51ddf6.1a475",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 500,
        "wires": []
    },
    {
        "id": "a4efe9b6.c3c3b8",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 540,
        "wires": []
    },
    {
        "id": "b37a8537.d5cf78",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nvar rawAction = findObjectByKey(msg.payload.slots, 'slotName', 'up_down');\n\nif (rawAction[0].value.value.toLowerCase().sansAccent() === \"up\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"hoher\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"plus chaud\") {\n    msg.cmd.cmd = \"increase\";\n} else if (rawAction[0].value.value.toLowerCase().sansAccent() === \"down\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"niedriger\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"plus froid\") {\n    msg.cmd.cmd = \"decrease\";\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 640,
        "wires": [
            [
                "4aed5869.ba1d68"
            ]
        ]
    },
    {
        "id": "6f2192f1.fac98c",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:shiftThermostats",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:setThermostats",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2720,
        "y": 660,
        "wires": [
            [
                "b37a8537.d5cf78"
            ],
            [
                "47ef329b.d8b2cc"
            ]
        ]
    },
    {
        "id": "53c4a71f.ebf928",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'temperature_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'temperature');\nvar rawUpDown = findObjectByKey(msg.payload.slots, 'slotName', 'up_down');\nmsg.cmd.type = \"heating\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.cmd.device = [];\n    for (var i = 0; i < rawDevice.length; i++) {\n\t    msg.cmd.device[i] = rawDevice[i].value.value.toLowerCase().sansAccent();\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindTypeByKey(msg.deviceList, 'type', msg.cmd.type);\ntmp = msg.items;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    if (tmpList[0][0]!== undefined) {\n            if (tmpList[0][0].name!== undefined) {\n                tmp = [];\n                for (var i = 0; i < tmpList.length; i++) {\n                    for (var n = 0; n < tmpList[i].length; n++) {\n                        tmp.push(tmpList[i][n]);\n                    }\n                }\n            }\n        } else {}\n}\nif (msg.cmd.room !== undefined && tmp !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann dieses Thermostat nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver ce thermostat\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this thermostat\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 640,
        "wires": [
            [
                "33ffb61f.013b6a"
            ]
        ]
    },
    {
        "id": "33ffb61f.013b6a",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 640,
        "wires": [
            [
                "3980d0b4.3e627"
            ],
            [
                "6f2192f1.fac98c"
            ]
        ]
    },
    {
        "id": "3980d0b4.3e627",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 620,
        "wires": []
    },
    {
        "id": "47ef329b.d8b2cc",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"set\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 680,
        "wires": [
            [
                "be25cb66.912838"
            ]
        ]
    },
    {
        "id": "4aed5869.ba1d68",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 640,
        "wires": []
    },
    {
        "id": "be25cb66.912838",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "a7526a82.79b968",
            "e5c52d9e.d074c"
        ],
        "x": 3035,
        "y": 680,
        "wires": []
    },
    {
        "id": "46552365.f53f1c",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"bad1fb80-9c46-42de-80c4-7ac8c52b4132\",\"customData\":null,\"siteId\":\"default\",\"input\":\"open home cinema shutter\",\"asrTokens\":[[{\"value\":\"öffne\",\"confidence\":1,\"range_start\":0,\"range_end\":5,\"time\":{\"start\":0,\"end\":0.71999997}},{\"value\":\"die\",\"confidence\":1,\"range_start\":6,\"range_end\":9,\"time\":{\"start\":0.71999997,\"end\":0.78}},{\"value\":\"lamellen\",\"confidence\":1,\"range_start\":10,\"range_end\":18,\"time\":{\"start\":0.78,\"end\":1.23}},{\"value\":\"im\",\"confidence\":1,\"range_start\":19,\"range_end\":21,\"time\":{\"start\":1.23,\"end\":1.53}},{\"value\":\"wohnzimmer\",\"confidence\":1,\"range_start\":22,\"range_end\":32,\"time\":{\"start\":1.53,\"end\":2.73}}]],\"intent\":{\"intentName\":\"ProKNX:openSetShutters\",\"probability\":1},\"slots\":[{\"confidence\":1,\"rawValue\":\"shutter\",\"value\":{\"kind\":\"Custom\",\"value\":\"shutters\"},\"range\":{\"start\":6,\"end\":18},\"entity\":\"window_devices\",\"slotName\":\"window_device\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":22,\"end\":32},\"entity\":\"room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 520,
        "wires": [
            [
                "43a64861.5066a8"
            ]
        ]
    },
    {
        "id": "1d33d7cb.6953e8",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"40951a47-03ec-447e-8bf8-9302374e892e\",\"customData\":null,\"siteId\":\"bedroom\",\"input\":\"set the brightness of the wall to fifty percent in the home cinema\",\"intent\":{\"intentName\":\"ProKNX:shiftThermostats\",\"probability\":0.75861675},\"slots\":[{\"confidence\":0.974062,\"rawValue\":\"up\",\"value\":{\"kind\":\"Custom\",\"value\":\"down\"},\"range\":{\"start\":26,\"end\":30},\"entity\":\"up_down\",\"slotName\":\"up_down\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":55,\"end\":66},\"entity\":\"house_room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 700,
        "wires": [
            [
                "6c783899.f36df8"
            ]
        ]
    },
    {
        "id": "397decc4.fcedc4",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 800,
        "wires": [
            [
                "fa026c94.9a529"
            ]
        ]
    },
    {
        "id": "9b536b7e.9f3148",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:activateScenes",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 2720,
        "y": 800,
        "wires": [
            [
                "397decc4.fcedc4"
            ]
        ]
    },
    {
        "id": "e54fae8e.dda05",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'scene_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.type = \"scenes\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawDevice.length; i++) {\n        if (rawDevice[i].value.value.toLowerCase().sansAccent() !== \"scene\" && rawDevice[i].value.value.toLowerCase().sansAccent() !== \"szene\") {\n    \t    msg.cmd.device[cpt] = rawDevice[i].value.value.toLowerCase().sansAccent();\n            cpt++;\n        }\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindTypeByKey(msg.deviceList, 'type', msg.cmd.type);\ntmp = msg.items;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\nif (msg.cmd.room !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n} else {tmp = [];}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann diese Szene nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver cette scène\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this scene\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 780,
        "wires": [
            [
                "219c04bf.e060ec"
            ]
        ]
    },
    {
        "id": "219c04bf.e060ec",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 780,
        "wires": [
            [
                "91d41aaa.7dd1d8"
            ],
            [
                "9b536b7e.9f3148"
            ]
        ]
    },
    {
        "id": "91d41aaa.7dd1d8",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 760,
        "wires": []
    },
    {
        "id": "fa026c94.9a529",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "e5c52d9e.d074c",
            "a7526a82.79b968"
        ],
        "x": 3035,
        "y": 800,
        "wires": []
    },
    {
        "id": "d904ccd.7e8df3",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Array_intent",
        "func": "msg.cmd = [];\ntmp = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findSwitchByKey(array, key, value) {\n    msg.payload.switch_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.switch_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDimmerByKey(array, key, value) {\n    msg.payload.dimmer_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.dimmer_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawLight = findObjectByKey(msg.payload.slots, 'slotName', 'light_device');\nvar rawShutter = findObjectByKey(msg.payload.slots, 'slotName', 'window_device');\nvar rawTherm = findObjectByKey(msg.payload.slots, 'slotName', 'temperature_device');\nvar rawScene = findObjectByKey(msg.payload.slots, 'slotName', 'scene_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nmsg.cmd.query = true;\n\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawLight !== null) {\n    msg.cmd.type = \"lights\";\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawLight.length; i++) {\n        if (rawLight[i].value.value.toLowerCase().sansAccent() !== \"light\" && rawLight[i].value.value.toLowerCase().sansAccent() !== \"licht\" && rawLight[i].value.value.toLowerCase().sansAccent() !== \"lumiere\") {\n    \t    msg.cmd.device[cpt] = rawLight[i].value.value.toLowerCase().sansAccent();\n            cpt++;\n        }\n    }\n    tmp = [];\n    findSwitchByKey(msg.deviceList, 'type', 'lights');\n    findDimmerByKey(msg.deviceList, 'type', 'dimmers');\n    msg.items = msg.payload.switch_lights.concat(msg.payload.dimmer_lights);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n        msg.tmpList = [];\n        cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            msg.tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        tmp = [];\n        for (var i = 0; i < msg.tmpList.length; i++) {\n            for (var n = 0; n < msg.tmpList[i].length; n++) {\n                tmp.push(msg.tmpList[i][n]);\n            }\n        }\n    }\n} else if (rawShutter !== null) {\n    msg.cmd.type = \"blinds\";\n    cpt = 0;\n    msg.cmd.device = [];\n    for (var i = 0; i < rawShutter.length; i++) {\n        msg.cmd.device[cpt] = rawShutter[i].value.value.toLowerCase().sansAccent();\n    }\n\n    tmp = [];\n    findTypeByKey(msg.deviceList, 'type', msg.cmd.type);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n        tmpList = [];\n        cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        if (tmpList[0][0]!== undefined) {\n            if (tmpList[0][0].name!== undefined) {\n                tmp = [];\n                for (var i = 0; i < tmpList.length; i++) {\n                    for (var n = 0; n < tmpList[i].length; n++) {\n                        tmp.push(tmpList[i][n]);\n                    }\n                }\n            }\n        } else {}\n    }\n} else if (rawTherm !== null) {\n    msg.cmd.type = \"heating\";\n    cpt = 0;\n        msg.cmd.device = [];\n        for (var i = 0; i < rawTherm.length; i++) {\n\t        msg.cmd.device[cpt] = rawTherm[i].value.value.toLowerCase().sansAccent();\n        }\n        \n    tmp = [];\n    findTypeByKey(msg.deviceList, 'type', msg.cmd.type);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n    tmpList = [];\n    cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        if (tmpList[0][0]!== undefined) {\n            if (tmpList[0][0].name!== undefined) {\n                tmp = [];\n                for (var i = 0; i < tmpList.length; i++) {\n                    for (var n = 0; n < tmpList[i].length; n++) {\n                        tmp.push(tmpList[i][n]);\n                    }\n                }\n            }\n        } else {}\n    }\n} else if (rawScene !== null) {\n    msg.cmd.type = \"scenes\";\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawScene.length; i++) {\n        if (rawScene[i].value.value.toLowerCase().sansAccent() !== \"scene\" && RawScene[i].value.value.toLowerCase().sansAccent() !== \"all\") {\n    \t    msg.cmd.device[cpt] = rawScene[i].value.value.toLowerCase().sansAccent();\n            cpt++;\n        }\n    }\n    tmp = [];\n    findTypeByKey(msg.deviceList, 'type', msg.cmd.type);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n        msg.tmpList = [];\n        cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            msg.tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        tmp = [];\n        for (var i = 0; i < msg.tmpList.length; i++) {\n            for (var n = 0; n < msg.tmpList[i].length; n++) {\n                tmp.push(msg.tmpList[i][n]);\n            }\n        }\n    }\n}\n\nif (msg.cmd.room !== undefined && tmp !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann dieses Gerät nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver cet appareil\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this device\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 940,
        "wires": [
            [
                "6b7d133a.73143c"
            ]
        ]
    },
    {
        "id": "6b7d133a.73143c",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 960,
        "wires": [
            [
                "2574023e.402abe"
            ],
            [
                "6066c1eb.1b935"
            ]
        ]
    },
    {
        "id": "2574023e.402abe",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 940,
        "wires": []
    },
    {
        "id": "6066c1eb.1b935",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "QUERY EXECUTION IN",
        "links": [
            "c088f2bf.a2199",
            "a7526a82.79b968"
        ],
        "x": 2655,
        "y": 980,
        "wires": []
    },
    {
        "id": "d6da8c.87a0b578",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"ada95fa7-80bc-4a75-86dd-1c43e4921950\",\"customData\":null,\"siteId\":\"default\",\"input\":\"what 's the status of the blinds in the home cinema\",\"asrTokens\":[[{\"value\":\"what\",\"confidence\":1,\"range_start\":0,\"range_end\":4,\"time\":{\"start\":0,\"end\":1.02}},{\"value\":\"'s\",\"confidence\":1,\"range_start\":5,\"range_end\":7,\"time\":{\"start\":1.02,\"end\":1.14}},{\"value\":\"the\",\"confidence\":0.9781889,\"range_start\":8,\"range_end\":11,\"time\":{\"start\":1.14,\"end\":1.316074}},{\"value\":\"status\",\"confidence\":1,\"range_start\":12,\"range_end\":18,\"time\":{\"start\":1.316074,\"end\":1.8299999}},{\"value\":\"of\",\"confidence\":1,\"range_start\":19,\"range_end\":21,\"time\":{\"start\":1.8299999,\"end\":1.9799999}},{\"value\":\"the\",\"confidence\":0.9132247,\"range_start\":22,\"range_end\":25,\"time\":{\"start\":1.9799999,\"end\":2.7471087}},{\"value\":\"blinds\",\"confidence\":1,\"range_start\":26,\"range_end\":32,\"time\":{\"start\":2.7471087,\"end\":2.9099998}},{\"value\":\"in\",\"confidence\":1,\"range_start\":33,\"range_end\":35,\"time\":{\"start\":2.9099998,\"end\":3.06}},{\"value\":\"the\",\"confidence\":1,\"range_start\":36,\"range_end\":39,\"time\":{\"start\":3.06,\"end\":3.3}},{\"value\":\"home\",\"confidence\":1,\"range_start\":40,\"range_end\":44,\"time\":{\"start\":3.3,\"end\":3.3899999}},{\"value\":\"cinema\",\"confidence\":1,\"range_start\":45,\"range_end\":51,\"time\":{\"start\":3.3899999,\"end\":4.62}}]],\"intent\":{\"intentName\":\"ProKNX:deviceStatusCheck\",\"probability\":0.99101967},\"slots\":[{\"confidence\":1,\"rawValue\":\"blinds\",\"value\":{\"kind\":\"Custom\",\"value\":\"blinds\"},\"range\":{\"start\":26,\"end\":32},\"entity\":\"window_device\",\"slotName\":\"window_device\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":40,\"end\":51},\"entity\":\"house_room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 1000,
        "wires": [
            [
                "53defec2.a21c1"
            ]
        ]
    },
    {
        "id": "fe4b8df.994307",
        "type": "split",
        "z": "a10efc34.c3f2a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2350,
        "y": 1980,
        "wires": [
            [
                "a21c2264.1e132"
            ]
        ]
    },
    {
        "id": "8d3c6904.8edd28",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Inject English",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2405.9999771118164,
        "y": 2062.000647544861,
        "wires": [
            [
                "784ba7f5.ae2318"
            ]
        ]
    },
    {
        "id": "784ba7f5.ae2318",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "msg EN",
        "func": "msg.payload = {\n    text: \"Hello, this is a test message!\",\n    siteId: \"default\",\n    lang: \"en-UK\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2559.999969482422,
        "y": 2062.000159263611,
        "wires": [
            [
                "2be71b45.6307c4",
                "9d977f98.3f62e"
            ]
        ]
    },
    {
        "id": "ebbb6e3d.adf96",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "msg FR",
        "func": "msg.payload = {\n    text: \"Bonjour, ceci est un message de test!\",\n    siteId: \"default\",\n    lang: \"fr-FR\"\n};\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2559.286865234375,
        "y": 2106.369384765625,
        "wires": [
            [
                "2be71b45.6307c4",
                "9d977f98.3f62e"
            ]
        ]
    },
    {
        "id": "b3fe8240.68061",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Inject French",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2405.2868728637695,
        "y": 2106.369873046875,
        "wires": [
            [
                "ebbb6e3d.adf96"
            ]
        ]
    },
    {
        "id": "277f14ff.4e29fc",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "msg DE",
        "func": "msg.payload = {\n    text: \"Hallo, das ist eine Testnachricht!\",\n    siteId: \"default\",\n    lang: \"de-DE\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2560.286865234375,
        "y": 2150.369384765625,
        "wires": [
            [
                "2be71b45.6307c4",
                "9d977f98.3f62e"
            ]
        ]
    },
    {
        "id": "2839957a.48597a",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "Inject German",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2406.2868728637695,
        "y": 2150.369873046875,
        "wires": [
            [
                "277f14ff.4e29fc"
            ]
        ]
    },
    {
        "id": "71f2211.ac294e",
        "type": "inject",
        "z": "a10efc34.c3f2a",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"f4bfcec4-95e6-4258-bbae-090cddd189db\",\"customData\":null,\"siteId\":\"bedroom\",\"input\":\"activate\",\"asrTokens\":[[{\"value\":\"activate\",\"confidence\":1,\"range_start\":0,\"range_end\":8,\"time\":{\"start\":0,\"end\":1.89}}]],\"intent\":{\"intentName\":\"ProKNX:activateScenes\",\"probability\":0.81419545},\"slots\":[{\"confidence\":1,\"rawValue\":\"activate\",\"value\":{\"kind\":\"Custom\",\"value\":\"activate\"},\"range\":{\"start\":0,\"end\":8},\"entity\":\"scene_name\",\"slotName\":\"scene_device\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 840,
        "wires": [
            [
                "45dc1865.8dc8f8"
            ]
        ]
    },
    {
        "id": "c16397dc.c90aa8",
        "type": "http in",
        "z": "a10efc34.c3f2a",
        "name": "",
        "url": "/hello",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 2398.9233360290527,
        "y": 2213.1875915527344,
        "wires": [
            [
                "1777c7a2.feaaf8",
                "1cfab996.c00b06"
            ]
        ]
    },
    {
        "id": "1777c7a2.feaaf8",
        "type": "http response",
        "z": "a10efc34.c3f2a",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 2560,
        "y": 2260,
        "wires": []
    },
    {
        "id": "1cfab996.c00b06",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "msg",
        "func": "if(!msg.payload){\n    msg.payload = {\n        text: \"Hello!\",\n        siteId: \"default\",\n        lang: \"en-UK\"\n    };\n}\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 2550,
        "y": 2220,
        "wires": [
            [
                "2be71b45.6307c4",
                "9d977f98.3f62e"
            ]
        ]
    },
    {
        "id": "62b402d3.103e3c",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 240,
        "wires": [
            [
                "4393304c.a80ed"
            ]
        ]
    },
    {
        "id": "870d61f3.00bdb",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 480,
        "wires": [
            [
                "6ae8eda4.08eae4",
                "30e34fe.0e1dbb"
            ],
            [
                "f4e11622.bb2ed8"
            ]
        ]
    },
    {
        "id": "f4e11622.bb2ed8",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 500,
        "wires": []
    },
    {
        "id": "43a64861.5066a8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 480,
        "wires": [
            [
                "870d61f3.00bdb"
            ]
        ]
    },
    {
        "id": "225df12b.138bbe",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 660,
        "wires": [
            [
                "53c4a71f.ebf928"
            ],
            [
                "28a2ac7.e0bcc54"
            ]
        ]
    },
    {
        "id": "28a2ac7.e0bcc54",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 680,
        "wires": []
    },
    {
        "id": "6c783899.f36df8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 660,
        "wires": [
            [
                "225df12b.138bbe"
            ]
        ]
    },
    {
        "id": "fc567d25.4c59b",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 800,
        "wires": [
            [
                "e54fae8e.dda05"
            ],
            [
                "8be38c38.0f1fb"
            ]
        ]
    },
    {
        "id": "8be38c38.0f1fb",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 820,
        "wires": []
    },
    {
        "id": "45dc1865.8dc8f8",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 800,
        "wires": [
            [
                "fc567d25.4c59b"
            ]
        ]
    },
    {
        "id": "c891740d.947d28",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 960,
        "wires": [
            [
                "d904ccd.7e8df3"
            ],
            [
                "fbb56eed.f4d2b"
            ]
        ]
    },
    {
        "id": "fbb56eed.f4d2b",
        "type": "link out",
        "z": "a10efc34.c3f2a",
        "name": "ERROR IN",
        "links": [
            "c1d9abe6.c5f8b8",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 980,
        "wires": []
    },
    {
        "id": "53defec2.a21c1",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 960,
        "wires": [
            [
                "c891740d.947d28"
            ]
        ]
    },
    {
        "id": "2e58610d.38f19e",
        "type": "switch",
        "z": "a10efc34.c3f2a",
        "name": "",
        "property": "cmd.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "lights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "blinds",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 1930,
        "y": 2000,
        "wires": [
            [
                "10c37944.5cb037"
            ],
            [
                "10c37944.5cb037"
            ],
            [
                "9678371c.e1bd18"
            ]
        ]
    },
    {
        "id": "30e34fe.0e1dbb",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "false",
        "x": 2307.142857142857,
        "y": 560,
        "wires": []
    },
    {
        "id": "e1dc2399.32e56",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "items",
        "x": 2550,
        "y": 500,
        "wires": []
    },
    {
        "id": "f43e1a2d.e4ba18",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "cmd.device",
        "x": 2560,
        "y": 540,
        "wires": []
    },
    {
        "id": "7d9e32d1.7a651c",
        "type": "debug",
        "z": "a10efc34.c3f2a",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "test",
        "x": 2540,
        "y": 580,
        "wires": []
    },
    {
        "id": "2be71b45.6307c4",
        "type": "function",
        "z": "a10efc34.c3f2a",
        "name": "warmup",
        "func": "// the respeaker speaker needs time to get started\nmsg.payload.text = \" \";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2900,
        "y": 2080,
        "wires": [
            [
                "a1a7b37b.e5ef"
            ]
        ]
    },
    {
        "id": "9d977f98.3f62e",
        "type": "delay",
        "z": "a10efc34.c3f2a",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2890,
        "y": 2140,
        "wires": [
            [
                "a1a7b37b.e5ef"
            ]
        ]
    },
    {
        "id": "7c060369.da740c",
        "type": "mqtt-broker",
        "z": "a10efc34.c3f2a",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": ""
    }
]